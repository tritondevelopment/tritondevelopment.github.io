import{i as $v,e as Fv,f as Dv,h as Lv,j as jv,k as qv,m as Mv,o as Uv,p as zv,q as kv,s as Hv,r as Kv,t as Vv,u as Bv,v as Gv,w as Dc,x as uf,y as se,z as hf,A as Ro,H as Wv,B as lf,C as Jv,D as Qv,E as Yv,F as ns,G as Qr,I as Zv,J as ff,K as go,L as Xv,M as Lc,_ as e1}from"./index-ac25b06b.js";import{d as t1,s as ss,a as To,i as Zh,c as r1,b as i1,f as jc,p as n1,J as fi,e as qc,g as Mc,h as Uc,j as Si,k as li,l as ts,m as s1,n as o1,H as Ai}from"./http-5e656489.js";function zc(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function pf(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?zc(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function Ic(o,r){r||(r=o.reduce((a,h)=>a+h.length,0));const t=pf(r);let n=0;for(const a of o)t.set(a,n),n+=a.length;return zc(t)}const Xh={...$v,...Fv,...Dv,...Lv,...jv,...qv,...Mv,...Uv,...zv,...kv};function df(o,r,t,n){return{name:o,prefix:r,encoder:{name:o,prefix:r,encode:t},decoder:{decode:n}}}const el=df("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),sc=df("ascii","a",o=>{let r="a";for(let t=0;t<o.length;t++)r+=String.fromCharCode(o[t]);return r},o=>{o=o.substring(1);const r=pf(o.length);for(let t=0;t<o.length;t++)r[t]=o.charCodeAt(t);return r}),gf={utf8:el,"utf-8":el,hex:Xh.base16,latin1:sc,ascii:sc,binary:sc,...Xh};function gr(o,r="utf8"){const t=gf[r];if(!t)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?zc(globalThis.Buffer.from(o,"utf-8")):t.decoder.decode(`${t.prefix}${o}`)}function sr(o,r="utf8"){const t=gf[r];if(!t)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("utf8"):t.encoder.encode(o).substring(1)}const a1={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};var rs={};(function(o){const r=Vv,t=Bv,n=Hv,a=Kv,h=C=>C==null,p=Symbol("encodeFragmentIdentifier");function g(C){switch(C.arrayFormat){case"index":return $=>(M,q)=>{const I=M.length;return q===void 0||C.skipNull&&q===null||C.skipEmptyString&&q===""?M:q===null?[...M,[b($,C),"[",I,"]"].join("")]:[...M,[b($,C),"[",b(I,C),"]=",b(q,C)].join("")]};case"bracket":return $=>(M,q)=>q===void 0||C.skipNull&&q===null||C.skipEmptyString&&q===""?M:q===null?[...M,[b($,C),"[]"].join("")]:[...M,[b($,C),"[]=",b(q,C)].join("")];case"colon-list-separator":return $=>(M,q)=>q===void 0||C.skipNull&&q===null||C.skipEmptyString&&q===""?M:q===null?[...M,[b($,C),":list="].join("")]:[...M,[b($,C),":list=",b(q,C)].join("")];case"comma":case"separator":case"bracket-separator":{const $=C.arrayFormat==="bracket-separator"?"[]=":"=";return M=>(q,I)=>I===void 0||C.skipNull&&I===null||C.skipEmptyString&&I===""?q:(I=I===null?"":I,q.length===0?[[b(M,C),$,b(I,C)].join("")]:[[q,b(I,C)].join(C.arrayFormatSeparator)])}default:return $=>(M,q)=>q===void 0||C.skipNull&&q===null||C.skipEmptyString&&q===""?M:q===null?[...M,b($,C)]:[...M,[b($,C),"=",b(q,C)].join("")]}}function w(C){let $;switch(C.arrayFormat){case"index":return(M,q,I)=>{if($=/\[(\d*)\]$/.exec(M),M=M.replace(/\[\d*\]$/,""),!$){I[M]=q;return}I[M]===void 0&&(I[M]={}),I[M][$[1]]=q};case"bracket":return(M,q,I)=>{if($=/(\[\])$/.exec(M),M=M.replace(/\[\]$/,""),!$){I[M]=q;return}if(I[M]===void 0){I[M]=[q];return}I[M]=[].concat(I[M],q)};case"colon-list-separator":return(M,q,I)=>{if($=/(:list)$/.exec(M),M=M.replace(/:list$/,""),!$){I[M]=q;return}if(I[M]===void 0){I[M]=[q];return}I[M]=[].concat(I[M],q)};case"comma":case"separator":return(M,q,I)=>{const D=typeof q=="string"&&q.includes(C.arrayFormatSeparator),H=typeof q=="string"&&!D&&S(q,C).includes(C.arrayFormatSeparator);q=H?S(q,C):q;const ce=D||H?q.split(C.arrayFormatSeparator).map(ae=>S(ae,C)):q===null?q:S(q,C);I[M]=ce};case"bracket-separator":return(M,q,I)=>{const D=/(\[\])$/.test(M);if(M=M.replace(/\[\]$/,""),!D){I[M]=q&&S(q,C);return}const H=q===null?[]:q.split(C.arrayFormatSeparator).map(ce=>S(ce,C));if(I[M]===void 0){I[M]=H;return}I[M]=[].concat(I[M],H)};default:return(M,q,I)=>{if(I[M]===void 0){I[M]=q;return}I[M]=[].concat(I[M],q)}}}function y(C){if(typeof C!="string"||C.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function b(C,$){return $.encode?$.strict?r(C):encodeURIComponent(C):C}function S(C,$){return $.decode?t(C):C}function N(C){return Array.isArray(C)?C.sort():typeof C=="object"?N(Object.keys(C)).sort(($,M)=>Number($)-Number(M)).map($=>C[$]):C}function K(C){const $=C.indexOf("#");return $!==-1&&(C=C.slice(0,$)),C}function j(C){let $="";const M=C.indexOf("#");return M!==-1&&($=C.slice(M)),$}function J(C){C=K(C);const $=C.indexOf("?");return $===-1?"":C.slice($+1)}function oe(C,$){return $.parseNumbers&&!Number.isNaN(Number(C))&&typeof C=="string"&&C.trim()!==""?C=Number(C):$.parseBooleans&&C!==null&&(C.toLowerCase()==="true"||C.toLowerCase()==="false")&&(C=C.toLowerCase()==="true"),C}function fe(C,$){$=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},$),y($.arrayFormatSeparator);const M=w($),q=Object.create(null);if(typeof C!="string"||(C=C.trim().replace(/^[?#&]/,""),!C))return q;for(const I of C.split("&")){if(I==="")continue;let[D,H]=n($.decode?I.replace(/\+/g," "):I,"=");H=H===void 0?null:["comma","separator","bracket-separator"].includes($.arrayFormat)?H:S(H,$),M(S(D,$),H,q)}for(const I of Object.keys(q)){const D=q[I];if(typeof D=="object"&&D!==null)for(const H of Object.keys(D))D[H]=oe(D[H],$);else q[I]=oe(D,$)}return $.sort===!1?q:($.sort===!0?Object.keys(q).sort():Object.keys(q).sort($.sort)).reduce((I,D)=>{const H=q[D];return H&&typeof H=="object"&&!Array.isArray(H)?I[D]=N(H):I[D]=H,I},Object.create(null))}o.extract=J,o.parse=fe,o.stringify=(C,$)=>{if(!C)return"";$=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},$),y($.arrayFormatSeparator);const M=H=>$.skipNull&&h(C[H])||$.skipEmptyString&&C[H]==="",q=g($),I={};for(const H of Object.keys(C))M(H)||(I[H]=C[H]);const D=Object.keys(I);return $.sort!==!1&&D.sort($.sort),D.map(H=>{const ce=C[H];return ce===void 0?"":ce===null?b(H,$):Array.isArray(ce)?ce.length===0&&$.arrayFormat==="bracket-separator"?b(H,$)+"[]":ce.reduce(q(H),[]).join("&"):b(H,$)+"="+b(ce,$)}).filter(H=>H.length>0).join("&")},o.parseUrl=(C,$)=>{$=Object.assign({decode:!0},$);const[M,q]=n(C,"#");return Object.assign({url:M.split("?")[0]||"",query:fe(J(C),$)},$&&$.parseFragmentIdentifier&&q?{fragmentIdentifier:S(q,$)}:{})},o.stringifyUrl=(C,$)=>{$=Object.assign({encode:!0,strict:!0,[p]:!0},$);const M=K(C.url).split("?")[0]||"",q=o.extract(C.url),I=o.parse(q,{sort:!1}),D=Object.assign(I,C.query);let H=o.stringify(D,$);H&&(H=`?${H}`);let ce=j(C.url);return C.fragmentIdentifier&&(ce=`#${$[p]?b(C.fragmentIdentifier,$):C.fragmentIdentifier}`),`${M}${H}${ce}`},o.pick=(C,$,M)=>{M=Object.assign({parseFragmentIdentifier:!0,[p]:!1},M);const{url:q,query:I,fragmentIdentifier:D}=o.parseUrl(C,M);return o.stringifyUrl({url:q,query:a(I,$),fragmentIdentifier:D},M)},o.exclude=(C,$,M)=>{const q=Array.isArray($)?I=>!$.includes(I):(I,D)=>!$(I,D);return o.pick(C,q,M)}})(rs);const c1=":";function u1(o){const[r,t]=o.split(c1);return{namespace:r,reference:t}}function h1(o,r=[]){const t=[];return Object.keys(o).forEach(n=>{if(r.length&&!r.includes(n))return;const a=o[n];t.push(...a.accounts)}),t}function yf(o,r){return o.includes(":")?[o]:r.chains||[]}const mf="base10",nr="base16",xc="base64pad",kc="utf8",vf=0,Gi=1,l1=0,tl=1,Sc=12,Hc=32;function f1(){const o=hf.generateKeyPair();return{privateKey:sr(o.secretKey,nr),publicKey:sr(o.publicKey,nr)}}function Pc(){const o=Ro.randomBytes(Hc);return sr(o,nr)}function p1(o,r){const t=hf.sharedKey(gr(o,nr),gr(r,nr),!0),n=new Wv(Dc.SHA256,t).expand(Hc);return sr(n,nr)}function d1(o){const r=Dc.hash(gr(o,nr));return sr(r,nr)}function bn(o){const r=Dc.hash(gr(o,kc));return sr(r,nr)}function g1(o){return gr(`${o}`,mf)}function os(o){return Number(sr(o,mf))}function y1(o){const r=g1(typeof o.type<"u"?o.type:vf);if(os(r)===Gi&&typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof o.senderPublicKey<"u"?gr(o.senderPublicKey,nr):void 0,n=typeof o.iv<"u"?gr(o.iv,nr):Ro.randomBytes(Sc),a=new lf.ChaCha20Poly1305(gr(o.symKey,nr)).seal(n,gr(o.message,kc));return v1({type:r,sealed:a,iv:n,senderPublicKey:t})}function m1(o){const r=new lf.ChaCha20Poly1305(gr(o.symKey,nr)),{sealed:t,iv:n}=Po(o.encoded),a=r.open(n,t);if(a===null)throw new Error("Failed to decrypt");return sr(a,kc)}function v1(o){if(os(o.type)===Gi){if(typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return sr(Ic([o.type,o.senderPublicKey,o.iv,o.sealed]),xc)}return sr(Ic([o.type,o.iv,o.sealed]),xc)}function Po(o){const r=gr(o,xc),t=r.slice(l1,tl),n=tl;if(os(t)===Gi){const g=n+Hc,w=g+Sc,y=r.slice(n,g),b=r.slice(g,w),S=r.slice(w);return{type:t,sealed:S,iv:b,senderPublicKey:y}}const a=n+Sc,h=r.slice(n,a),p=r.slice(a);return{type:t,sealed:p,iv:h}}function w1(o,r){const t=Po(o);return wf({type:os(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?sr(t.senderPublicKey,nr):void 0,receiverPublicKey:r?.receiverPublicKey})}function wf(o){const r=o?.type||vf;if(r===Gi){if(typeof o?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof o?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:r,senderPublicKey:o?.senderPublicKey,receiverPublicKey:o?.receiverPublicKey}}function rl(o){return o.type===Gi&&typeof o.senderPublicKey=="string"&&typeof o.receiverPublicKey=="string"}var b1=Object.defineProperty,il=Object.getOwnPropertySymbols,_1=Object.prototype.hasOwnProperty,E1=Object.prototype.propertyIsEnumerable,nl=(o,r,t)=>r in o?b1(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,sl=(o,r)=>{for(var t in r||(r={}))_1.call(r,t)&&nl(o,t,r[t]);if(il)for(var t of il(r))E1.call(r,t)&&nl(o,t,r[t]);return o};const I1="ReactNative",Er={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},x1="js";function Kc(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function En(){return!Jv()&&!!uf()&&navigator.product===I1}function In(){return!Kc()&&!!uf()}function as(){return En()?Er.reactNative:Kc()?Er.node:In()?Er.browser:Er.unknown}function S1(){var o;try{return En()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(o=global.Application)==null?void 0:o.applicationId:void 0}catch{return}}function P1(o,r){let t=rs.parse(o);return t=sl(sl({},t),r),o=rs.stringify(t),o}function O1(){return Gv()||{name:"",description:"",url:"",icons:[""]}}function C1(){if(as()===Er.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:n}=global.Platform;return[t,n].join("-")}const o=t1();if(o===null)return"unknown";const r=o.os?o.os.replace(" ","").toLowerCase():"unknown";return o.type==="browser"?[r,o.name,o.version].join("-"):[r,o.version].join("-")}function A1(){var o;const r=as();return r===Er.browser?[r,((o=Qv())==null?void 0:o.host)||"unknown"].join(":"):r}function N1(o,r,t){const n=C1(),a=A1();return[[o,r].join("-"),[x1,t].join("-"),n,a].join("/")}function R1({protocol:o,version:r,relayUrl:t,sdkVersion:n,auth:a,projectId:h,useOnCloseEvent:p,bundleId:g}){const w=t.split("?"),y=N1(o,r,n),b={auth:a,ua:y,projectId:h,useOnCloseEvent:p||void 0,origin:g||void 0},S=P1(w[1]||"",b);return w[0]+"?"+S}function Bi(o,r){return o.filter(t=>r.includes(t)).length===o.length}function bf(o){return Object.fromEntries(o.entries())}function _f(o){return new Map(Object.entries(o))}function vn(o=se.FIVE_MINUTES,r){const t=se.toMiliseconds(o||se.FIVE_MINUTES);let n,a,h;return{resolve:p=>{h&&n&&(clearTimeout(h),n(p))},reject:p=>{h&&a&&(clearTimeout(h),a(p))},done:()=>new Promise((p,g)=>{h=setTimeout(()=>{g(new Error(r))},t),n=p,a=g})}}function is(o,r,t){return new Promise(async(n,a)=>{const h=setTimeout(()=>a(new Error(t)),r);try{const p=await o;n(p)}catch(p){a(p)}clearTimeout(h)})}function Ef(o,r){if(typeof r=="string"&&r.startsWith(`${o}:`))return r;if(o.toLowerCase()==="topic"){if(typeof r!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${r}`}else if(o.toLowerCase()==="id"){if(typeof r!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${r}`}throw new Error(`Unknown expirer target type: ${o}`)}function T1(o){return Ef("topic",o)}function $1(o){return Ef("id",o)}function If(o){const[r,t]=o.split(":"),n={id:void 0,topic:void 0};if(r==="topic"&&typeof t=="string")n.topic=t;else if(r==="id"&&Number.isInteger(Number(t)))n.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${r}:${t}`);return n}function Ur(o,r){return se.fromMiliseconds((r||Date.now())+se.toMiliseconds(o))}function Pi(o){return Date.now()>=se.toMiliseconds(o)}function Ft(o,r){return`${o}${r?`:${r}`:""}`}function oc(o=[],r=[]){return[...new Set([...o,...r])]}async function F1({id:o,topic:r,wcDeepLink:t}){try{if(!t)return;let a=(typeof t=="string"?JSON.parse(t):t)?.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const h=`${a}/wc?requestId=${o}&sessionTopic=${r}`,p=as();p===Er.browser?h.startsWith("https://")?window.open(h,"_blank","noreferrer noopener"):window.open(h,"_self","noreferrer noopener"):p===Er.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(h)}catch(n){console.error(n)}}async function D1(o,r){try{return await o.getItem(r)||(In()?localStorage.getItem(r):void 0)}catch(t){console.error(t)}}const L1="irn";function Oc(o){return o?.relay||{protocol:L1}}function Eo(o){const r=a1[o];if(typeof r>"u")throw new Error(`Relay Protocol not supported: ${o}`);return r}var j1=Object.defineProperty,ol=Object.getOwnPropertySymbols,q1=Object.prototype.hasOwnProperty,M1=Object.prototype.propertyIsEnumerable,al=(o,r,t)=>r in o?j1(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,U1=(o,r)=>{for(var t in r||(r={}))q1.call(r,t)&&al(o,t,r[t]);if(ol)for(var t of ol(r))M1.call(r,t)&&al(o,t,r[t]);return o};function z1(o,r="-"){const t={},n="relay"+r;return Object.keys(o).forEach(a=>{if(a.startsWith(n)){const h=a.replace(n,""),p=o[a];t[h]=p}}),t}function cl(o){o=o.includes("wc://")?o.replace("wc://",""):o,o=o.includes("wc:")?o.replace("wc:",""):o;const r=o.indexOf(":"),t=o.indexOf("?")!==-1?o.indexOf("?"):void 0,n=o.substring(0,r),a=o.substring(r+1,t).split("@"),h=typeof t<"u"?o.substring(t):"",p=rs.parse(h);return{protocol:n,topic:k1(a[0]),version:parseInt(a[1],10),symKey:p.symKey,relay:z1(p)}}function k1(o){return o.startsWith("//")?o.substring(2):o}function H1(o,r="-"){const t="relay",n={};return Object.keys(o).forEach(a=>{const h=t+r+a;o[a]&&(n[h]=o[a])}),n}function K1(o){return`${o.protocol}:${o.topic}@${o.version}?`+rs.stringify(U1({symKey:o.symKey},H1(o.relay)))}function xn(o){const r=[];return o.forEach(t=>{const[n,a]=t.split(":");r.push(`${n}:${a}`)}),r}function V1(o){const r=[];return Object.values(o).forEach(t=>{r.push(...xn(t.accounts))}),r}function B1(o,r){const t=[];return Object.values(o).forEach(n=>{xn(n.accounts).includes(r)&&t.push(...n.methods)}),t}function G1(o,r){const t=[];return Object.values(o).forEach(n=>{xn(n.accounts).includes(r)&&t.push(...n.events)}),t}function W1(o,r){const t=Io(o,r);if(t)throw new Error(t.message);const n={};for(const[a,h]of Object.entries(o))n[a]={methods:h.methods,events:h.events,chains:h.accounts.map(p=>`${p.split(":")[0]}:${p.split(":")[1]}`)};return n}function Vc(o){return o.includes(":")}function Zn(o){return Vc(o)?o.split(":")[0]:o}const J1={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Q1={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Z(o,r){const{message:t,code:n}=Q1[o];return{message:r?`${t} ${r}`:t,code:n}}function It(o,r){const{message:t,code:n}=J1[o];return{message:r?`${t} ${r}`:t,code:n}}function Jr(o,r){return Array.isArray(o)?typeof r<"u"&&o.length?o.every(r):!0:!1}function _n(o){return Object.getPrototypeOf(o)===Object.prototype&&Object.keys(o).length}function ir(o){return typeof o>"u"}function kt(o,r){return r&&ir(o)?!0:typeof o=="string"&&!!o.trim().length}function Bc(o,r){return r&&ir(o)?!0:typeof o=="number"&&!isNaN(o)}function Y1(o,r){const{requiredNamespaces:t}=r,n=Object.keys(o.namespaces),a=Object.keys(t);let h=!0;return Bi(a,n)?(n.forEach(p=>{const{accounts:g,methods:w,events:y}=o.namespaces[p],b=xn(g),S=t[p];(!Bi(yf(p,S),b)||!Bi(S.methods,w)||!Bi(S.events,y))&&(h=!1)}),h):!1}function Oo(o){return kt(o,!1)&&o.includes(":")?o.split(":").length===2:!1}function Z1(o){if(kt(o,!1)&&o.includes(":")){const r=o.split(":");if(r.length===3){const t=r[0]+":"+r[1];return!!r[2]&&Oo(t)}}return!1}function X1(o){if(kt(o,!1))try{return typeof new URL(o)<"u"}catch{return!1}return!1}function ew(o){var r;return(r=o?.proposer)==null?void 0:r.publicKey}function tw(o){return o?.topic}function rw(o,r){let t=null;return kt(o?.publicKey,!1)||(t=Z("MISSING_OR_INVALID",`${r} controller public key should be a string`)),t}function ul(o){let r=!0;return Jr(o)?o.length&&(r=o.every(t=>kt(t,!1))):r=!1,r}function iw(o,r,t){let n=null;return Jr(r)&&r.length?r.forEach(a=>{n||Oo(a)||(n=It("UNSUPPORTED_CHAINS",`${t}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Oo(o)||(n=It("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function nw(o,r,t){let n=null;return Object.entries(o).forEach(([a,h])=>{if(n)return;const p=iw(a,yf(a,h),`${r} ${t}`);p&&(n=p)}),n}function sw(o,r){let t=null;return Jr(o)?o.forEach(n=>{t||Z1(n)||(t=It("UNSUPPORTED_ACCOUNTS",`${r}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):t=It("UNSUPPORTED_ACCOUNTS",`${r}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function ow(o,r){let t=null;return Object.values(o).forEach(n=>{if(t)return;const a=sw(n?.accounts,`${r} namespace`);a&&(t=a)}),t}function aw(o,r){let t=null;return ul(o?.methods)?ul(o?.events)||(t=It("UNSUPPORTED_EVENTS",`${r}, events should be an array of strings or empty array for no events`)):t=It("UNSUPPORTED_METHODS",`${r}, methods should be an array of strings or empty array for no methods`),t}function xf(o,r){let t=null;return Object.values(o).forEach(n=>{if(t)return;const a=aw(n,`${r}, namespace`);a&&(t=a)}),t}function cw(o,r,t){let n=null;if(o&&_n(o)){const a=xf(o,r);a&&(n=a);const h=nw(o,r,t);h&&(n=h)}else n=Z("MISSING_OR_INVALID",`${r}, ${t} should be an object with data`);return n}function Io(o,r){let t=null;if(o&&_n(o)){const n=xf(o,r);n&&(t=n);const a=ow(o,r);a&&(t=a)}else t=Z("MISSING_OR_INVALID",`${r}, namespaces should be an object with data`);return t}function Sf(o){return kt(o.protocol,!0)}function uw(o,r){let t=!1;return r&&!o?t=!0:o&&Jr(o)&&o.length&&o.forEach(n=>{t=Sf(n)}),t}function hw(o){return typeof o=="number"}function dr(o){return typeof o<"u"&&typeof o!==null}function lw(o){return!(!o||typeof o!="object"||!o.code||!Bc(o.code,!1)||!o.message||!kt(o.message,!1))}function fw(o){return!(ir(o)||!kt(o.method,!1))}function pw(o){return!(ir(o)||ir(o.result)&&ir(o.error)||!Bc(o.id,!1)||!kt(o.jsonrpc,!1))}function dw(o){return!(ir(o)||!kt(o.name,!1))}function hl(o,r){return!(!Oo(r)||!V1(o).includes(r))}function gw(o,r,t){return kt(t,!1)?B1(o,r).includes(t):!1}function yw(o,r,t){return kt(t,!1)?G1(o,r).includes(t):!1}function ll(o,r,t){let n=null;const a=mw(o),h=vw(r),p=Object.keys(a),g=Object.keys(h),w=fl(Object.keys(o)),y=fl(Object.keys(r)),b=w.filter(S=>!y.includes(S));return b.length&&(n=Z("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${b.toString()}
      Received: ${Object.keys(r).toString()}`)),Bi(p,g)||(n=Z("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${p.toString()}
      Approved: ${g.toString()}`)),Object.keys(r).forEach(S=>{if(!S.includes(":")||n)return;const N=xn(r[S].accounts);N.includes(S)||(n=Z("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${S}
        Required: ${S}
        Approved: ${N.toString()}`))}),p.forEach(S=>{n||(Bi(a[S].methods,h[S].methods)?Bi(a[S].events,h[S].events)||(n=Z("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${S}`)):n=Z("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${S}`))}),n}function mw(o){const r={};return Object.keys(o).forEach(t=>{var n;t.includes(":")?r[t]=o[t]:(n=o[t].chains)==null||n.forEach(a=>{r[a]={methods:o[t].methods,events:o[t].events}})}),r}function fl(o){return[...new Set(o.map(r=>r.includes(":")?r.split(":")[0]:r))]}function vw(o){const r={};return Object.keys(o).forEach(t=>{t.includes(":")?r[t]=o[t]:xn(o[t].accounts)?.forEach(a=>{r[a]={accounts:o[t].accounts.filter(h=>h.includes(`${a}:`)),methods:o[t].methods,events:o[t].events}})}),r}function ww(o,r){return Bc(o,!1)&&o<=r.max&&o>=r.min}function pl(){const o=as();return new Promise(r=>{switch(o){case Er.browser:r(bw());break;case Er.reactNative:r(_w());break;case Er.node:r(Ew());break;default:r(!0)}})}function bw(){return In()&&navigator?.onLine}async function _w(){return En()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function Ew(){return!0}function Iw(o){switch(as()){case Er.browser:xw(o);break;case Er.reactNative:Sw(o);break}}function xw(o){!En()&&In()&&(window.addEventListener("online",()=>o(!0)),window.addEventListener("offline",()=>o(!1)))}function Sw(o){En()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(r=>o(r?.isConnected))}const ac={};let yo=class{static get(r){return ac[r]}static set(r,t){ac[r]=t}static delete(r){delete ac[r]}};const Pw=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Ow=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Cw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Aw(o,r){if(o==="__proto__"||o==="constructor"&&r&&typeof r=="object"&&"prototype"in r){Nw(o);return}return r}function Nw(o){console.warn(`[destr] Dropping "${o}" key to prevent prototype pollution.`)}function mo(o,r={}){if(typeof o!="string")return o;const t=o.trim();if(o[0]==='"'&&o.at(-1)==='"'&&!o.includes("\\"))return t.slice(1,-1);if(t.length<=9){const n=t.toLowerCase();if(n==="true")return!0;if(n==="false")return!1;if(n==="undefined")return;if(n==="null")return null;if(n==="nan")return Number.NaN;if(n==="infinity")return Number.POSITIVE_INFINITY;if(n==="-infinity")return Number.NEGATIVE_INFINITY}if(!Cw.test(o)){if(r.strict)throw new SyntaxError("[destr] Invalid JSON");return o}try{if(Pw.test(o)||Ow.test(o)){if(r.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(o,Aw)}return JSON.parse(o)}catch(n){if(r.strict)throw n;return o}}function Rw(o){return!o||typeof o.then!="function"?Promise.resolve(o):o}function zt(o,...r){try{return Rw(o(...r))}catch(t){return Promise.reject(t)}}function Tw(o){const r=typeof o;return o===null||r!=="object"&&r!=="function"}function $w(o){const r=Object.getPrototypeOf(o);return!r||r.isPrototypeOf(Object)}function xo(o){if(Tw(o))return String(o);if($w(o)||Array.isArray(o))return JSON.stringify(o);if(typeof o.toJSON=="function")return xo(o.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Pf(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const Cc="base64:";function Fw(o){if(typeof o=="string")return o;Pf();const r=Buffer.from(o).toString("base64");return Cc+r}function Dw(o){return typeof o!="string"||!o.startsWith(Cc)?o:(Pf(),Buffer.from(o.slice(Cc.length),"base64"))}function pr(o){return o?o.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function Lw(...o){return pr(o.join(":"))}function vo(o){return o=pr(o),o?o+":":""}const jw="memory",qw=()=>{const o=new Map;return{name:jw,options:{},hasItem(r){return o.has(r)},getItem(r){return o.get(r)??null},getItemRaw(r){return o.get(r)??null},setItem(r,t){o.set(r,t)},setItemRaw(r,t){o.set(r,t)},removeItem(r){o.delete(r)},getKeys(){return Array.from(o.keys())},clear(){o.clear()},dispose(){o.clear()}}};function Mw(o={}){const r={mounts:{"":o.driver||qw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=y=>{for(const b of r.mountpoints)if(y.startsWith(b))return{base:b,relativeKey:y.slice(b.length),driver:r.mounts[b]};return{base:"",relativeKey:y,driver:r.mounts[""]}},n=(y,b)=>r.mountpoints.filter(S=>S.startsWith(y)||b&&y.startsWith(S)).map(S=>({relativeBase:y.length>S.length?y.slice(S.length):void 0,mountpoint:S,driver:r.mounts[S]})),a=(y,b)=>{if(r.watching){b=pr(b);for(const S of r.watchListeners)S(y,b)}},h=async()=>{if(!r.watching){r.watching=!0;for(const y in r.mounts)r.unwatch[y]=await dl(r.mounts[y],a,y)}},p=async()=>{if(r.watching){for(const y in r.unwatch)await r.unwatch[y]();r.unwatch={},r.watching=!1}},g=(y,b,S)=>{const N=new Map,K=j=>{let J=N.get(j.base);return J||(J={driver:j.driver,base:j.base,items:[]},N.set(j.base,J)),J};for(const j of y){const J=typeof j=="string",oe=pr(J?j:j.key),fe=J?void 0:j.value,C=J||!j.options?b:{...b,...j.options},$=t(oe);K($).items.push({key:oe,value:fe,relativeKey:$.relativeKey,options:C})}return Promise.all([...N.values()].map(j=>S(j))).then(j=>j.flat())},w={hasItem(y,b={}){y=pr(y);const{relativeKey:S,driver:N}=t(y);return zt(N.hasItem,S,b)},getItem(y,b={}){y=pr(y);const{relativeKey:S,driver:N}=t(y);return zt(N.getItem,S,b).then(K=>mo(K))},getItems(y,b){return g(y,b,S=>S.driver.getItems?zt(S.driver.getItems,S.items.map(N=>({key:N.relativeKey,options:N.options})),b).then(N=>N.map(K=>({key:Lw(S.base,K.key),value:mo(K.value)}))):Promise.all(S.items.map(N=>zt(S.driver.getItem,N.relativeKey,N.options).then(K=>({key:N.key,value:mo(K)})))))},getItemRaw(y,b={}){y=pr(y);const{relativeKey:S,driver:N}=t(y);return N.getItemRaw?zt(N.getItemRaw,S,b):zt(N.getItem,S,b).then(K=>Dw(K))},async setItem(y,b,S={}){if(b===void 0)return w.removeItem(y);y=pr(y);const{relativeKey:N,driver:K}=t(y);K.setItem&&(await zt(K.setItem,N,xo(b),S),K.watch||a("update",y))},async setItems(y,b){await g(y,b,async S=>{S.driver.setItems&&await zt(S.driver.setItems,S.items.map(N=>({key:N.relativeKey,value:xo(N.value),options:N.options})),b),S.driver.setItem&&await Promise.all(S.items.map(N=>zt(S.driver.setItem,N.relativeKey,xo(N.value),N.options)))})},async setItemRaw(y,b,S={}){if(b===void 0)return w.removeItem(y,S);y=pr(y);const{relativeKey:N,driver:K}=t(y);if(K.setItemRaw)await zt(K.setItemRaw,N,b,S);else if(K.setItem)await zt(K.setItem,N,Fw(b),S);else return;K.watch||a("update",y)},async removeItem(y,b={}){typeof b=="boolean"&&(b={removeMeta:b}),y=pr(y);const{relativeKey:S,driver:N}=t(y);N.removeItem&&(await zt(N.removeItem,S,b),(b.removeMeta||b.removeMata)&&await zt(N.removeItem,S+"$",b),N.watch||a("remove",y))},async getMeta(y,b={}){typeof b=="boolean"&&(b={nativeOnly:b}),y=pr(y);const{relativeKey:S,driver:N}=t(y),K=Object.create(null);if(N.getMeta&&Object.assign(K,await zt(N.getMeta,S,b)),!b.nativeOnly){const j=await zt(N.getItem,S+"$",b).then(J=>mo(J));j&&typeof j=="object"&&(typeof j.atime=="string"&&(j.atime=new Date(j.atime)),typeof j.mtime=="string"&&(j.mtime=new Date(j.mtime)),Object.assign(K,j))}return K},setMeta(y,b,S={}){return this.setItem(y+"$",b,S)},removeMeta(y,b={}){return this.removeItem(y+"$",b)},async getKeys(y,b={}){y=vo(y);const S=n(y,!0);let N=[];const K=[];for(const j of S){const oe=(await zt(j.driver.getKeys,j.relativeBase,b)).map(fe=>j.mountpoint+pr(fe)).filter(fe=>!N.some(C=>fe.startsWith(C)));K.push(...oe),N=[j.mountpoint,...N.filter(fe=>!fe.startsWith(j.mountpoint))]}return y?K.filter(j=>j.startsWith(y)&&!j.endsWith("$")):K.filter(j=>!j.endsWith("$"))},async clear(y,b={}){y=vo(y),await Promise.all(n(y,!1).map(async S=>{if(S.driver.clear)return zt(S.driver.clear,S.relativeBase,b);if(S.driver.removeItem){const N=await S.driver.getKeys(S.relativeBase||"",b);return Promise.all(N.map(K=>S.driver.removeItem(K,b)))}}))},async dispose(){await Promise.all(Object.values(r.mounts).map(y=>gl(y)))},async watch(y){return await h(),r.watchListeners.push(y),async()=>{r.watchListeners=r.watchListeners.filter(b=>b!==y),r.watchListeners.length===0&&await p()}},async unwatch(){r.watchListeners=[],await p()},mount(y,b){if(y=vo(y),y&&r.mounts[y])throw new Error(`already mounted at ${y}`);return y&&(r.mountpoints.push(y),r.mountpoints.sort((S,N)=>N.length-S.length)),r.mounts[y]=b,r.watching&&Promise.resolve(dl(b,a,y)).then(S=>{r.unwatch[y]=S}).catch(console.error),w},async unmount(y,b=!0){y=vo(y),!(!y||!r.mounts[y])&&(r.watching&&y in r.unwatch&&(r.unwatch[y](),delete r.unwatch[y]),b&&await gl(r.mounts[y]),r.mountpoints=r.mountpoints.filter(S=>S!==y),delete r.mounts[y])},getMount(y=""){y=pr(y)+":";const b=t(y);return{driver:b.driver,base:b.base}},getMounts(y="",b={}){return y=pr(y),n(y,b.parents).map(N=>({driver:N.driver,base:N.mountpoint}))}};return w}function dl(o,r,t){return o.watch?o.watch((n,a)=>r(n,t+a)):()=>{}}async function gl(o){typeof o.dispose=="function"&&await zt(o.dispose)}function Wi(o){return new Promise((r,t)=>{o.oncomplete=o.onsuccess=()=>r(o.result),o.onabort=o.onerror=()=>t(o.error)})}function Of(o,r){const t=indexedDB.open(o);t.onupgradeneeded=()=>t.result.createObjectStore(r);const n=Wi(t);return(a,h)=>n.then(p=>h(p.transaction(r,a).objectStore(r)))}let cc;function cs(){return cc||(cc=Of("keyval-store","keyval")),cc}function yl(o,r=cs()){return r("readonly",t=>Wi(t.get(o)))}function Uw(o,r,t=cs()){return t("readwrite",n=>(n.put(r,o),Wi(n.transaction)))}function zw(o,r=cs()){return r("readwrite",t=>(t.delete(o),Wi(t.transaction)))}function kw(o=cs()){return o("readwrite",r=>(r.clear(),Wi(r.transaction)))}function Hw(o,r){return o.openCursor().onsuccess=function(){this.result&&(r(this.result),this.result.continue())},Wi(o.transaction)}function Kw(o=cs()){return o("readonly",r=>{if(r.getAllKeys)return Wi(r.getAllKeys());const t=[];return Hw(r,n=>t.push(n.key)).then(()=>t)})}const Vw="idb-keyval";var Bw=(o={})=>{const r=o.base&&o.base.length>0?`${o.base}:`:"",t=a=>r+a;let n;return o.dbName&&o.storeName&&(n=Of(o.dbName,o.storeName)),{name:Vw,options:o,async hasItem(a){return!(typeof await yl(t(a),n)>"u")},async getItem(a){return await yl(t(a),n)??null},setItem(a,h){return Uw(t(a),h,n)},removeItem(a){return zw(t(a),n)},getKeys(){return Kw(n)},clear(){return kw(n)}}};const Gw="WALLET_CONNECT_V2_INDEXED_DB",Ww="keyvaluestorage";let Jw=class{constructor(){this.indexedDb=Mw({driver:Bw({dbName:Gw,storeName:Ww})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(r=>[r.key,r.value])}async getItem(r){const t=await this.indexedDb.getItem(r);if(t!==null)return t}async setItem(r,t){await this.indexedDb.setItem(r,ss(t))}async removeItem(r){await this.indexedDb.removeItem(r)}};var uc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},So={exports:{}};(function(){let o;function r(){}o=r,o.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},o.prototype.setItem=function(t,n){this[t]=String(n)},o.prototype.removeItem=function(t){delete this[t]},o.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(n){t[n]=void 0,delete t[n]})},o.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof uc<"u"&&uc.localStorage?So.exports=uc.localStorage:typeof window<"u"&&window.localStorage?So.exports=window.localStorage:So.exports=new r})();function Qw(o){var r;return[o[0],To((r=o[1])!=null?r:"")]}class Yw{constructor(){this.localStorage=So.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Qw)}async getItem(r){const t=this.localStorage.getItem(r);if(t!==null)return To(t)}async setItem(r,t){this.localStorage.setItem(r,ss(t))}async removeItem(r){this.localStorage.removeItem(r)}}const Zw="wc_storage_version",ml=1,Xw=async(o,r,t)=>{const n=Zw,a=await r.getItem(n);if(a&&a>=ml){t(r);return}const h=await o.getKeys();if(!h.length){t(r);return}const p=[];for(;h.length;){const g=h.shift();if(!g)continue;const w=g.toLowerCase();if(w.includes("wc@")||w.includes("walletconnect")||w.includes("wc_")||w.includes("wallet_connect")){const y=await o.getItem(g);await r.setItem(g,y),p.push(g)}}await r.setItem(n,ml),t(r),eb(o,p)},eb=async(o,r)=>{r.length&&r.forEach(async t=>{await o.removeItem(t)})};let tb=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const r=new Yw;this.storage=r;try{const t=new Jw;Xw(r,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(r){return await this.initialize(),this.storage.getItem(r)}async setItem(r,t){return await this.initialize(),this.storage.setItem(r,t)}async removeItem(r){return await this.initialize(),this.storage.removeItem(r)}async initialize(){this.initialized||await new Promise(r=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),r())},20)})}};var Sn={},Vn={},hc={},Bn={};class Ji{}const rb=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Ji},Symbol.toStringTag,{value:"Module"})),ib=Yv(rb);var vl;function nb(){if(vl)return Bn;vl=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.IHeartBeat=void 0;const o=ib;class r extends o.IEvents{constructor(n){super()}}return Bn.IHeartBeat=r,Bn}var wl;function Cf(){return wl||(wl=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),ns.__exportStar(nb(),o)}(hc)),hc}var lc={},Ki={},bl;function sb(){if(bl)return Ki;bl=1,Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.HEARTBEAT_EVENTS=Ki.HEARTBEAT_INTERVAL=void 0;const o=se;return Ki.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,Ki.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ki}var _l;function Af(){return _l||(_l=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),ns.__exportStar(sb(),o)}(lc)),lc}var El;function ob(){if(El)return Vn;El=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.HeartBeat=void 0;const o=ns,r=Qr,t=se,n=Cf(),a=Af();class h extends n.IHeartBeat{constructor(g){super(g),this.events=new r.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=g?.interval||a.HEARTBEAT_INTERVAL}static init(g){return o.__awaiter(this,void 0,void 0,function*(){const w=new h(g);return yield w.init(),w})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,w){this.events.on(g,w)}once(g,w){this.events.once(g,w)}off(g,w){this.events.off(g,w)}removeListener(g,w){this.events.removeListener(g,w)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Vn.HeartBeat=h,Vn}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const r=ns;r.__exportStar(ob(),o),r.__exportStar(Cf(),o),r.__exportStar(Af(),o)})(Sn);var Ce={},fc,Il;function ab(){if(Il)return fc;Il=1;function o(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}fc=r;function r(t,n,a){var h=a&&a.stringify||o,p=1;if(typeof t=="object"&&t!==null){var g=n.length+p;if(g===1)return t;var w=new Array(g);w[0]=h(t);for(var y=1;y<g;y++)w[y]=h(n[y]);return w.join(" ")}if(typeof t!="string")return t;var b=n.length;if(b===0)return t;for(var S="",N=1-p,K=-1,j=t&&t.length||0,J=0;J<j;){if(t.charCodeAt(J)===37&&J+1<j){switch(K=K>-1?K:0,t.charCodeAt(J+1)){case 100:case 102:if(N>=b||n[N]==null)break;K<J&&(S+=t.slice(K,J)),S+=Number(n[N]),K=J+2,J++;break;case 105:if(N>=b||n[N]==null)break;K<J&&(S+=t.slice(K,J)),S+=Math.floor(Number(n[N])),K=J+2,J++;break;case 79:case 111:case 106:if(N>=b||n[N]===void 0)break;K<J&&(S+=t.slice(K,J));var oe=typeof n[N];if(oe==="string"){S+="'"+n[N]+"'",K=J+2,J++;break}if(oe==="function"){S+=n[N].name||"<anonymous>",K=J+2,J++;break}S+=h(n[N]),K=J+2,J++;break;case 115:if(N>=b)break;K<J&&(S+=t.slice(K,J)),S+=String(n[N]),K=J+2,J++;break;case 37:K<J&&(S+=t.slice(K,J)),S+="%",K=J+2,J++,N--;break}++N}++J}return K===-1?t:(K<j&&(S+=t.slice(K)),S)}return fc}var pc,xl;function cb(){if(xl)return pc;xl=1;const o=ab();pc=a;const r=q().console||{},t={mapHttpRequest:j,mapHttpResponse:j,wrapRequestSerializer:J,wrapResponseSerializer:J,wrapErrorSerializer:J,req:j,res:j,err:N};function n(I,D){return Array.isArray(I)?I.filter(function(ce){return ce!=="!stdSerializers.err"}):I===!0?Object.keys(D):!1}function a(I){I=I||{},I.browser=I.browser||{};const D=I.browser.transmit;if(D&&typeof D.send!="function")throw Error("pino: transmit option must have a send function");const H=I.browser.write||r;I.browser.write&&(I.browser.asObject=!0);const ce=I.serializers||{},ae=n(I.browser.serialize,ce);let Ee=I.browser.serialize;Array.isArray(I.browser.serialize)&&I.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Ae=["error","fatal","warn","info","debug","trace"];typeof H=="function"&&(H.error=H.fatal=H.warn=H.info=H.debug=H.trace=H),I.enabled===!1&&(I.level="silent");const et=I.level||"info",T=Object.create(H);T.log||(T.log=oe),Object.defineProperty(T,"levelVal",{get:Me}),Object.defineProperty(T,"level",{get:Ne,set:ee});const V={transmit:D,serialize:ae,asObject:I.browser.asObject,levels:Ae,timestamp:K(I)};T.levels=a.levels,T.level=et,T.setMaxListeners=T.getMaxListeners=T.emit=T.addListener=T.on=T.prependListener=T.once=T.prependOnceListener=T.removeListener=T.removeAllListeners=T.listeners=T.listenerCount=T.eventNames=T.write=T.flush=oe,T.serializers=ce,T._serialize=ae,T._stdErrSerialize=Ee,T.child=Q,D&&(T._logEvent=S());function Me(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Ne(){return this._level}function ee(W){if(W!=="silent"&&!this.levels.values[W])throw Error("unknown level "+W);this._level=W,h(V,T,"error","log"),h(V,T,"fatal","error"),h(V,T,"warn","error"),h(V,T,"info","log"),h(V,T,"debug","log"),h(V,T,"trace","log")}function Q(W,Y){if(!W)throw new Error("missing bindings for child Pino");Y=Y||{},ae&&W.serializers&&(Y.serializers=W.serializers);const ut=Y.serializers;if(ae&&ut){var ke=Object.assign({},ce,ut),zr=I.browser.serialize===!0?Object.keys(ke):ae;delete W.serializers,w([W],zr,ke,this._stdErrSerialize)}function be(xt){this._childLevel=(xt._childLevel|0)+1,this.error=y(xt,W,"error"),this.fatal=y(xt,W,"fatal"),this.warn=y(xt,W,"warn"),this.info=y(xt,W,"info"),this.debug=y(xt,W,"debug"),this.trace=y(xt,W,"trace"),ke&&(this.serializers=ke,this._serialize=zr),D&&(this._logEvent=S([].concat(xt._logEvent.bindings,W)))}return be.prototype=this,new be(this)}return T}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=t,a.stdTimeFunctions=Object.assign({},{nullTime:fe,epochTime:C,unixTime:$,isoTime:M});function h(I,D,H,ce){const ae=Object.getPrototypeOf(D);D[H]=D.levelVal>D.levels.values[H]?oe:ae[H]?ae[H]:r[H]||r[ce]||oe,p(I,D,H)}function p(I,D,H){!I.transmit&&D[H]===oe||(D[H]=function(ce){return function(){const Ee=I.timestamp(),Ae=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===r?r:this;for(var T=0;T<Ae.length;T++)Ae[T]=arguments[T];if(I.serialize&&!I.asObject&&w(Ae,this._serialize,this.serializers,this._stdErrSerialize),I.asObject?ce.call(et,g(this,H,Ae,Ee)):ce.apply(et,Ae),I.transmit){const V=I.transmit.level||D.level,Me=a.levels.values[V],Ne=a.levels.values[H];if(Ne<Me)return;b(this,{ts:Ee,methodLevel:H,methodValue:Ne,transmitLevel:V,transmitValue:a.levels.values[I.transmit.level||D.level],send:I.transmit.send,val:D.levelVal},Ae)}}}(D[H]))}function g(I,D,H,ce){I._serialize&&w(H,I._serialize,I.serializers,I._stdErrSerialize);const ae=H.slice();let Ee=ae[0];const Ae={};ce&&(Ae.time=ce),Ae.level=a.levels.values[D];let et=(I._childLevel|0)+1;if(et<1&&(et=1),Ee!==null&&typeof Ee=="object"){for(;et--&&typeof ae[0]=="object";)Object.assign(Ae,ae.shift());Ee=ae.length?o(ae.shift(),ae):void 0}else typeof Ee=="string"&&(Ee=o(ae.shift(),ae));return Ee!==void 0&&(Ae.msg=Ee),Ae}function w(I,D,H,ce){for(const ae in I)if(ce&&I[ae]instanceof Error)I[ae]=a.stdSerializers.err(I[ae]);else if(typeof I[ae]=="object"&&!Array.isArray(I[ae]))for(const Ee in I[ae])D&&D.indexOf(Ee)>-1&&Ee in H&&(I[ae][Ee]=H[Ee](I[ae][Ee]))}function y(I,D,H){return function(){const ce=new Array(1+arguments.length);ce[0]=D;for(var ae=1;ae<ce.length;ae++)ce[ae]=arguments[ae-1];return I[H].apply(this,ce)}}function b(I,D,H){const ce=D.send,ae=D.ts,Ee=D.methodLevel,Ae=D.methodValue,et=D.val,T=I._logEvent.bindings;w(H,I._serialize||Object.keys(I.serializers),I.serializers,I._stdErrSerialize===void 0?!0:I._stdErrSerialize),I._logEvent.ts=ae,I._logEvent.messages=H.filter(function(V){return T.indexOf(V)===-1}),I._logEvent.level.label=Ee,I._logEvent.level.value=Ae,ce(Ee,I._logEvent,et),I._logEvent=S(T)}function S(I){return{ts:0,messages:[],bindings:I||[],level:{label:"",value:0}}}function N(I){const D={type:I.constructor.name,msg:I.message,stack:I.stack};for(const H in I)D[H]===void 0&&(D[H]=I[H]);return D}function K(I){return typeof I.timestamp=="function"?I.timestamp:I.timestamp===!1?fe:C}function j(){return{}}function J(I){return I}function oe(){}function fe(){return!1}function C(){return Date.now()}function $(){return Math.round(Date.now()/1e3)}function M(){return new Date(Date.now()).toISOString()}function q(){function I(D){return typeof D<"u"&&D}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return I(self)||I(window)||I(this)||{}}}return pc}var Vi={},Sl;function Nf(){return Sl||(Sl=1,Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.PINO_CUSTOM_CONTEXT_KEY=Vi.PINO_LOGGER_DEFAULTS=void 0,Vi.PINO_LOGGER_DEFAULTS={level:"info"},Vi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Vi}var rr={},Pl;function ub(){if(Pl)return rr;Pl=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.generateChildLogger=rr.formatChildLoggerContext=rr.getLoggerContext=rr.setBrowserLoggerContext=rr.getBrowserLoggerContext=rr.getDefaultLoggerOptions=void 0;const o=Nf();function r(g){return Object.assign(Object.assign({},g),{level:g?.level||o.PINO_LOGGER_DEFAULTS.level})}rr.getDefaultLoggerOptions=r;function t(g,w=o.PINO_CUSTOM_CONTEXT_KEY){return g[w]||""}rr.getBrowserLoggerContext=t;function n(g,w,y=o.PINO_CUSTOM_CONTEXT_KEY){return g[y]=w,g}rr.setBrowserLoggerContext=n;function a(g,w=o.PINO_CUSTOM_CONTEXT_KEY){let y="";return typeof g.bindings>"u"?y=t(g,w):y=g.bindings().context||"",y}rr.getLoggerContext=a;function h(g,w,y=o.PINO_CUSTOM_CONTEXT_KEY){const b=a(g,y);return b.trim()?`${b}/${w}`:w}rr.formatChildLoggerContext=h;function p(g,w,y=o.PINO_CUSTOM_CONTEXT_KEY){const b=h(g,w,y),S=g.child({context:b});return n(S,b,y)}return rr.generateChildLogger=p,rr}(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.pino=void 0;const r=ns,t=r.__importDefault(cb());Object.defineProperty(o,"pino",{enumerable:!0,get:function(){return t.default}}),r.__exportStar(Nf(),o),r.__exportStar(ub(),o)})(Ce);class hb extends Ji{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}let lb=class extends Ji{constructor(r,t){super(),this.core=r,this.logger=t,this.records=new Map}},fb=class{constructor(r,t){this.logger=r,this.core=t}},pb=class extends Ji{constructor(r,t){super(),this.relayer=r,this.logger=t}},db=class extends Ji{constructor(r){super()}},gb=class{constructor(r,t,n,a){this.core=r,this.logger=t,this.name=n}};class yb extends Ji{constructor(r,t){super(),this.relayer=r,this.logger=t}}let mb=class extends Ji{constructor(r,t){super(),this.core=r,this.logger=t}},vb=class{constructor(r,t){this.projectId=r,this.logger=t}},wb=class{constructor(r){this.opts=r,this.protocol="wc",this.version=2}},bb=class{constructor(r){this.client=r}};var Gc={},Rf={};(function(o){Object.defineProperty(o,"__esModule",{value:!0});var r=Zv,t=ff;o.DIGEST_LENGTH=64,o.BLOCK_SIZE=128;var n=function(){function g(){this.digestLength=o.DIGEST_LENGTH,this.blockSize=o.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},g.prototype.update=function(w,y){if(y===void 0&&(y=w.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var b=0;if(this._bytesHashed+=y,this._bufferLength>0){for(;this._bufferLength<o.BLOCK_SIZE&&y>0;)this._buffer[this._bufferLength++]=w[b++],y--;this._bufferLength===this.blockSize&&(h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(y>=this.blockSize&&(b=h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,w,b,y),y%=this.blockSize);y>0;)this._buffer[this._bufferLength++]=w[b++],y--;return this},g.prototype.finish=function(w){if(!this._finished){var y=this._bytesHashed,b=this._bufferLength,S=y/536870912|0,N=y<<3,K=y%128<112?128:256;this._buffer[b]=128;for(var j=b+1;j<K-8;j++)this._buffer[j]=0;r.writeUint32BE(S,this._buffer,K-8),r.writeUint32BE(N,this._buffer,K-4),h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,K),this._finished=!0}for(var j=0;j<this.digestLength/8;j++)r.writeUint32BE(this._stateHi[j],w,j*8),r.writeUint32BE(this._stateLo[j],w,j*8+4);return this},g.prototype.digest=function(){var w=new Uint8Array(this.digestLength);return this.finish(w),w},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(w){return this._stateHi.set(w.stateHi),this._stateLo.set(w.stateLo),this._bufferLength=w.bufferLength,w.buffer&&this._buffer.set(w.buffer),this._bytesHashed=w.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(w){t.wipe(w.stateHi),t.wipe(w.stateLo),w.buffer&&t.wipe(w.buffer),w.bufferLength=0,w.bytesHashed=0},g}();o.SHA512=n;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function h(g,w,y,b,S,N,K){for(var j=y[0],J=y[1],oe=y[2],fe=y[3],C=y[4],$=y[5],M=y[6],q=y[7],I=b[0],D=b[1],H=b[2],ce=b[3],ae=b[4],Ee=b[5],Ae=b[6],et=b[7],T,V,Me,Ne,ee,Q,W,Y;K>=128;){for(var ut=0;ut<16;ut++){var ke=8*ut+N;g[ut]=r.readUint32BE(S,ke),w[ut]=r.readUint32BE(S,ke+4)}for(var ut=0;ut<80;ut++){var zr=j,be=J,xt=oe,L=fe,F=C,A=$,u=M,E=q,ie=I,pe=D,ve=H,Re=ce,$e=ae,xe=Ee,St=Ae,vt=et;if(T=q,V=et,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=(C>>>14|ae<<32-14)^(C>>>18|ae<<32-18)^(ae>>>41-32|C<<32-(41-32)),V=(ae>>>14|C<<32-14)^(ae>>>18|C<<32-18)^(C>>>41-32|ae<<32-(41-32)),ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,T=C&$^~C&M,V=ae&Ee^~ae&Ae,ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,T=a[ut*2],V=a[ut*2+1],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,T=g[ut%16],V=w[ut%16],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,Me=W&65535|Y<<16,Ne=ee&65535|Q<<16,T=Me,V=Ne,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=(j>>>28|I<<32-28)^(I>>>34-32|j<<32-(34-32))^(I>>>39-32|j<<32-(39-32)),V=(I>>>28|j<<32-28)^(j>>>34-32|I<<32-(34-32))^(j>>>39-32|I<<32-(39-32)),ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,T=j&J^j&oe^J&oe,V=I&D^I&H^D&H,ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,E=W&65535|Y<<16,vt=ee&65535|Q<<16,T=L,V=Re,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=Me,V=Ne,ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,L=W&65535|Y<<16,Re=ee&65535|Q<<16,J=zr,oe=be,fe=xt,C=L,$=F,M=A,q=u,j=E,D=ie,H=pe,ce=ve,ae=Re,Ee=$e,Ae=xe,et=St,I=vt,ut%16===15)for(var ke=0;ke<16;ke++)T=g[ke],V=w[ke],ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=g[(ke+9)%16],V=w[(ke+9)%16],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Me=g[(ke+1)%16],Ne=w[(ke+1)%16],T=(Me>>>1|Ne<<32-1)^(Me>>>8|Ne<<32-8)^Me>>>7,V=(Ne>>>1|Me<<32-1)^(Ne>>>8|Me<<32-8)^(Ne>>>7|Me<<32-7),ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Me=g[(ke+14)%16],Ne=w[(ke+14)%16],T=(Me>>>19|Ne<<32-19)^(Ne>>>61-32|Me<<32-(61-32))^Me>>>6,V=(Ne>>>19|Me<<32-19)^(Me>>>61-32|Ne<<32-(61-32))^(Ne>>>6|Me<<32-6),ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,g[ke]=W&65535|Y<<16,w[ke]=ee&65535|Q<<16}T=j,V=I,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[0],V=b[0],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[0]=j=W&65535|Y<<16,b[0]=I=ee&65535|Q<<16,T=J,V=D,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[1],V=b[1],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[1]=J=W&65535|Y<<16,b[1]=D=ee&65535|Q<<16,T=oe,V=H,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[2],V=b[2],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[2]=oe=W&65535|Y<<16,b[2]=H=ee&65535|Q<<16,T=fe,V=ce,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[3],V=b[3],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[3]=fe=W&65535|Y<<16,b[3]=ce=ee&65535|Q<<16,T=C,V=ae,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[4],V=b[4],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[4]=C=W&65535|Y<<16,b[4]=ae=ee&65535|Q<<16,T=$,V=Ee,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[5],V=b[5],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[5]=$=W&65535|Y<<16,b[5]=Ee=ee&65535|Q<<16,T=M,V=Ae,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[6],V=b[6],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[6]=M=W&65535|Y<<16,b[6]=Ae=ee&65535|Q<<16,T=q,V=et,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[7],V=b[7],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[7]=q=W&65535|Y<<16,b[7]=et=ee&65535|Q<<16,N+=128,K-=128}return N}function p(g){var w=new n;w.update(g);var y=w.digest();return w.clean(),y}o.hash=p})(Rf);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.convertSecretKeyToX25519=o.convertPublicKeyToX25519=o.verify=o.sign=o.extractPublicKeyFromSecretKey=o.generateKeyPair=o.generateKeyPairFromSeed=o.SEED_LENGTH=o.SECRET_KEY_LENGTH=o.PUBLIC_KEY_LENGTH=o.SIGNATURE_LENGTH=void 0;const r=Ro,t=Rf,n=ff;o.SIGNATURE_LENGTH=64,o.PUBLIC_KEY_LENGTH=32,o.SECRET_KEY_LENGTH=64,o.SEED_LENGTH=32;function a(L){const F=new Float64Array(16);if(L)for(let A=0;A<L.length;A++)F[A]=L[A];return F}const h=new Uint8Array(32);h[0]=9;const p=a(),g=a([1]),w=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),y=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),b=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),S=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),N=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function K(L,F){for(let A=0;A<16;A++)L[A]=F[A]|0}function j(L){let F=1;for(let A=0;A<16;A++){let u=L[A]+F+65535;F=Math.floor(u/65536),L[A]=u-F*65536}L[0]+=F-1+37*(F-1)}function J(L,F,A){const u=~(A-1);for(let E=0;E<16;E++){const ie=u&(L[E]^F[E]);L[E]^=ie,F[E]^=ie}}function oe(L,F){const A=a(),u=a();for(let E=0;E<16;E++)u[E]=F[E];j(u),j(u),j(u);for(let E=0;E<2;E++){A[0]=u[0]-65517;for(let pe=1;pe<15;pe++)A[pe]=u[pe]-65535-(A[pe-1]>>16&1),A[pe-1]&=65535;A[15]=u[15]-32767-(A[14]>>16&1);const ie=A[15]>>16&1;A[14]&=65535,J(u,A,1-ie)}for(let E=0;E<16;E++)L[2*E]=u[E]&255,L[2*E+1]=u[E]>>8}function fe(L,F){let A=0;for(let u=0;u<32;u++)A|=L[u]^F[u];return(1&A-1>>>8)-1}function C(L,F){const A=new Uint8Array(32),u=new Uint8Array(32);return oe(A,L),oe(u,F),fe(A,u)}function $(L){const F=new Uint8Array(32);return oe(F,L),F[0]&1}function M(L,F){for(let A=0;A<16;A++)L[A]=F[2*A]+(F[2*A+1]<<8);L[15]&=32767}function q(L,F,A){for(let u=0;u<16;u++)L[u]=F[u]+A[u]}function I(L,F,A){for(let u=0;u<16;u++)L[u]=F[u]-A[u]}function D(L,F,A){let u,E,ie=0,pe=0,ve=0,Re=0,$e=0,xe=0,St=0,vt=0,st=0,De=0,Je=0,Qe=0,ot=0,Ue=0,Ye=0,Te=0,He=0,ht=0,je=0,Pt=0,Dt=0,Ht=0,Kt=0,qt=0,Qt=0,or=0,kr=0,Yt=0,Yr=0,di=0,Ni=0,lt=A[0],tt=A[1],ft=A[2],pt=A[3],at=A[4],rt=A[5],Ot=A[6],Ct=A[7],dt=A[8],At=A[9],gt=A[10],wt=A[11],yt=A[12],We=A[13],Nt=A[14],Rt=A[15];u=F[0],ie+=u*lt,pe+=u*tt,ve+=u*ft,Re+=u*pt,$e+=u*at,xe+=u*rt,St+=u*Ot,vt+=u*Ct,st+=u*dt,De+=u*At,Je+=u*gt,Qe+=u*wt,ot+=u*yt,Ue+=u*We,Ye+=u*Nt,Te+=u*Rt,u=F[1],pe+=u*lt,ve+=u*tt,Re+=u*ft,$e+=u*pt,xe+=u*at,St+=u*rt,vt+=u*Ot,st+=u*Ct,De+=u*dt,Je+=u*At,Qe+=u*gt,ot+=u*wt,Ue+=u*yt,Ye+=u*We,Te+=u*Nt,He+=u*Rt,u=F[2],ve+=u*lt,Re+=u*tt,$e+=u*ft,xe+=u*pt,St+=u*at,vt+=u*rt,st+=u*Ot,De+=u*Ct,Je+=u*dt,Qe+=u*At,ot+=u*gt,Ue+=u*wt,Ye+=u*yt,Te+=u*We,He+=u*Nt,ht+=u*Rt,u=F[3],Re+=u*lt,$e+=u*tt,xe+=u*ft,St+=u*pt,vt+=u*at,st+=u*rt,De+=u*Ot,Je+=u*Ct,Qe+=u*dt,ot+=u*At,Ue+=u*gt,Ye+=u*wt,Te+=u*yt,He+=u*We,ht+=u*Nt,je+=u*Rt,u=F[4],$e+=u*lt,xe+=u*tt,St+=u*ft,vt+=u*pt,st+=u*at,De+=u*rt,Je+=u*Ot,Qe+=u*Ct,ot+=u*dt,Ue+=u*At,Ye+=u*gt,Te+=u*wt,He+=u*yt,ht+=u*We,je+=u*Nt,Pt+=u*Rt,u=F[5],xe+=u*lt,St+=u*tt,vt+=u*ft,st+=u*pt,De+=u*at,Je+=u*rt,Qe+=u*Ot,ot+=u*Ct,Ue+=u*dt,Ye+=u*At,Te+=u*gt,He+=u*wt,ht+=u*yt,je+=u*We,Pt+=u*Nt,Dt+=u*Rt,u=F[6],St+=u*lt,vt+=u*tt,st+=u*ft,De+=u*pt,Je+=u*at,Qe+=u*rt,ot+=u*Ot,Ue+=u*Ct,Ye+=u*dt,Te+=u*At,He+=u*gt,ht+=u*wt,je+=u*yt,Pt+=u*We,Dt+=u*Nt,Ht+=u*Rt,u=F[7],vt+=u*lt,st+=u*tt,De+=u*ft,Je+=u*pt,Qe+=u*at,ot+=u*rt,Ue+=u*Ot,Ye+=u*Ct,Te+=u*dt,He+=u*At,ht+=u*gt,je+=u*wt,Pt+=u*yt,Dt+=u*We,Ht+=u*Nt,Kt+=u*Rt,u=F[8],st+=u*lt,De+=u*tt,Je+=u*ft,Qe+=u*pt,ot+=u*at,Ue+=u*rt,Ye+=u*Ot,Te+=u*Ct,He+=u*dt,ht+=u*At,je+=u*gt,Pt+=u*wt,Dt+=u*yt,Ht+=u*We,Kt+=u*Nt,qt+=u*Rt,u=F[9],De+=u*lt,Je+=u*tt,Qe+=u*ft,ot+=u*pt,Ue+=u*at,Ye+=u*rt,Te+=u*Ot,He+=u*Ct,ht+=u*dt,je+=u*At,Pt+=u*gt,Dt+=u*wt,Ht+=u*yt,Kt+=u*We,qt+=u*Nt,Qt+=u*Rt,u=F[10],Je+=u*lt,Qe+=u*tt,ot+=u*ft,Ue+=u*pt,Ye+=u*at,Te+=u*rt,He+=u*Ot,ht+=u*Ct,je+=u*dt,Pt+=u*At,Dt+=u*gt,Ht+=u*wt,Kt+=u*yt,qt+=u*We,Qt+=u*Nt,or+=u*Rt,u=F[11],Qe+=u*lt,ot+=u*tt,Ue+=u*ft,Ye+=u*pt,Te+=u*at,He+=u*rt,ht+=u*Ot,je+=u*Ct,Pt+=u*dt,Dt+=u*At,Ht+=u*gt,Kt+=u*wt,qt+=u*yt,Qt+=u*We,or+=u*Nt,kr+=u*Rt,u=F[12],ot+=u*lt,Ue+=u*tt,Ye+=u*ft,Te+=u*pt,He+=u*at,ht+=u*rt,je+=u*Ot,Pt+=u*Ct,Dt+=u*dt,Ht+=u*At,Kt+=u*gt,qt+=u*wt,Qt+=u*yt,or+=u*We,kr+=u*Nt,Yt+=u*Rt,u=F[13],Ue+=u*lt,Ye+=u*tt,Te+=u*ft,He+=u*pt,ht+=u*at,je+=u*rt,Pt+=u*Ot,Dt+=u*Ct,Ht+=u*dt,Kt+=u*At,qt+=u*gt,Qt+=u*wt,or+=u*yt,kr+=u*We,Yt+=u*Nt,Yr+=u*Rt,u=F[14],Ye+=u*lt,Te+=u*tt,He+=u*ft,ht+=u*pt,je+=u*at,Pt+=u*rt,Dt+=u*Ot,Ht+=u*Ct,Kt+=u*dt,qt+=u*At,Qt+=u*gt,or+=u*wt,kr+=u*yt,Yt+=u*We,Yr+=u*Nt,di+=u*Rt,u=F[15],Te+=u*lt,He+=u*tt,ht+=u*ft,je+=u*pt,Pt+=u*at,Dt+=u*rt,Ht+=u*Ot,Kt+=u*Ct,qt+=u*dt,Qt+=u*At,or+=u*gt,kr+=u*wt,Yt+=u*yt,Yr+=u*We,di+=u*Nt,Ni+=u*Rt,ie+=38*He,pe+=38*ht,ve+=38*je,Re+=38*Pt,$e+=38*Dt,xe+=38*Ht,St+=38*Kt,vt+=38*qt,st+=38*Qt,De+=38*or,Je+=38*kr,Qe+=38*Yt,ot+=38*Yr,Ue+=38*di,Ye+=38*Ni,E=1,u=ie+E+65535,E=Math.floor(u/65536),ie=u-E*65536,u=pe+E+65535,E=Math.floor(u/65536),pe=u-E*65536,u=ve+E+65535,E=Math.floor(u/65536),ve=u-E*65536,u=Re+E+65535,E=Math.floor(u/65536),Re=u-E*65536,u=$e+E+65535,E=Math.floor(u/65536),$e=u-E*65536,u=xe+E+65535,E=Math.floor(u/65536),xe=u-E*65536,u=St+E+65535,E=Math.floor(u/65536),St=u-E*65536,u=vt+E+65535,E=Math.floor(u/65536),vt=u-E*65536,u=st+E+65535,E=Math.floor(u/65536),st=u-E*65536,u=De+E+65535,E=Math.floor(u/65536),De=u-E*65536,u=Je+E+65535,E=Math.floor(u/65536),Je=u-E*65536,u=Qe+E+65535,E=Math.floor(u/65536),Qe=u-E*65536,u=ot+E+65535,E=Math.floor(u/65536),ot=u-E*65536,u=Ue+E+65535,E=Math.floor(u/65536),Ue=u-E*65536,u=Ye+E+65535,E=Math.floor(u/65536),Ye=u-E*65536,u=Te+E+65535,E=Math.floor(u/65536),Te=u-E*65536,ie+=E-1+37*(E-1),E=1,u=ie+E+65535,E=Math.floor(u/65536),ie=u-E*65536,u=pe+E+65535,E=Math.floor(u/65536),pe=u-E*65536,u=ve+E+65535,E=Math.floor(u/65536),ve=u-E*65536,u=Re+E+65535,E=Math.floor(u/65536),Re=u-E*65536,u=$e+E+65535,E=Math.floor(u/65536),$e=u-E*65536,u=xe+E+65535,E=Math.floor(u/65536),xe=u-E*65536,u=St+E+65535,E=Math.floor(u/65536),St=u-E*65536,u=vt+E+65535,E=Math.floor(u/65536),vt=u-E*65536,u=st+E+65535,E=Math.floor(u/65536),st=u-E*65536,u=De+E+65535,E=Math.floor(u/65536),De=u-E*65536,u=Je+E+65535,E=Math.floor(u/65536),Je=u-E*65536,u=Qe+E+65535,E=Math.floor(u/65536),Qe=u-E*65536,u=ot+E+65535,E=Math.floor(u/65536),ot=u-E*65536,u=Ue+E+65535,E=Math.floor(u/65536),Ue=u-E*65536,u=Ye+E+65535,E=Math.floor(u/65536),Ye=u-E*65536,u=Te+E+65535,E=Math.floor(u/65536),Te=u-E*65536,ie+=E-1+37*(E-1),L[0]=ie,L[1]=pe,L[2]=ve,L[3]=Re,L[4]=$e,L[5]=xe,L[6]=St,L[7]=vt,L[8]=st,L[9]=De,L[10]=Je,L[11]=Qe,L[12]=ot,L[13]=Ue,L[14]=Ye,L[15]=Te}function H(L,F){D(L,F,F)}function ce(L,F){const A=a();let u;for(u=0;u<16;u++)A[u]=F[u];for(u=253;u>=0;u--)H(A,A),u!==2&&u!==4&&D(A,A,F);for(u=0;u<16;u++)L[u]=A[u]}function ae(L,F){const A=a();let u;for(u=0;u<16;u++)A[u]=F[u];for(u=250;u>=0;u--)H(A,A),u!==1&&D(A,A,F);for(u=0;u<16;u++)L[u]=A[u]}function Ee(L,F){const A=a(),u=a(),E=a(),ie=a(),pe=a(),ve=a(),Re=a(),$e=a(),xe=a();I(A,L[1],L[0]),I(xe,F[1],F[0]),D(A,A,xe),q(u,L[0],L[1]),q(xe,F[0],F[1]),D(u,u,xe),D(E,L[3],F[3]),D(E,E,y),D(ie,L[2],F[2]),q(ie,ie,ie),I(pe,u,A),I(ve,ie,E),q(Re,ie,E),q($e,u,A),D(L[0],pe,ve),D(L[1],$e,Re),D(L[2],Re,ve),D(L[3],pe,$e)}function Ae(L,F,A){for(let u=0;u<4;u++)J(L[u],F[u],A)}function et(L,F){const A=a(),u=a(),E=a();ce(E,F[2]),D(A,F[0],E),D(u,F[1],E),oe(L,u),L[31]^=$(A)<<7}function T(L,F,A){K(L[0],p),K(L[1],g),K(L[2],g),K(L[3],p);for(let u=255;u>=0;--u){const E=A[u/8|0]>>(u&7)&1;Ae(L,F,E),Ee(F,L),Ee(L,L),Ae(L,F,E)}}function V(L,F){const A=[a(),a(),a(),a()];K(A[0],b),K(A[1],S),K(A[2],g),D(A[3],b,S),T(L,A,F)}function Me(L){if(L.length!==o.SEED_LENGTH)throw new Error(`ed25519: seed must be ${o.SEED_LENGTH} bytes`);const F=(0,t.hash)(L);F[0]&=248,F[31]&=127,F[31]|=64;const A=new Uint8Array(32),u=[a(),a(),a(),a()];V(u,F),et(A,u);const E=new Uint8Array(64);return E.set(L),E.set(A,32),{publicKey:A,secretKey:E}}o.generateKeyPairFromSeed=Me;function Ne(L){const F=(0,r.randomBytes)(32,L),A=Me(F);return(0,n.wipe)(F),A}o.generateKeyPair=Ne;function ee(L){if(L.length!==o.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${o.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(L.subarray(32))}o.extractPublicKeyFromSecretKey=ee;const Q=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function W(L,F){let A,u,E,ie;for(u=63;u>=32;--u){for(A=0,E=u-32,ie=u-12;E<ie;++E)F[E]+=A-16*F[u]*Q[E-(u-32)],A=Math.floor((F[E]+128)/256),F[E]-=A*256;F[E]+=A,F[u]=0}for(A=0,E=0;E<32;E++)F[E]+=A-(F[31]>>4)*Q[E],A=F[E]>>8,F[E]&=255;for(E=0;E<32;E++)F[E]-=A*Q[E];for(u=0;u<32;u++)F[u+1]+=F[u]>>8,L[u]=F[u]&255}function Y(L){const F=new Float64Array(64);for(let A=0;A<64;A++)F[A]=L[A];for(let A=0;A<64;A++)L[A]=0;W(L,F)}function ut(L,F){const A=new Float64Array(64),u=[a(),a(),a(),a()],E=(0,t.hash)(L.subarray(0,32));E[0]&=248,E[31]&=127,E[31]|=64;const ie=new Uint8Array(64);ie.set(E.subarray(32),32);const pe=new t.SHA512;pe.update(ie.subarray(32)),pe.update(F);const ve=pe.digest();pe.clean(),Y(ve),V(u,ve),et(ie,u),pe.reset(),pe.update(ie.subarray(0,32)),pe.update(L.subarray(32)),pe.update(F);const Re=pe.digest();Y(Re);for(let $e=0;$e<32;$e++)A[$e]=ve[$e];for(let $e=0;$e<32;$e++)for(let xe=0;xe<32;xe++)A[$e+xe]+=Re[$e]*E[xe];return W(ie.subarray(32),A),ie}o.sign=ut;function ke(L,F){const A=a(),u=a(),E=a(),ie=a(),pe=a(),ve=a(),Re=a();return K(L[2],g),M(L[1],F),H(E,L[1]),D(ie,E,w),I(E,E,L[2]),q(ie,L[2],ie),H(pe,ie),H(ve,pe),D(Re,ve,pe),D(A,Re,E),D(A,A,ie),ae(A,A),D(A,A,E),D(A,A,ie),D(A,A,ie),D(L[0],A,ie),H(u,L[0]),D(u,u,ie),C(u,E)&&D(L[0],L[0],N),H(u,L[0]),D(u,u,ie),C(u,E)?-1:($(L[0])===F[31]>>7&&I(L[0],p,L[0]),D(L[3],L[0],L[1]),0)}function zr(L,F,A){const u=new Uint8Array(32),E=[a(),a(),a(),a()],ie=[a(),a(),a(),a()];if(A.length!==o.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${o.SIGNATURE_LENGTH} bytes`);if(ke(ie,L))return!1;const pe=new t.SHA512;pe.update(A.subarray(0,32)),pe.update(L),pe.update(F);const ve=pe.digest();return Y(ve),T(E,ie,ve),V(ie,A.subarray(32)),Ee(E,ie),et(u,E),!fe(A,u)}o.verify=zr;function be(L){let F=[a(),a(),a(),a()];if(ke(F,L))throw new Error("Ed25519: invalid public key");let A=a(),u=a(),E=F[1];q(A,g,E),I(u,g,E),ce(u,u),D(A,A,u);let ie=new Uint8Array(32);return oe(ie,A),ie}o.convertPublicKeyToX25519=be;function xt(L){const F=(0,t.hash)(L.subarray(0,32));F[0]&=248,F[31]&=127,F[31]|=64;const A=new Uint8Array(F.subarray(0,32));return(0,n.wipe)(F),A}o.convertSecretKeyToX25519=xt})(Gc);const _b="EdDSA",Eb="JWT",Tf=".",$f="base64url",Ib="utf8",xb="utf8",Sb=":",Pb="did",Ob="key",Ol="base58btc",Cb="z",Ab="K36",Nb=32;function Co(o){return sr(gr(ss(o),Ib),$f)}function Ff(o){const r=gr(Ab,Ol),t=Cb+sr(Ic([r,o]),Ol);return[Pb,Ob,t].join(Sb)}function Rb(o){return sr(o,$f)}function Tb(o){return gr([Co(o.header),Co(o.payload)].join(Tf),xb)}function $b(o){return[Co(o.header),Co(o.payload),Rb(o.signature)].join(Tf)}function Cl(o=Ro.randomBytes(Nb)){return Gc.generateKeyPairFromSeed(o)}async function Fb(o,r,t,n,a=se.fromMiliseconds(Date.now())){const h={alg:_b,typ:Eb},p=Ff(n.publicKey),g=a+t,w={iss:p,sub:o,aud:r,iat:a,exp:g},y=Tb({header:h,payload:w}),b=Gc.sign(n.secretKey,y);return $b({header:h,payload:w,signature:b})}const Db=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Lb=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Al=o=>o.split("?")[0],Nl=10,jb=Db();let qb=class{constructor(r){if(this.url=r,this.events=new Qr.EventEmitter,this.registering=!1,!Zh(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);this.url=r}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(r,t){this.events.on(r,t)}once(r,t){this.events.once(r,t)}off(r,t){this.events.off(r,t)}removeListener(r,t){this.events.removeListener(r,t)}async open(r=this.url){await this.register(r)}async close(){return new Promise((r,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),r()},this.socket.close()})}async send(r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ss(r))}catch(t){this.onError(r.id,t)}}register(r=this.url){if(!Zh(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((n,a)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),a(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=r,this.registering=!0,new Promise((t,n)=>{const a=new URLSearchParams(r).get("origin"),h=r1.isReactNative()?{headers:{origin:a}}:{rejectUnauthorized:!i1(r)},p=new jb(r,[],h);Lb()?p.onerror=g=>{const w=g;n(this.emitError(w.error))}:p.on("error",g=>{n(this.emitError(g))}),p.onopen=()=>{this.onOpen(p),t(p)}})}onOpen(r){r.onmessage=t=>this.onPayload(t),r.onclose=t=>this.onClose(t),this.socket=r,this.registering=!1,this.events.emit("open")}onClose(r){this.socket=void 0,this.registering=!1,this.events.emit("close",r)}onPayload(r){if(typeof r.data>"u")return;const t=typeof r.data=="string"?To(r.data):r.data;this.events.emit("payload",t)}onError(r,t){const n=this.parseError(t),a=n.message||n.toString(),h=jc(r,a);this.events.emit("payload",h)}parseError(r,t=this.url){return n1(r,Al(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Nl&&this.events.setMaxListeners(Nl)}emitError(r){const t=this.parseError(new Error(r?.message||`WebSocket connection failed for host: ${Al(this.url)}`));return this.events.emit("register_error",t),t}};var Ao={exports:{}};Ao.exports;(function(o,r){var t=200,n="__lodash_hash_undefined__",a=1,h=2,p=9007199254740991,g="[object Arguments]",w="[object Array]",y="[object AsyncFunction]",b="[object Boolean]",S="[object Date]",N="[object Error]",K="[object Function]",j="[object GeneratorFunction]",J="[object Map]",oe="[object Number]",fe="[object Null]",C="[object Object]",$="[object Promise]",M="[object Proxy]",q="[object RegExp]",I="[object Set]",D="[object String]",H="[object Symbol]",ce="[object Undefined]",ae="[object WeakMap]",Ee="[object ArrayBuffer]",Ae="[object DataView]",et="[object Float32Array]",T="[object Float64Array]",V="[object Int8Array]",Me="[object Int16Array]",Ne="[object Int32Array]",ee="[object Uint8Array]",Q="[object Uint8ClampedArray]",W="[object Uint16Array]",Y="[object Uint32Array]",ut=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,zr=/^(?:0|[1-9]\d*)$/,be={};be[et]=be[T]=be[V]=be[Me]=be[Ne]=be[ee]=be[Q]=be[W]=be[Y]=!0,be[g]=be[w]=be[Ee]=be[b]=be[Ae]=be[S]=be[N]=be[K]=be[J]=be[oe]=be[C]=be[q]=be[I]=be[D]=be[ae]=!1;var xt=typeof go=="object"&&go&&go.Object===Object&&go,L=typeof self=="object"&&self&&self.Object===Object&&self,F=xt||L||Function("return this")(),A=r&&!r.nodeType&&r,u=A&&!0&&o&&!o.nodeType&&o,E=u&&u.exports===A,ie=E&&xt.process,pe=function(){try{return ie&&ie.binding&&ie.binding("util")}catch{}}(),ve=pe&&pe.isTypedArray;function Re(m,x){for(var B=-1,te=m==null?0:m.length,Ve=0,ge=[];++B<te;){var Ze=m[B];x(Ze,B,m)&&(ge[Ve++]=Ze)}return ge}function $e(m,x){for(var B=-1,te=x.length,Ve=m.length;++B<te;)m[Ve+B]=x[B];return m}function xe(m,x){for(var B=-1,te=m==null?0:m.length;++B<te;)if(x(m[B],B,m))return!0;return!1}function St(m,x){for(var B=-1,te=Array(m);++B<m;)te[B]=x(B);return te}function vt(m){return function(x){return m(x)}}function st(m,x){return m.has(x)}function De(m,x){return m?.[x]}function Je(m){var x=-1,B=Array(m.size);return m.forEach(function(te,Ve){B[++x]=[Ve,te]}),B}function Qe(m,x){return function(B){return m(x(B))}}function ot(m){var x=-1,B=Array(m.size);return m.forEach(function(te){B[++x]=te}),B}var Ue=Array.prototype,Ye=Function.prototype,Te=Object.prototype,He=F["__core-js_shared__"],ht=Ye.toString,je=Te.hasOwnProperty,Pt=function(){var m=/[^.]+$/.exec(He&&He.keys&&He.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),Dt=Te.toString,Ht=RegExp("^"+ht.call(je).replace(ut,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Kt=E?F.Buffer:void 0,qt=F.Symbol,Qt=F.Uint8Array,or=Te.propertyIsEnumerable,kr=Ue.splice,Yt=qt?qt.toStringTag:void 0,Yr=Object.getOwnPropertySymbols,di=Kt?Kt.isBuffer:void 0,Ni=Qe(Object.keys,Object),lt=yr(F,"DataView"),tt=yr(F,"Map"),ft=yr(F,"Promise"),pt=yr(F,"Set"),at=yr(F,"WeakMap"),rt=yr(Object,"create"),Ot=Xr(lt),Ct=Xr(tt),dt=Xr(ft),At=Xr(pt),gt=Xr(at),wt=qt?qt.prototype:void 0,yt=wt?wt.valueOf:void 0;function We(m){var x=-1,B=m==null?0:m.length;for(this.clear();++x<B;){var te=m[x];this.set(te[0],te[1])}}function Nt(){this.__data__=rt?rt(null):{},this.size=0}function Rt(m){var x=this.has(m)&&delete this.__data__[m];return this.size-=x?1:0,x}function Do(m){var x=this.__data__;if(rt){var B=x[m];return B===n?void 0:B}return je.call(x,m)?x[m]:void 0}function Lo(m){var x=this.__data__;return rt?x[m]!==void 0:je.call(x,m)}function jo(m,x){var B=this.__data__;return this.size+=this.has(m)?0:1,B[m]=rt&&x===void 0?n:x,this}We.prototype.clear=Nt,We.prototype.delete=Rt,We.prototype.get=Do,We.prototype.has=Lo,We.prototype.set=jo;function Ir(m){var x=-1,B=m==null?0:m.length;for(this.clear();++x<B;){var te=m[x];this.set(te[0],te[1])}}function qo(){this.__data__=[],this.size=0}function Mo(m){var x=this.__data__,B=Ri(x,m);if(B<0)return!1;var te=x.length-1;return B==te?x.pop():kr.call(x,B,1),--this.size,!0}function Uo(m){var x=this.__data__,B=Ri(x,m);return B<0?void 0:x[B][1]}function zo(m){return Ri(this.__data__,m)>-1}function ko(m,x){var B=this.__data__,te=Ri(B,m);return te<0?(++this.size,B.push([m,x])):B[te][1]=x,this}Ir.prototype.clear=qo,Ir.prototype.delete=Mo,Ir.prototype.get=Uo,Ir.prototype.has=zo,Ir.prototype.set=ko;function Zr(m){var x=-1,B=m==null?0:m.length;for(this.clear();++x<B;){var te=m[x];this.set(te[0],te[1])}}function Yi(){this.size=0,this.__data__={hash:new We,map:new(tt||Ir),string:new We}}function Ho(m){var x=gi(this,m).delete(m);return this.size-=x?1:0,x}function Zi(m){return gi(this,m).get(m)}function Ko(m){return gi(this,m).has(m)}function Vo(m,x){var B=gi(this,m),te=B.size;return B.set(m,x),this.size+=B.size==te?0:1,this}Zr.prototype.clear=Yi,Zr.prototype.delete=Ho,Zr.prototype.get=Zi,Zr.prototype.has=Ko,Zr.prototype.set=Vo;function Xi(m){var x=-1,B=m==null?0:m.length;for(this.__data__=new Zr;++x<B;)this.add(m[x])}function hs(m){return this.__data__.set(m,n),this}function ls(m){return this.__data__.has(m)}Xi.prototype.add=Xi.prototype.push=hs,Xi.prototype.has=ls;function $r(m){var x=this.__data__=new Ir(m);this.size=x.size}function Bo(){this.__data__=new Ir,this.size=0}function Go(m){var x=this.__data__,B=x.delete(m);return this.size=x.size,B}function Wo(m){return this.__data__.get(m)}function Jo(m){return this.__data__.has(m)}function fs(m,x){var B=this.__data__;if(B instanceof Ir){var te=B.__data__;if(!tt||te.length<t-1)return te.push([m,x]),this.size=++B.size,this;B=this.__data__=new Zr(te)}return B.set(m,x),this.size=B.size,this}$r.prototype.clear=Bo,$r.prototype.delete=Go,$r.prototype.get=Wo,$r.prototype.has=Jo,$r.prototype.set=fs;function ps(m,x){var B=rn(m),te=!B&&Ss(m),Ve=!B&&!te&&Cn(m),ge=!B&&!te&&!Ve&&Cs(m),Ze=B||te||Ve||ge,Tt=Ze?St(m.length,String):[],Pe=Tt.length;for(var Be in m)(x||je.call(m,Be))&&!(Ze&&(Be=="length"||Ve&&(Be=="offset"||Be=="parent")||ge&&(Be=="buffer"||Be=="byteLength"||Be=="byteOffset")||bs(Be,Pe)))&&Tt.push(Be);return Tt}function Ri(m,x){for(var B=m.length;B--;)if(xs(m[B][0],x))return B;return-1}function Pn(m,x,B){var te=x(m);return rn(m)?te:$e(te,B(m))}function Ti(m){return m==null?m===void 0?ce:fe:Yt&&Yt in Object(m)?vs(m):Zo(m)}function On(m){return Fi(m)&&Ti(m)==g}function $i(m,x,B,te,Ve){return m===x?!0:m==null||x==null||!Fi(m)&&!Fi(x)?m!==m&&x!==x:ds(m,x,B,te,$i,Ve)}function ds(m,x,B,te,Ve,ge){var Ze=rn(m),Tt=rn(x),Pe=Ze?w:Hr(m),Be=Tt?w:Hr(x);Pe=Pe==g?C:Pe,Be=Be==g?C:Be;var bt=Pe==C,ar=Be==C,$t=Pe==Be;if($t&&Cn(m)){if(!Cn(x))return!1;Ze=!0,bt=!1}if($t&&!bt)return ge||(ge=new $r),Ze||Cs(m)?en(m,x,B,te,Ve,ge):Yo(m,x,Pe,B,te,Ve,ge);if(!(B&a)){var Xe=bt&&je.call(m,"__wrapped__"),Zt=ar&&je.call(x,"__wrapped__");if(Xe||Zt){var Fr=Xe?m.value():m,xr=Zt?x.value():x;return ge||(ge=new $r),Ve(Fr,xr,B,te,ge)}}return $t?(ge||(ge=new $r),ms(m,x,B,te,Ve,ge)):!1}function Qo(m){if(!Os(m)||Es(m))return!1;var x=nn(m)?Ht:ke;return x.test(Xr(m))}function gs(m){return Fi(m)&&Ps(m.length)&&!!be[Ti(m)]}function ys(m){if(!Is(m))return Ni(m);var x=[];for(var B in Object(m))je.call(m,B)&&B!="constructor"&&x.push(B);return x}function en(m,x,B,te,Ve,ge){var Ze=B&a,Tt=m.length,Pe=x.length;if(Tt!=Pe&&!(Ze&&Pe>Tt))return!1;var Be=ge.get(m);if(Be&&ge.get(x))return Be==x;var bt=-1,ar=!0,$t=B&h?new Xi:void 0;for(ge.set(m,x),ge.set(x,m);++bt<Tt;){var Xe=m[bt],Zt=x[bt];if(te)var Fr=Ze?te(Zt,Xe,bt,x,m,ge):te(Xe,Zt,bt,m,x,ge);if(Fr!==void 0){if(Fr)continue;ar=!1;break}if($t){if(!xe(x,function(xr,Kr){if(!st($t,Kr)&&(Xe===xr||Ve(Xe,xr,B,te,ge)))return $t.push(Kr)})){ar=!1;break}}else if(!(Xe===Zt||Ve(Xe,Zt,B,te,ge))){ar=!1;break}}return ge.delete(m),ge.delete(x),ar}function Yo(m,x,B,te,Ve,ge,Ze){switch(B){case Ae:if(m.byteLength!=x.byteLength||m.byteOffset!=x.byteOffset)return!1;m=m.buffer,x=x.buffer;case Ee:return!(m.byteLength!=x.byteLength||!ge(new Qt(m),new Qt(x)));case b:case S:case oe:return xs(+m,+x);case N:return m.name==x.name&&m.message==x.message;case q:case D:return m==x+"";case J:var Tt=Je;case I:var Pe=te&a;if(Tt||(Tt=ot),m.size!=x.size&&!Pe)return!1;var Be=Ze.get(m);if(Be)return Be==x;te|=h,Ze.set(m,x);var bt=en(Tt(m),Tt(x),te,Ve,ge,Ze);return Ze.delete(m),bt;case H:if(yt)return yt.call(m)==yt.call(x)}return!1}function ms(m,x,B,te,Ve,ge){var Ze=B&a,Tt=tn(m),Pe=Tt.length,Be=tn(x),bt=Be.length;if(Pe!=bt&&!Ze)return!1;for(var ar=Pe;ar--;){var $t=Tt[ar];if(!(Ze?$t in x:je.call(x,$t)))return!1}var Xe=ge.get(m);if(Xe&&ge.get(x))return Xe==x;var Zt=!0;ge.set(m,x),ge.set(x,m);for(var Fr=Ze;++ar<Pe;){$t=Tt[ar];var xr=m[$t],Kr=x[$t];if(te)var An=Ze?te(Kr,xr,$t,x,m,ge):te(xr,Kr,$t,m,x,ge);if(!(An===void 0?xr===Kr||Ve(xr,Kr,B,te,ge):An)){Zt=!1;break}Fr||(Fr=$t=="constructor")}if(Zt&&!Fr){var Di=m.constructor,Mt=x.constructor;Di!=Mt&&"constructor"in m&&"constructor"in x&&!(typeof Di=="function"&&Di instanceof Di&&typeof Mt=="function"&&Mt instanceof Mt)&&(Zt=!1)}return ge.delete(m),ge.delete(x),Zt}function tn(m){return Pn(m,ta,ws)}function gi(m,x){var B=m.__data__;return _s(x)?B[typeof x=="string"?"string":"hash"]:B.map}function yr(m,x){var B=De(m,x);return Qo(B)?B:void 0}function vs(m){var x=je.call(m,Yt),B=m[Yt];try{m[Yt]=void 0;var te=!0}catch{}var Ve=Dt.call(m);return te&&(x?m[Yt]=B:delete m[Yt]),Ve}var ws=Yr?function(m){return m==null?[]:(m=Object(m),Re(Yr(m),function(x){return or.call(m,x)}))}:Ke,Hr=Ti;(lt&&Hr(new lt(new ArrayBuffer(1)))!=Ae||tt&&Hr(new tt)!=J||ft&&Hr(ft.resolve())!=$||pt&&Hr(new pt)!=I||at&&Hr(new at)!=ae)&&(Hr=function(m){var x=Ti(m),B=x==C?m.constructor:void 0,te=B?Xr(B):"";if(te)switch(te){case Ot:return Ae;case Ct:return J;case dt:return $;case At:return I;case gt:return ae}return x});function bs(m,x){return x=x??p,!!x&&(typeof m=="number"||zr.test(m))&&m>-1&&m%1==0&&m<x}function _s(m){var x=typeof m;return x=="string"||x=="number"||x=="symbol"||x=="boolean"?m!=="__proto__":m===null}function Es(m){return!!Pt&&Pt in m}function Is(m){var x=m&&m.constructor,B=typeof x=="function"&&x.prototype||Te;return m===B}function Zo(m){return Dt.call(m)}function Xr(m){if(m!=null){try{return ht.call(m)}catch{}try{return m+""}catch{}}return""}function xs(m,x){return m===x||m!==m&&x!==x}var Ss=On(function(){return arguments}())?On:function(m){return Fi(m)&&je.call(m,"callee")&&!or.call(m,"callee")},rn=Array.isArray;function Xo(m){return m!=null&&Ps(m.length)&&!nn(m)}var Cn=di||ze;function ea(m,x){return $i(m,x)}function nn(m){if(!Os(m))return!1;var x=Ti(m);return x==K||x==j||x==y||x==M}function Ps(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=p}function Os(m){var x=typeof m;return m!=null&&(x=="object"||x=="function")}function Fi(m){return m!=null&&typeof m=="object"}var Cs=ve?vt(ve):gs;function ta(m){return Xo(m)?ps(m):ys(m)}function Ke(){return[]}function ze(){return!1}o.exports=ea})(Ao,Ao.exports);var Mb=Ao.exports;const Ub=Xv(Mb);function zb(o,r){if(o.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var a=0;a<o.length;a++){var h=o.charAt(a),p=h.charCodeAt(0);if(t[p]!==255)throw new TypeError(h+" is ambiguous");t[p]=a}var g=o.length,w=o.charAt(0),y=Math.log(g)/Math.log(256),b=Math.log(256)/Math.log(g);function S(j){if(j instanceof Uint8Array||(ArrayBuffer.isView(j)?j=new Uint8Array(j.buffer,j.byteOffset,j.byteLength):Array.isArray(j)&&(j=Uint8Array.from(j))),!(j instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(j.length===0)return"";for(var J=0,oe=0,fe=0,C=j.length;fe!==C&&j[fe]===0;)fe++,J++;for(var $=(C-fe)*b+1>>>0,M=new Uint8Array($);fe!==C;){for(var q=j[fe],I=0,D=$-1;(q!==0||I<oe)&&D!==-1;D--,I++)q+=256*M[D]>>>0,M[D]=q%g>>>0,q=q/g>>>0;if(q!==0)throw new Error("Non-zero carry");oe=I,fe++}for(var H=$-oe;H!==$&&M[H]===0;)H++;for(var ce=w.repeat(J);H<$;++H)ce+=o.charAt(M[H]);return ce}function N(j){if(typeof j!="string")throw new TypeError("Expected String");if(j.length===0)return new Uint8Array;var J=0;if(j[J]!==" "){for(var oe=0,fe=0;j[J]===w;)oe++,J++;for(var C=(j.length-J)*y+1>>>0,$=new Uint8Array(C);j[J];){var M=t[j.charCodeAt(J)];if(M===255)return;for(var q=0,I=C-1;(M!==0||q<fe)&&I!==-1;I--,q++)M+=g*$[I]>>>0,$[I]=M%256>>>0,M=M/256>>>0;if(M!==0)throw new Error("Non-zero carry");fe=q,J++}if(j[J]!==" "){for(var D=C-fe;D!==C&&$[D]===0;)D++;for(var H=new Uint8Array(oe+(C-D)),ce=oe;D!==C;)H[ce++]=$[D++];return H}}}function K(j){var J=N(j);if(J)return J;throw new Error(`Non-${r} character`)}return{encode:S,decodeUnsafe:N,decode:K}}var kb=zb,Hb=kb;const Df=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},Kb=o=>new TextEncoder().encode(o),Vb=o=>new TextDecoder().decode(o);class Bb{constructor(r,t,n){this.name=r,this.prefix=t,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class Gb{constructor(r,t,n){if(this.name=r,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return Lf(this,r)}}let Wb=class{constructor(r){this.decoders=r}or(r){return Lf(this,r)}decode(r){const t=r[0],n=this.decoders[t];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Lf=(o,r)=>new Wb({...o.decoders||{[o.prefix]:o},...r.decoders||{[r.prefix]:r}});class Jb{constructor(r,t,n,a){this.name=r,this.prefix=t,this.baseEncode=n,this.baseDecode=a,this.encoder=new Bb(r,t,n),this.decoder=new Gb(r,t,a)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const $o=({name:o,prefix:r,encode:t,decode:n})=>new Jb(o,r,t,n),us=({prefix:o,name:r,alphabet:t})=>{const{encode:n,decode:a}=Hb(t,r);return $o({prefix:o,name:r,encode:n,decode:h=>Df(a(h))})},Qb=(o,r,t,n)=>{const a={};for(let b=0;b<r.length;++b)a[r[b]]=b;let h=o.length;for(;o[h-1]==="=";)--h;const p=new Uint8Array(h*t/8|0);let g=0,w=0,y=0;for(let b=0;b<h;++b){const S=a[o[b]];if(S===void 0)throw new SyntaxError(`Non-${n} character`);w=w<<t|S,g+=t,g>=8&&(g-=8,p[y++]=255&w>>g)}if(g>=t||255&w<<8-g)throw new SyntaxError("Unexpected end of data");return p},Yb=(o,r,t)=>{const n=r[r.length-1]==="=",a=(1<<t)-1;let h="",p=0,g=0;for(let w=0;w<o.length;++w)for(g=g<<8|o[w],p+=8;p>t;)p-=t,h+=r[a&g>>p];if(p&&(h+=r[a&g<<t-p]),n)for(;h.length*t&7;)h+="=";return h},Bt=({name:o,prefix:r,bitsPerChar:t,alphabet:n})=>$o({prefix:r,name:o,encode(a){return Yb(a,n,t)},decode(a){return Qb(a,n,t,o)}}),Zb=$o({prefix:"\0",name:"identity",encode:o=>Vb(o),decode:o=>Kb(o)});var Xb=Object.freeze({__proto__:null,identity:Zb});const e_=Bt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var t_=Object.freeze({__proto__:null,base2:e_});const r_=Bt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var i_=Object.freeze({__proto__:null,base8:r_});const n_=us({prefix:"9",name:"base10",alphabet:"0123456789"});var s_=Object.freeze({__proto__:null,base10:n_});const o_=Bt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),a_=Bt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var c_=Object.freeze({__proto__:null,base16:o_,base16upper:a_});const u_=Bt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),h_=Bt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),l_=Bt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),f_=Bt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),p_=Bt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),d_=Bt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),g_=Bt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),y_=Bt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),m_=Bt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var v_=Object.freeze({__proto__:null,base32:u_,base32upper:h_,base32pad:l_,base32padupper:f_,base32hex:p_,base32hexupper:d_,base32hexpad:g_,base32hexpadupper:y_,base32z:m_});const w_=us({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),b_=us({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var __=Object.freeze({__proto__:null,base36:w_,base36upper:b_});const E_=us({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),I_=us({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var x_=Object.freeze({__proto__:null,base58btc:E_,base58flickr:I_});const S_=Bt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),P_=Bt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),O_=Bt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),C_=Bt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var A_=Object.freeze({__proto__:null,base64:S_,base64pad:P_,base64url:O_,base64urlpad:C_});const jf=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),N_=jf.reduce((o,r,t)=>(o[t]=r,o),[]),R_=jf.reduce((o,r,t)=>(o[r.codePointAt(0)]=t,o),[]);function T_(o){return o.reduce((r,t)=>(r+=N_[t],r),"")}function $_(o){const r=[];for(const t of o){const n=R_[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);r.push(n)}return new Uint8Array(r)}const F_=$o({prefix:"🚀",name:"base256emoji",encode:T_,decode:$_});var D_=Object.freeze({__proto__:null,base256emoji:F_}),L_=qf,Rl=128,j_=127,q_=~j_,M_=Math.pow(2,31);function qf(o,r,t){r=r||[],t=t||0;for(var n=t;o>=M_;)r[t++]=o&255|Rl,o/=128;for(;o&q_;)r[t++]=o&255|Rl,o>>>=7;return r[t]=o|0,qf.bytes=t-n+1,r}var U_=Ac,z_=128,Tl=127;function Ac(o,n){var t=0,n=n||0,a=0,h=n,p,g=o.length;do{if(h>=g)throw Ac.bytes=0,new RangeError("Could not decode varint");p=o[h++],t+=a<28?(p&Tl)<<a:(p&Tl)*Math.pow(2,a),a+=7}while(p>=z_);return Ac.bytes=h-n,t}var k_=Math.pow(2,7),H_=Math.pow(2,14),K_=Math.pow(2,21),V_=Math.pow(2,28),B_=Math.pow(2,35),G_=Math.pow(2,42),W_=Math.pow(2,49),J_=Math.pow(2,56),Q_=Math.pow(2,63),Y_=function(o){return o<k_?1:o<H_?2:o<K_?3:o<V_?4:o<B_?5:o<G_?6:o<W_?7:o<J_?8:o<Q_?9:10},Z_={encode:L_,decode:U_,encodingLength:Y_},Mf=Z_;const $l=(o,r,t=0)=>(Mf.encode(o,r,t),r),Fl=o=>Mf.encodingLength(o),Nc=(o,r)=>{const t=r.byteLength,n=Fl(o),a=n+Fl(t),h=new Uint8Array(a+t);return $l(o,h,0),$l(t,h,n),h.set(r,a),new X_(o,t,r,h)};class X_{constructor(r,t,n,a){this.code=r,this.size=t,this.digest=n,this.bytes=a}}const Uf=({name:o,code:r,encode:t})=>new eE(o,r,t);class eE{constructor(r,t,n){this.name=r,this.code=t,this.encode=n}digest(r){if(r instanceof Uint8Array){const t=this.encode(r);return t instanceof Uint8Array?Nc(this.code,t):t.then(n=>Nc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const zf=o=>async r=>new Uint8Array(await crypto.subtle.digest(o,r)),tE=Uf({name:"sha2-256",code:18,encode:zf("SHA-256")}),rE=Uf({name:"sha2-512",code:19,encode:zf("SHA-512")});var iE=Object.freeze({__proto__:null,sha256:tE,sha512:rE});const kf=0,nE="identity",Hf=Df,sE=o=>Nc(kf,Hf(o)),oE={code:kf,name:nE,encode:Hf,digest:sE};var aE=Object.freeze({__proto__:null,identity:oE});new TextEncoder,new TextDecoder;const Dl={...Xb,...t_,...i_,...s_,...c_,...v_,...__,...x_,...A_,...D_};({...iE,...aE});function Kf(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function cE(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Kf(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function Vf(o,r,t,n){return{name:o,prefix:r,encoder:{name:o,prefix:r,encode:t},decoder:{decode:n}}}const Ll=Vf("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),dc=Vf("ascii","a",o=>{let r="a";for(let t=0;t<o.length;t++)r+=String.fromCharCode(o[t]);return r},o=>{o=o.substring(1);const r=cE(o.length);for(let t=0;t<o.length;t++)r[t]=o.charCodeAt(t);return r}),uE={utf8:Ll,"utf-8":Ll,hex:Dl.base16,latin1:dc,ascii:dc,binary:dc,...Dl};function hE(o,r="utf8"){const t=uE[r];if(!t)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Kf(globalThis.Buffer.from(o,"utf-8")):t.decoder.decode(`${t.prefix}${o}`)}const Bf="wc",lE=2,Wc="core",Oi=`${Bf}@2:${Wc}:`,fE={name:Wc,logger:"error"},pE={database:":memory:"},dE="crypto",jl="client_ed25519_seed",gE=se.ONE_DAY,yE="keychain",mE="0.3",vE="messages",wE="0.3",bE=se.SIX_HOURS,_E="publisher",Gf="irn",EE="error",Wf="wss://relay.walletconnect.com",ql="wss://relay.walletconnect.org",IE="relayer",Jt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},xE="_subscription",ui={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},SE=se.ONE_SECOND,PE="2.10.6",OE=1e4,CE="0.3",AE="WALLETCONNECT_CLIENT_ID",Mr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},NE="subscription",RE="0.3",TE=se.FIVE_SECONDS*1e3,$E="pairing",FE="0.3",Gn={wc_pairingDelete:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:se.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:se.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:se.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:se.ONE_DAY,prompt:!1,tag:0},res:{ttl:se.ONE_DAY,prompt:!1,tag:0}}},Xn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Wr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},DE="history",LE="0.3",jE="expirer",Tr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},qE="0.3",gc="verify-api",wn="https://verify.walletconnect.com",Rc="https://verify.walletconnect.org",ME=[wn,Rc];class UE{constructor(r,t){this.core=r,this.logger=t,this.keychain=new Map,this.name=yE,this.version=mE,this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,a)=>{this.isInitialized(),this.keychain.set(n,a),await this.persist()},this.get=n=>{this.isInitialized();const a=this.keychain.get(n);if(typeof a>"u"){const{message:h}=Z("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(h)}return a},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=r,this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,bf(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?_f(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class zE{constructor(r,t,n){this.core=r,this.logger=t,this.name=dE,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),h=Cl(a);return Ff(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=f1();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const h=await this.getClientSeed(),p=Cl(h),g=Pc();return await Fb(g,a,gE,p)},this.generateSharedKey=(a,h,p)=>{this.isInitialized();const g=this.getPrivateKey(a),w=p1(g,h);return this.setSymKey(w,p)},this.setSymKey=async(a,h)=>{this.isInitialized();const p=h||d1(a);return await this.keychain.set(p,a),p},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,h,p)=>{this.isInitialized();const g=wf(p),w=ss(h);if(rl(g)){const N=g.senderPublicKey,K=g.receiverPublicKey;a=await this.generateSharedKey(N,K)}const y=this.getSymKey(a),{type:b,senderPublicKey:S}=g;return y1({type:b,symKey:y,message:w,senderPublicKey:S})},this.decode=async(a,h,p)=>{this.isInitialized();const g=w1(h,p);if(rl(g)){const w=g.receiverPublicKey,y=g.senderPublicKey;a=await this.generateSharedKey(w,y)}try{const w=this.getSymKey(a),y=m1({symKey:w,encoded:h});return To(y)}catch(w){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=a=>{const h=Po(a);return os(h.type)},this.getPayloadSenderPublicKey=a=>{const h=Po(a);return h.senderPublicKey?sr(h.senderPublicKey,nr):void 0},this.core=r,this.logger=Ce.generateChildLogger(t,this.name),this.keychain=n||new UE(this.core,this.logger)}get context(){return Ce.getLoggerContext(this.logger)}async setPrivateKey(r,t){return await this.keychain.set(r,t),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(jl)}catch{r=Pc(),await this.keychain.set(jl,r)}return hE(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class kE extends fb{constructor(r,t){super(r,t),this.logger=r,this.core=t,this.messages=new Map,this.name=vE,this.version=wE,this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,a)=>{this.isInitialized();const h=bn(a);let p=this.messages.get(n);return typeof p>"u"&&(p={}),typeof p[h]<"u"||(p[h]=a,this.messages.set(n,p),await this.persist()),h},this.get=n=>{this.isInitialized();let a=this.messages.get(n);return typeof a>"u"&&(a={}),a},this.has=(n,a)=>{this.isInitialized();const h=this.get(n),p=bn(a);return typeof h[p]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ce.generateChildLogger(r,this.name),this.core=t}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,bf(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?_f(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class HE extends pb{constructor(r,t){super(r,t),this.relayer=r,this.logger=t,this.events=new Qr.EventEmitter,this.name=_E,this.queue=new Map,this.publishTimeout=se.toMiliseconds(se.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,a,h)=>{var p;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:h}});try{const g=h?.ttl||bE,w=Oc(h),y=h?.prompt||!1,b=h?.tag||0,S=h?.id||s1().toString(),N={topic:n,message:a,opts:{ttl:g,relay:w,prompt:y,tag:b,id:S}},K=setTimeout(()=>this.queue.set(S,N),this.publishTimeout);try{await await is(this.rpcPublish(n,a,g,w,y,b,S),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(S),this.relayer.events.emit(Jt.publish,N)}catch(j){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(p=h?.internal)!=null&&p.throwOnFailedPublish)throw this.removeRequestFromQueue(S),j;return}finally{clearTimeout(K)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:h}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.relayer=r,this.logger=Ce.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Ce.getLoggerContext(this.logger)}rpcPublish(r,t,n,a,h,p,g){var w,y,b,S;const N={method:Eo(a.protocol).publish,params:{topic:r,message:t,ttl:n,prompt:h,tag:p},id:g};return ir((w=N.params)==null?void 0:w.prompt)&&((y=N.params)==null||delete y.prompt),ir((b=N.params)==null?void 0:b.tag)&&((S=N.params)==null||delete S.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:N}),this.relayer.request(N)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:t,message:n,opts:a}=r;await this.publish(t,n,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Sn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Jt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Jt.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class KE{constructor(){this.map=new Map,this.set=(r,t)=>{const n=this.get(r);this.exists(r,t)||this.map.set(r,[...n,t])},this.get=r=>this.map.get(r)||[],this.exists=(r,t)=>this.get(r).includes(t),this.delete=(r,t)=>{if(typeof t>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const n=this.get(r);if(!this.exists(r,t))return;const a=n.filter(h=>h!==t);if(!a.length){this.map.delete(r);return}this.map.set(r,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var VE=Object.defineProperty,BE=Object.defineProperties,GE=Object.getOwnPropertyDescriptors,Ml=Object.getOwnPropertySymbols,WE=Object.prototype.hasOwnProperty,JE=Object.prototype.propertyIsEnumerable,Ul=(o,r,t)=>r in o?VE(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,Wn=(o,r)=>{for(var t in r||(r={}))WE.call(r,t)&&Ul(o,t,r[t]);if(Ml)for(var t of Ml(r))JE.call(r,t)&&Ul(o,t,r[t]);return o},yc=(o,r)=>BE(o,GE(r));class QE extends yb{constructor(r,t){super(r,t),this.relayer=r,this.logger=t,this.subscriptions=new Map,this.topicMap=new KE,this.events=new Qr.EventEmitter,this.name=NE,this.version=RE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Oi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}});try{const h=Oc(a),p={topic:n,relay:h};this.pending.set(n,p);const g=await this.rpcSubscribe(n,h);return this.onSubscribe(g,p),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}}),g}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),typeof a?.id<"u"?await this.unsubscribeById(n,a.id,a):await this.unsubscribeByTopic(n,a)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((a,h)=>{const p=new se.Watch;p.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(g),p.stop(this.pendingSubscriptionWatchLabel),a(!0)),p.elapsed(this.pendingSubscriptionWatchLabel)>=TE&&(clearInterval(g),p.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=Ce.generateChildLogger(t,this.name),this.clientId=""}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,t){let n=!1;try{n=this.getSubscription(r).topic===t}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,t){const n=this.topicMap.get(r);await Promise.all(n.map(async a=>await this.unsubscribeById(r,a,t)))}async unsubscribeById(r,t,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:t,opts:n}});try{const a=Oc(n);await this.rpcUnsubscribe(r,t,a);const h=It("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,t,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:t,opts:n}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(r,t){const n={method:Eo(t.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await is(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Jt.connection_stalled)}return bn(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const t=r[0].relay,n={method:Eo(t.protocol).batchSubscribe,params:{topics:r.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await is(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Jt.connection_stalled)}}rpcUnsubscribe(r,t,n){const a={method:Eo(n.protocol).unsubscribe,params:{topic:r,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(r,t){this.setSubscription(r,yc(Wn({},t),{id:r})),this.pending.delete(t.topic)}onBatchSubscribe(r){r.length&&r.forEach(t=>{this.setSubscription(t.id,Wn({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(r,t,n){this.events.removeAllListeners(t),this.hasSubscription(t,r)&&this.deleteSubscription(t,n),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,t){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:t}),this.addSubscription(r,t))}addSubscription(r,t){this.subscriptions.set(r,Wn({},t)),this.topicMap.set(t.topic,r),this.events.emit(Mr.created,t)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const t=this.subscriptions.get(r);if(!t){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return t}deleteSubscription(r,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:t});const n=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(n.topic,r),this.events.emit(Mr.deleted,yc(Wn({},n),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Mr.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<r;t++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Mr.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const t=await this.rpcBatchSubscribe(r);Jr(t)&&this.onBatchSubscribe(t.map((n,a)=>yc(Wn({},r[a]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(t=>{r.push(t)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(Sn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Jt.connect,async()=>{await this.onConnect()}),this.relayer.on(Jt.disconnect,()=>{this.onDisconnect()}),this.events.on(Mr.created,async r=>{const t=Mr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),await this.persist()}),this.events.on(Mr.deleted,async r=>{const t=Mr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),r())},this.pollingInterval)})}}var YE=Object.defineProperty,zl=Object.getOwnPropertySymbols,ZE=Object.prototype.hasOwnProperty,XE=Object.prototype.propertyIsEnumerable,kl=(o,r,t)=>r in o?YE(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,eI=(o,r)=>{for(var t in r||(r={}))ZE.call(r,t)&&kl(o,t,r[t]);if(zl)for(var t of zl(r))XE.call(r,t)&&kl(o,t,r[t]);return o};class tI extends db{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new Qr.EventEmitter,this.name=IE,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async t=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(t)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=t=>{this.onProviderPayload(t)},this.onConnectHandler=()=>{this.events.emit(Jt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=t=>{this.logger.error(t),this.events.emit(Jt.error,t),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ui.payload,this.onPayloadHandler),this.provider.on(ui.connect,this.onConnectHandler),this.provider.on(ui.disconnect,this.onDisconnectHandler),this.provider.on(ui.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?Ce.generateChildLogger(r.logger,this.name):Ce.pino(Ce.getDefaultLoggerOptions({level:r.logger||EE})),this.messages=new kE(this.logger,r.core),this.subscriber=new QE(this,this.logger),this.publisher=new HE(this,this.logger),this.relayUrl=r?.relayUrl||Wf,this.projectId=r.projectId,this.bundleId=S1(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ql}...`),await this.restartTransport(ql)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},OE)}get context(){return Ce.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,t,n){this.isInitialized(),await this.publisher.publish(r,t,n),await this.recordMessageEvent({topic:r,message:t,publishedAt:Date.now()})}async subscribe(r,t){var n;this.isInitialized();let a=((n=this.subscriber.topicMap.get(r))==null?void 0:n[0])||"";if(a)return a;let h;const p=g=>{g.topic===r&&(this.subscriber.off(Mr.created,p),h())};return await Promise.all([new Promise(g=>{h=g,this.subscriber.on(Mr.created,p)}),new Promise(async g=>{a=await this.subscriber.subscribe(r,t),g()})]),a}async unsubscribe(r,t){this.isInitialized(),await this.subscriber.unsubscribe(r,t)}on(r,t){this.events.on(r,t)}once(r,t){this.events.once(r,t)}off(r,t){this.events.off(r,t)}removeListener(r,t){this.events.removeListener(r,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await is(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(r){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(t=>{if(!this.initialized)return t();this.subscriber.once(Mr.resubscribed,()=>{t()})}),new Promise(async(t,n)=>{try{await is(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){n(a);return}t()})])}catch(t){this.logger.error(t);const n=t;if(!this.isConnectionStalled(n.message))throw t;this.provider.events.emit(ui.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(r){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=r||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await pl())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(r){return this.staleConnectionErrors.some(t=>r.includes(t))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new fi(new qb(R1({sdkVersion:PE,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:t,message:n}=r;await this.messages.set(t,n)}async shouldIgnoreMessageEvent(r){const{topic:t,message:n}=r;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const a=this.messages.has(t,n);return a&&this.logger.debug(`Ignoring duplicate message: ${n}`),a}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),qc(r)){if(!r.method.endsWith(xE))return;const t=r.params,{topic:n,message:a,publishedAt:h}=t.data,p={topic:n,message:a,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(eI({type:"event",event:t.id},p)),this.events.emit(t.id,p),await this.acknowledgePayload(r),await this.onMessageEvent(p)}else Mc(r)&&this.events.emit(Jt.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Jt.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const t=Uc(r.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(ui.payload,this.onPayloadHandler),this.provider.off(ui.connect,this.onConnectHandler),this.provider.off(ui.disconnect,this.onDisconnectHandler),this.provider.off(ui.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Jt.connection_stalled,()=>{this.restartTransport().catch(t=>this.logger.error(t))});let r=await pl();Iw(async t=>{this.initialized&&r!==t&&(r=t,t?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Jt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(r=>this.logger.error(r))},se.toMiliseconds(SE)))}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(r=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var rI=Object.defineProperty,Hl=Object.getOwnPropertySymbols,iI=Object.prototype.hasOwnProperty,nI=Object.prototype.propertyIsEnumerable,Kl=(o,r,t)=>r in o?rI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,Vl=(o,r)=>{for(var t in r||(r={}))iI.call(r,t)&&Kl(o,t,r[t]);if(Hl)for(var t of Hl(r))nI.call(r,t)&&Kl(o,t,r[t]);return o};class Fo extends gb{constructor(r,t,n,a=Oi,h=void 0){super(r,t,n,a),this.core=r,this.logger=t,this.name=n,this.map=new Map,this.version=CE,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(p=>{this.getKey&&p!==null&&!ir(p)?this.map.set(this.getKey(p),p):ew(p)?this.map.set(p.id,p):tw(p)&&this.map.set(p.topic,p)}),this.cached=[],this.initialized=!0)},this.set=async(p,g)=>{this.isInitialized(),this.map.has(p)?await this.update(p,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:p,value:g}),this.map.set(p,g),await this.persist())},this.get=p=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:p}),this.getData(p)),this.getAll=p=>(this.isInitialized(),p?this.values.filter(g=>Object.keys(p).every(w=>Ub(g[w],p[w]))):this.values),this.update=async(p,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:p,update:g});const w=Vl(Vl({},this.getData(p)),g);this.map.set(p,w),await this.persist()},this.delete=async(p,g)=>{this.isInitialized(),this.map.has(p)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:p,reason:g}),this.map.delete(p),await this.persist())},this.logger=Ce.generateChildLogger(t,this.name),this.storagePrefix=a,this.getKey=h}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const t=this.map.get(r);if(!t){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class sI{constructor(r,t){this.core=r,this.logger=t,this.name=$E,this.version=FE,this.events=new Lc,this.initialized=!1,this.storagePrefix=Oi,this.ignoredPayloadTypes=[Gi],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Pc(),a=await this.core.crypto.setSymKey(n),h=Ur(se.FIVE_MINUTES),p={protocol:Gf},g={topic:a,expiry:h,relay:p,active:!1},w=K1({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:n,relay:p});return await this.pairings.set(a,g),await this.core.relayer.subscribe(a),this.core.expirer.set(a,h),{topic:a,uri:w}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:a,symKey:h,relay:p}=cl(n.uri);let g;if(this.pairings.keys.includes(a)&&(g=this.pairings.get(a),g.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const w=Ur(se.FIVE_MINUTES),y={topic:a,relay:p,expiry:w,active:!1};return await this.pairings.set(a,y),this.core.expirer.set(a,w),n.activatePairing&&await this.activate({topic:a}),this.events.emit(Xn.create,y),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(h,a),await this.core.relayer.subscribe(a,{relay:p})),y},this.activate=async({topic:n})=>{this.isInitialized();const a=Ur(se.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:a}),this.core.expirer.set(n,a)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:a}=n;if(this.pairings.keys.includes(a)){const h=await this.sendRequest(a,"wc_pairingPing",{}),{done:p,resolve:g,reject:w}=vn();this.events.once(Ft("pairing_ping",h),({error:y})=>{y?w(y):g()}),await p()}},this.updateExpiry=async({topic:n,expiry:a})=>{this.isInitialized(),await this.pairings.update(n,{expiry:a})},this.updateMetadata=async({topic:n,metadata:a})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:a}=n;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",It("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(n,a,h)=>{const p=ts(a,h),g=await this.core.crypto.encode(n,p),w=Gn[a].req;return this.core.history.set(n,p),this.core.relayer.publish(n,g,w),p.id},this.sendResult=async(n,a,h)=>{const p=Uc(n,h),g=await this.core.crypto.encode(a,p),w=await this.core.history.get(a,n),y=Gn[w.request.method].res;await this.core.relayer.publish(a,g,y),await this.core.history.resolve(p)},this.sendError=async(n,a,h)=>{const p=jc(n,h),g=await this.core.crypto.encode(a,p),w=await this.core.history.get(a,n),y=Gn[w.request.method]?Gn[w.request.method].res:Gn.unregistered_method.res;await this.core.relayer.publish(a,g,y),await this.core.history.resolve(p)},this.deletePairing=async(n,a)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,It("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),a?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(a=>Pi(a.expiry));await Promise.all(n.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=n=>{const{topic:a,payload:h}=n;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(a,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,h);default:return this.onUnknownRpcMethodRequest(a,h)}},this.onRelayEventResponse=async n=>{const{topic:a,payload:h}=n,p=(await this.core.history.get(a,h.id)).request.method;switch(p){case"wc_pairingPing":return this.onPairingPingResponse(a,h);default:return this.onUnknownRpcMethodResponse(p)}},this.onPairingPingRequest=async(n,a)=>{const{id:h}=a;try{this.isValidPing({topic:n}),await this.sendResult(h,n,!0),this.events.emit(Xn.ping,{id:h,topic:n})}catch(p){await this.sendError(h,n,p),this.logger.error(p)}},this.onPairingPingResponse=(n,a)=>{const{id:h}=a;setTimeout(()=>{Si(a)?this.events.emit(Ft("pairing_ping",h),{}):li(a)&&this.events.emit(Ft("pairing_ping",h),{error:a.error})},500)},this.onPairingDeleteRequest=async(n,a)=>{const{id:h}=a;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Xn.delete,{id:h,topic:n})}catch(p){await this.sendError(h,n,p),this.logger.error(p)}},this.onUnknownRpcMethodRequest=async(n,a)=>{const{id:h,method:p}=a;try{if(this.registeredMethods.includes(p))return;const g=It("WC_METHOD_UNSUPPORTED",p);await this.sendError(h,n,g),this.logger.error(g)}catch(g){await this.sendError(h,n,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(It("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var a;if(!dr(n)){const{message:p}=Z("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(p)}if(!X1(n.uri)){const{message:p}=Z("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(p)}const h=cl(n.uri);if(!((a=h?.relay)!=null&&a.protocol)){const{message:p}=Z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(p)}if(!(h!=null&&h.symKey)){const{message:p}=Z("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(p)}},this.isValidPing=async n=>{if(!dr(n)){const{message:h}=Z("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(h)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidDisconnect=async n=>{if(!dr(n)){const{message:h}=Z("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(h)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async n=>{if(!kt(n,!1)){const{message:a}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(a)}if(!this.pairings.keys.includes(n)){const{message:a}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(a)}if(Pi(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:a}=Z("EXPIRED",`pairing topic: ${n}`);throw new Error(a)}},this.core=r,this.logger=Ce.generateChildLogger(t,this.name),this.pairings=new Fo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ce.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Jt.message,async r=>{const{topic:t,message:n}=r;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const a=await this.core.crypto.decode(t,n);try{qc(a)?(this.core.history.set(t,a),this.onRelayEventRequest({topic:t,payload:a})):Mc(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a}),this.core.history.delete(t,a.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(Tr.expired,async r=>{const{topic:t}=If(r.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Xn.expire,{topic:t}))})}}class oI extends lb{constructor(r,t){super(r,t),this.core=r,this.logger=t,this.records=new Map,this.events=new Qr.EventEmitter,this.name=DE,this.version=LE,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,a,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:a,chainId:h}),this.records.has(a.id))return;const p={id:a.id,topic:n,request:{method:a.method,params:a.params||null},chainId:h,expiry:Ur(se.THIRTY_DAYS)};this.records.set(p.id,p),this.events.emit(Wr.created,p)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const a=await this.getRecord(n.id);typeof a.response>"u"&&(a.response=li(n)?{error:n.error}:{result:n.result},this.records.set(a.id,a),this.events.emit(Wr.updated,a))},this.get=async(n,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:a}),await this.getRecord(a)),this.delete=(n,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(h=>{if(h.topic===n){if(typeof a<"u"&&h.id!==a)return;this.records.delete(h.id),this.events.emit(Wr.deleted,h)}})},this.exists=async(n,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===n:!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const n={topic:t.topic,request:ts(t.request.method,t.request.params,t.id),chainId:t.chainId};return r.push(n)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const t=this.records.get(r);if(!t){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Wr.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(Wr.created,r=>{const t=Wr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:r}),this.persist()}),this.events.on(Wr.updated,r=>{const t=Wr.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:r}),this.persist()}),this.events.on(Wr.deleted,r=>{const t=Wr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:r}),this.persist()}),this.core.heartbeat.on(Sn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{se.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class aI extends mb{constructor(r,t){super(r,t),this.core=r,this.logger=t,this.expirations=new Map,this.events=new Qr.EventEmitter,this.name=jE,this.version=qE,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const a=this.formatTarget(n);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(n,a)=>{this.isInitialized();const h=this.formatTarget(n),p={target:h,expiry:a};this.expirations.set(h,p),this.checkExpiry(h,p),this.events.emit(Tr.created,{target:h,expiration:p})},this.get=n=>{this.isInitialized();const a=this.formatTarget(n);return this.getExpiration(a)},this.del=n=>{if(this.isInitialized(),this.has(n)){const a=this.formatTarget(n),h=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Tr.deleted,{target:a,expiration:h})}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return T1(r);if(typeof r=="number")return $1(r);const{message:t}=Z("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(t)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Tr.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const t=this.expirations.get(r);if(!t){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return t}checkExpiry(r,t){const{expiry:n}=t;se.toMiliseconds(n)-Date.now()<=0&&this.expire(r,t)}expire(r,t){this.expirations.delete(r),this.events.emit(Tr.expired,{target:r,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,t)=>this.checkExpiry(t,r))}registerEventListeners(){this.core.heartbeat.on(Sn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Tr.created,r=>{const t=Tr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),this.persist()}),this.events.on(Tr.expired,r=>{const t=Tr.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),this.persist()}),this.events.on(Tr.deleted,r=>{const t=Tr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class cI extends vb{constructor(r,t){super(r,t),this.projectId=r,this.logger=t,this.name=gc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||En()||!In())return;const a=this.getVerifyUrl(n?.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Rc;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(n?.verifyUrl);let h;try{h=await this.fetchAttestation(n.attestationId,a)}catch(p){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${a}`),this.logger.info(p),h=await this.fetchAttestation(n.attestationId,Rc)}return h},this.fetchAttestation=async(n,a)=>{this.logger.info(`resolving attestation: ${n} from url: ${a}`);const h=this.startAbortTimer(se.ONE_SECOND*2),p=await fetch(`${a}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(h),p.status===200?await p.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const a=h=>{h.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),n())};await Promise.race([new Promise(h=>{if(document.getElementById(gc))return h();window.addEventListener("message",a);const p=document.createElement("iframe");p.id=gc,p.src=`${this.verifyUrl}/${this.projectId}`,p.style.display="none",document.body.append(p),this.iframe=p,n=h}),new Promise((h,p)=>setTimeout(()=>{window.removeEventListener("message",a),p("verify iframe load timeout")},se.toMiliseconds(se.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let a=n||wn;return ME.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${wn}`),a=wn),a},this.logger=Ce.generateChildLogger(t,this.name),this.verifyUrl=wn,this.abortController=new AbortController,this.isDevEnv=Kc()&&{}.IS_VITEST}get context(){return Ce.getLoggerContext(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),se.toMiliseconds(r))}}var uI=Object.defineProperty,Bl=Object.getOwnPropertySymbols,hI=Object.prototype.hasOwnProperty,lI=Object.prototype.propertyIsEnumerable,Gl=(o,r,t)=>r in o?uI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,Wl=(o,r)=>{for(var t in r||(r={}))hI.call(r,t)&&Gl(o,t,r[t]);if(Bl)for(var t of Bl(r))lI.call(r,t)&&Gl(o,t,r[t]);return o};class Jc extends hb{constructor(r){super(r),this.protocol=Bf,this.version=lE,this.name=Wc,this.events=new Qr.EventEmitter,this.initialized=!1,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.projectId=r?.projectId,this.relayUrl=r?.relayUrl||Wf,this.customStoragePrefix=r!=null&&r.customStoragePrefix?`:${r.customStoragePrefix}`:"";const t=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:r?.logger||fE.logger}));this.logger=Ce.generateChildLogger(t,this.name),this.heartbeat=new Sn.HeartBeat,this.crypto=new zE(this,this.logger,r?.keychain),this.history=new oI(this,this.logger),this.expirer=new aI(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new tb(Wl(Wl({},pE),r?.storageOptions)),this.relayer=new tI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new sI(this,this.logger),this.verify=new cI(this.projectId||"",this.logger)}static async init(r){const t=new Jc(r);await t.initialize();const n=await t.crypto.getClientId();return await t.storage.setItem(AE,n),t}get context(){return Ce.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const fI=Jc,Jf="wc",Qf=2,Yf="client",Qc=`${Jf}@${Qf}:${Yf}:`,mc={name:Yf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Jl="WALLETCONNECT_DEEPLINK_CHOICE",pI="proposal",Zf="Proposal expired",dI="session",wo=se.SEVEN_DAYS,gI="engine",Jn={wc_sessionPropose:{req:{ttl:se.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1104},res:{ttl:se.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1106},res:{ttl:se.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:se.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:se.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1112},res:{ttl:se.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:se.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:se.THIRTY_SECONDS,prompt:!1,tag:1115}}},vc={min:se.FIVE_MINUTES,max:se.SEVEN_DAYS},hi={idle:"IDLE",active:"ACTIVE"},yI="request",mI=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var vI=Object.defineProperty,wI=Object.defineProperties,bI=Object.getOwnPropertyDescriptors,Ql=Object.getOwnPropertySymbols,_I=Object.prototype.hasOwnProperty,EI=Object.prototype.propertyIsEnumerable,Yl=(o,r,t)=>r in o?vI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,fr=(o,r)=>{for(var t in r||(r={}))_I.call(r,t)&&Yl(o,t,r[t]);if(Ql)for(var t of Ql(r))EI.call(r,t)&&Yl(o,t,r[t]);return o},Qn=(o,r)=>wI(o,bI(r));class II extends bb{constructor(r){super(r),this.name=gI,this.events=new Lc,this.initialized=!1,this.ignoredPayloadTypes=[Gi],this.requestQueue={state:hi.idle,queue:[]},this.sessionRequestQueue={state:hi.idle,queue:[]},this.requestQueueDelay=se.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Jn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},se.toMiliseconds(this.requestQueueDelay)))},this.connect=async t=>{await this.isInitialized();const n=Qn(fr({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:a,requiredNamespaces:h,optionalNamespaces:p,sessionProperties:g,relays:w}=n;let y=a,b,S=!1;if(y&&(S=this.client.core.pairing.pairings.get(y).active),!y||!S){const{topic:$,uri:M}=await this.client.core.pairing.create();y=$,b=M}const N=await this.client.core.crypto.generateKeyPair(),K=fr({requiredNamespaces:h,optionalNamespaces:p,relays:w??[{protocol:Gf}],proposer:{publicKey:N,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:j,resolve:J,done:oe}=vn(se.FIVE_MINUTES,Zf);if(this.events.once(Ft("session_connect"),async({error:$,session:M})=>{if($)j($);else if(M){M.self.publicKey=N;const q=Qn(fr({},M),{requiredNamespaces:M.requiredNamespaces,optionalNamespaces:M.optionalNamespaces});await this.client.session.set(M.topic,q),await this.setExpiry(M.topic,M.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:M.peer.metadata}),J(q)}}),!y){const{message:$}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error($)}const fe=await this.sendRequest({topic:y,method:"wc_sessionPropose",params:K}),C=Ur(se.FIVE_MINUTES);return await this.setProposal(fe,fr({id:fe,expiry:C},K)),{uri:b,approval:oe}},this.pair=async t=>(await this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{await this.isInitialized(),await this.isValidApprove(t);const{id:n,relayProtocol:a,namespaces:h,sessionProperties:p}=t,g=this.client.proposal.get(n);let{pairingTopic:w,proposer:y,requiredNamespaces:b,optionalNamespaces:S}=g;w=w||"",_n(b)||(b=W1(h,"approve()"));const N=await this.client.core.crypto.generateKeyPair(),K=y.publicKey,j=await this.client.core.crypto.generateSharedKey(N,K);w&&n&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:y.metadata}),await this.sendResult({id:n,topic:w,result:{relay:{protocol:a??"irn"},responderPublicKey:N}}),await this.client.proposal.delete(n,It("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const J=fr({relay:{protocol:a??"irn"},namespaces:h,requiredNamespaces:b,optionalNamespaces:S,pairingTopic:w,controller:{publicKey:N,metadata:this.client.metadata},expiry:Ur(wo)},p&&{sessionProperties:p});await this.client.core.relayer.subscribe(j),await this.sendRequest({topic:j,method:"wc_sessionSettle",params:J,throwOnFailedPublish:!0});const oe=Qn(fr({},J),{topic:j,pairingTopic:w,acknowledged:!1,self:J.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:N});return await this.client.session.set(j,oe),await this.setExpiry(j,Ur(wo)),{topic:j,acknowledged:()=>new Promise(fe=>setTimeout(()=>fe(this.client.session.get(j)),500))}},this.reject=async t=>{await this.isInitialized(),await this.isValidReject(t);const{id:n,reason:a}=t,{pairingTopic:h}=this.client.proposal.get(n);h&&(await this.sendError(n,h,a),await this.client.proposal.delete(n,It("USER_DISCONNECTED")))},this.update=async t=>{await this.isInitialized(),await this.isValidUpdate(t);const{topic:n,namespaces:a}=t,h=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:p,resolve:g,reject:w}=vn();return this.events.once(Ft("session_update",h),({error:y})=>{y?w(y):g()}),await this.client.session.update(n,{namespaces:a}),{acknowledged:p}},this.extend=async t=>{await this.isInitialized(),await this.isValidExtend(t);const{topic:n}=t,a=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:h,resolve:p,reject:g}=vn();return this.events.once(Ft("session_extend",a),({error:w})=>{w?g(w):p()}),await this.setExpiry(n,Ur(wo)),{acknowledged:h}},this.request=async t=>{await this.isInitialized(),await this.isValidRequest(t);const{chainId:n,request:a,topic:h,expiry:p}=t,g=o1(),{done:w,resolve:y,reject:b}=vn(p,"Request expired. Please try again.");return this.events.once(Ft("session_request",g),({error:S,result:N})=>{S?b(S):y(N)}),await Promise.all([new Promise(async S=>{await this.sendRequest({clientRpcId:g,topic:h,method:"wc_sessionRequest",params:{request:a,chainId:n},expiry:p,throwOnFailedPublish:!0}).catch(N=>b(N)),this.client.events.emit("session_request_sent",{topic:h,request:a,chainId:n,id:g}),S()}),new Promise(async S=>{const N=await D1(this.client.core.storage,Jl);F1({id:g,topic:h,wcDeepLink:N}),S()}),w()]).then(S=>S[2])},this.respond=async t=>{await this.isInitialized(),await this.isValidRespond(t);const{topic:n,response:a}=t,{id:h}=a;Si(a)?await this.sendResult({id:h,topic:n,result:a.result,throwOnFailedPublish:!0}):li(a)&&await this.sendError(h,n,a.error),this.cleanupAfterResponse(t)},this.ping=async t=>{await this.isInitialized(),await this.isValidPing(t);const{topic:n}=t;if(this.client.session.keys.includes(n)){const a=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:h,resolve:p,reject:g}=vn();this.events.once(Ft("session_ping",a),({error:w})=>{w?g(w):p()}),await h()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async t=>{await this.isInitialized(),await this.isValidEmit(t);const{topic:n,event:a,chainId:h}=t;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:a,chainId:h}})},this.disconnect=async t=>{await this.isInitialized(),await this.isValidDisconnect(t);const{topic:n}=t;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:It("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(n=>Y1(n,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async t=>{if(t.pairingTopic)try{const n=this.client.core.pairing.pairings.get(t.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(h=>{var p,g;return((p=h.peerMetadata)==null?void 0:p.url)&&((g=h.peerMetadata)==null?void 0:g.url)===t.peer.metadata.url&&h.topic&&h.topic!==n.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(t,n)=>{const{self:a}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),this.client.session.delete(t,It("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),n||this.client.core.expirer.del(t),this.client.core.storage.removeItem(Jl).catch(h=>this.client.logger.warn(h))},this.deleteProposal=async(t,n)=>{await Promise.all([this.client.proposal.delete(t,It("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,n,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,n),a?Promise.resolve():this.client.core.expirer.del(t)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==t),a&&(this.sessionRequestQueue.state=hi.idle)},this.setExpiry=async(t,n)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:n}),this.client.core.expirer.set(t,n)},this.setProposal=async(t,n)=>{await this.client.proposal.set(t,n),this.client.core.expirer.set(t,n.expiry)},this.setPendingSessionRequest=async t=>{const n=Jn.wc_sessionRequest.req.ttl,{id:a,topic:h,params:p,verifyContext:g}=t;await this.client.pendingRequest.set(a,{id:a,topic:h,params:p,verifyContext:g}),n&&this.client.core.expirer.set(a,Ur(n))},this.sendRequest=async t=>{const{topic:n,method:a,params:h,expiry:p,relayRpcId:g,clientRpcId:w,throwOnFailedPublish:y}=t,b=ts(a,h,w);if(In()&&mI.includes(a)){const K=bn(JSON.stringify(b));this.client.core.verify.register({attestationId:K})}const S=await this.client.core.crypto.encode(n,b),N=Jn[a].req;return p&&(N.ttl=p),g&&(N.id=g),this.client.core.history.set(n,b),y?(N.internal=Qn(fr({},N.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,S,N)):this.client.core.relayer.publish(n,S,N).catch(K=>this.client.logger.error(K)),b.id},this.sendResult=async t=>{const{id:n,topic:a,result:h,throwOnFailedPublish:p}=t,g=Uc(n,h),w=await this.client.core.crypto.encode(a,g),y=await this.client.core.history.get(a,n),b=Jn[y.request.method].res;p?(b.internal=Qn(fr({},b.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,w,b)):this.client.core.relayer.publish(a,w,b).catch(S=>this.client.logger.error(S)),await this.client.core.history.resolve(g)},this.sendError=async(t,n,a)=>{const h=jc(t,a),p=await this.client.core.crypto.encode(n,h),g=await this.client.core.history.get(n,t),w=Jn[g.request.method].res;this.client.core.relayer.publish(n,p,w),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const t=[],n=[];this.client.session.getAll().forEach(a=>{Pi(a.expiry)&&t.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Pi(a.expiry)&&n.push(a.id)}),await Promise.all([...t.map(a=>this.deleteSession(a)),...n.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===hi.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=hi.active;const t=this.requestQueue.queue.shift();if(t)try{this.processRequest(t),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=hi.idle},this.processRequest=t=>{const{topic:n,payload:a}=t,h=a.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(n,a);case"wc_sessionSettle":return this.onSessionSettleRequest(n,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,a);case"wc_sessionExtend":return this.onSessionExtendRequest(n,a);case"wc_sessionPing":return this.onSessionPingRequest(n,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,a);case"wc_sessionRequest":return this.onSessionRequest(n,a);case"wc_sessionEvent":return this.onSessionEventRequest(n,a);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async t=>{const{topic:n,payload:a}=t,h=(await this.client.core.history.get(n,a.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(n,a);case"wc_sessionSettle":return this.onSessionSettleResponse(n,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,a);case"wc_sessionExtend":return this.onSessionExtendResponse(n,a);case"wc_sessionPing":return this.onSessionPingResponse(n,a);case"wc_sessionRequest":return this.onSessionRequestResponse(n,a);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=t=>{const{topic:n}=t,{message:a}=Z("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(t,n)=>{const{params:a,id:h}=n;try{this.isValidConnect(fr({},n.params));const p=Ur(se.FIVE_MINUTES),g=fr({id:h,pairingTopic:t,expiry:p},a);await this.setProposal(h,g);const w=bn(JSON.stringify(n)),y=await this.getVerifyContext(w,g.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:g,verifyContext:y})}catch(p){await this.sendError(h,t,p),this.client.logger.error(p)}},this.onSessionProposeResponse=async(t,n)=>{const{id:a}=n;if(Si(n)){const{result:h}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const p=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:p});const g=p.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const w=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const y=await this.client.core.crypto.generateSharedKey(g,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:y});const b=await this.client.core.relayer.subscribe(y);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:b}),await this.client.core.pairing.activate({topic:t})}else li(n)&&(await this.client.proposal.delete(a,It("USER_DISCONNECTED")),this.events.emit(Ft("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(t,n)=>{const{id:a,params:h}=n;try{this.isValidSessionSettleRequest(h);const{relay:p,controller:g,expiry:w,namespaces:y,requiredNamespaces:b,optionalNamespaces:S,sessionProperties:N,pairingTopic:K}=n.params,j=fr({topic:t,relay:p,expiry:w,namespaces:y,acknowledged:!0,pairingTopic:K,requiredNamespaces:b,optionalNamespaces:S,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},N&&{sessionProperties:N});await this.sendResult({id:n.id,topic:t,result:!0}),this.events.emit(Ft("session_connect"),{session:j}),this.cleanupDuplicatePairings(j)}catch(p){await this.sendError(a,t,p),this.client.logger.error(p)}},this.onSessionSettleResponse=async(t,n)=>{const{id:a}=n;Si(n)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Ft("session_approve",a),{})):li(n)&&(await this.client.session.delete(t,It("USER_DISCONNECTED")),this.events.emit(Ft("session_approve",a),{error:n.error}))},this.onSessionUpdateRequest=async(t,n)=>{const{params:a,id:h}=n;try{const p=`${t}_session_update`,g=yo.get(p);if(g&&this.isRequestOutOfSync(g,h)){this.client.logger.info(`Discarding out of sync request - ${h}`);return}this.isValidUpdate(fr({topic:t},a)),await this.client.session.update(t,{namespaces:a.namespaces}),await this.sendResult({id:h,topic:t,result:!0}),this.client.events.emit("session_update",{id:h,topic:t,params:a}),yo.set(p,h)}catch(p){await this.sendError(h,t,p),this.client.logger.error(p)}},this.isRequestOutOfSync=(t,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(t.toString().slice(0,-3)),this.onSessionUpdateResponse=(t,n)=>{const{id:a}=n;Si(n)?this.events.emit(Ft("session_update",a),{}):li(n)&&this.events.emit(Ft("session_update",a),{error:n.error})},this.onSessionExtendRequest=async(t,n)=>{const{id:a}=n;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Ur(wo)),await this.sendResult({id:a,topic:t,result:!0}),this.client.events.emit("session_extend",{id:a,topic:t})}catch(h){await this.sendError(a,t,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(t,n)=>{const{id:a}=n;Si(n)?this.events.emit(Ft("session_extend",a),{}):li(n)&&this.events.emit(Ft("session_extend",a),{error:n.error})},this.onSessionPingRequest=async(t,n)=>{const{id:a}=n;try{this.isValidPing({topic:t}),await this.sendResult({id:a,topic:t,result:!0}),this.client.events.emit("session_ping",{id:a,topic:t})}catch(h){await this.sendError(a,t,h),this.client.logger.error(h)}},this.onSessionPingResponse=(t,n)=>{const{id:a}=n;setTimeout(()=>{Si(n)?this.events.emit(Ft("session_ping",a),{}):li(n)&&this.events.emit(Ft("session_ping",a),{error:n.error})},500)},this.onSessionDeleteRequest=async(t,n)=>{const{id:a}=n;try{this.isValidDisconnect({topic:t,reason:n.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Jt.publish,async()=>{h(await this.deleteSession(t))})}),this.sendResult({id:a,topic:t,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:t})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(t,n)=>{const{id:a,params:h}=n;try{this.isValidRequest(fr({topic:t},h));const p=bn(JSON.stringify(ts("wc_sessionRequest",h,a))),g=this.client.session.get(t),w=await this.getVerifyContext(p,g.peer.metadata),y={id:a,topic:t,params:h,verifyContext:w};await this.setPendingSessionRequest(y),this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue()}catch(p){await this.sendError(a,t,p),this.client.logger.error(p)}},this.onSessionRequestResponse=(t,n)=>{const{id:a}=n;Si(n)?this.events.emit(Ft("session_request",a),{result:n.result}):li(n)&&this.events.emit(Ft("session_request",a),{error:n.error})},this.onSessionEventRequest=async(t,n)=>{const{id:a,params:h}=n;try{const p=`${t}_session_event_${h.event.name}`,g=yo.get(p);if(g&&this.isRequestOutOfSync(g,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(fr({topic:t},h)),this.client.events.emit("session_event",{id:a,topic:t,params:h}),yo.set(p,a)}catch(p){await this.sendError(a,t,p),this.client.logger.error(p)}},this.addSessionRequestToSessionRequestQueue=t=>{this.sessionRequestQueue.queue.push(t)},this.cleanupAfterResponse=t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=hi.idle,this.processSessionRequestQueue()},se.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===hi.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=hi.active,this.client.events.emit("session_request",t)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=t=>{if(t.active)return;const n=this.client.proposal.getAll().find(a=>a.pairingTopic===t.topic);n&&this.onSessionProposeRequest(t.topic,ts("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async t=>{if(!dr(t)){const{message:w}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(w)}const{pairingTopic:n,requiredNamespaces:a,optionalNamespaces:h,sessionProperties:p,relays:g}=t;if(ir(n)||await this.isValidPairingTopic(n),!uw(g,!0)){const{message:w}=Z("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(w)}!ir(a)&&_n(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!ir(h)&&_n(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),ir(p)||this.validateSessionProps(p,"sessionProperties")},this.validateNamespaces=(t,n)=>{const a=cw(t,"connect()",n);if(a)throw new Error(a.message)},this.isValidApprove=async t=>{if(!dr(t))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:n,namespaces:a,relayProtocol:h,sessionProperties:p}=t;await this.isValidProposalId(n);const g=this.client.proposal.get(n),w=Io(a,"approve()");if(w)throw new Error(w.message);const y=ll(g.requiredNamespaces,a,"approve()");if(y)throw new Error(y.message);if(!kt(h,!0)){const{message:b}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(b)}ir(p)||this.validateSessionProps(p,"sessionProperties")},this.isValidReject=async t=>{if(!dr(t)){const{message:h}=Z("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(h)}const{id:n,reason:a}=t;if(await this.isValidProposalId(n),!lw(a)){const{message:h}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(h)}},this.isValidSessionSettleRequest=t=>{if(!dr(t)){const{message:y}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(y)}const{relay:n,controller:a,namespaces:h,expiry:p}=t;if(!Sf(n)){const{message:y}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(y)}const g=rw(a,"onSessionSettleRequest()");if(g)throw new Error(g.message);const w=Io(h,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Pi(p)){const{message:y}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(y)}},this.isValidUpdate=async t=>{if(!dr(t)){const{message:w}=Z("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(w)}const{topic:n,namespaces:a}=t;await this.isValidSessionTopic(n);const h=this.client.session.get(n),p=Io(a,"update()");if(p)throw new Error(p.message);const g=ll(h.requiredNamespaces,a,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async t=>{if(!dr(t)){const{message:a}=Z("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(a)}const{topic:n}=t;await this.isValidSessionTopic(n)},this.isValidRequest=async t=>{if(!dr(t)){const{message:w}=Z("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(w)}const{topic:n,request:a,chainId:h,expiry:p}=t;await this.isValidSessionTopic(n);const{namespaces:g}=this.client.session.get(n);if(!hl(g,h)){const{message:w}=Z("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(w)}if(!fw(a)){const{message:w}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(w)}if(!gw(g,h,a.method)){const{message:w}=Z("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(w)}if(p&&!ww(p,vc)){const{message:w}=Z("MISSING_OR_INVALID",`request() expiry: ${p}. Expiry must be a number (in seconds) between ${vc.min} and ${vc.max}`);throw new Error(w)}},this.isValidRespond=async t=>{if(!dr(t)){const{message:h}=Z("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(h)}const{topic:n,response:a}=t;if(await this.isValidSessionTopic(n),!pw(a)){const{message:h}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(h)}},this.isValidPing=async t=>{if(!dr(t)){const{message:a}=Z("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(a)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async t=>{if(!dr(t)){const{message:g}=Z("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(g)}const{topic:n,event:a,chainId:h}=t;await this.isValidSessionTopic(n);const{namespaces:p}=this.client.session.get(n);if(!hl(p,h)){const{message:g}=Z("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(g)}if(!dw(a)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}if(!yw(p,h,a.name)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}},this.isValidDisconnect=async t=>{if(!dr(t)){const{message:a}=Z("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(a)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(t,n)=>{const a={verified:{verifyUrl:n.verifyUrl||wn,validation:"UNKNOWN",origin:n.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:t,verifyUrl:n.verifyUrl});h&&(a.verified.origin=h.origin,a.verified.isScam=h.isScam,a.verified.validation=h.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(t,n)=>{Object.values(t).forEach(a=>{if(!kt(a,!1)){const{message:h}=Z("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(h)}})}}async isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Jt.message,async r=>{const{topic:t,message:n}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const a=await this.client.core.crypto.decode(t,n);try{qc(a)?(this.client.core.history.set(t,a),this.onRelayEventRequest({topic:t,payload:a})):Mc(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a}),this.client.core.history.delete(t,a.id)):this.onRelayEventUnknownPayload({topic:t,payload:a})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(Tr.expired,async r=>{const{topic:t,id:n}=If(r.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,Z("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Xn.create,r=>this.onPairingCreated(r))}isValidPairingTopic(r){if(!kt(r,!1)){const{message:t}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:t}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(t)}if(Pi(this.client.core.pairing.pairings.get(r).expiry)){const{message:t}=Z("EXPIRED",`pairing topic: ${r}`);throw new Error(t)}}async isValidSessionTopic(r){if(!kt(r,!1)){const{message:t}=Z("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(t)}if(!this.client.session.keys.includes(r)){const{message:t}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(t)}if(Pi(this.client.session.get(r).expiry)){await this.deleteSession(r);const{message:t}=Z("EXPIRED",`session topic: ${r}`);throw new Error(t)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(kt(r,!1)){const{message:t}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(t)}else{const{message:t}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(t)}}async isValidProposalId(r){if(!hw(r)){const{message:t}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(t)}if(!this.client.proposal.keys.includes(r)){const{message:t}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(t)}if(Pi(this.client.proposal.get(r).expiry)){await this.deleteProposal(r);const{message:t}=Z("EXPIRED",`proposal id: ${r}`);throw new Error(t)}}}class xI extends Fo{constructor(r,t){super(r,t,pI,Qc),this.core=r,this.logger=t}}class SI extends Fo{constructor(r,t){super(r,t,dI,Qc),this.core=r,this.logger=t}}class PI extends Fo{constructor(r,t){super(r,t,yI,Qc,n=>n.id),this.core=r,this.logger=t}}let OI=class Xf extends wb{constructor(r){super(r),this.protocol=Jf,this.version=Qf,this.name=mc.name,this.events=new Qr.EventEmitter,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(a){throw this.logger.error(a.message),a}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(a){throw this.logger.error(a.message),a}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(a){throw this.logger.error(a.message),a}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(a){throw this.logger.error(a.message),a}},this.update=async n=>{try{return await this.engine.update(n)}catch(a){throw this.logger.error(a.message),a}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(a){throw this.logger.error(a.message),a}},this.request=async n=>{try{return await this.engine.request(n)}catch(a){throw this.logger.error(a.message),a}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(a){throw this.logger.error(a.message),a}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(a){throw this.logger.error(a.message),a}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(a){throw this.logger.error(a.message),a}},this.find=n=>{try{return this.engine.find(n)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=r?.name||mc.name,this.metadata=r?.metadata||O1();const t=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:r?.logger||mc.logger}));this.core=r?.core||new fI(r),this.logger=Ce.generateChildLogger(t,this.name),this.session=new SI(this.core,this.logger),this.proposal=new xI(this.core,this.logger),this.pendingRequest=new PI(this.core,this.logger),this.engine=new II(this)}static async init(r){const t=new Xf(r);return await t.initialize(),t}get context(){return Ce.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}};const Zl="error",CI="wss://relay.walletconnect.com",AI="wc",NI="universal_provider",Xl=`${AI}@2:${NI}:`,RI="https://rpc.walletconnect.com/v1/",pi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Yn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Tc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,r){(function(){var t,n="4.17.21",a=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",g="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",y=500,b="__lodash_placeholder__",S=1,N=2,K=4,j=1,J=2,oe=1,fe=2,C=4,$=8,M=16,q=32,I=64,D=128,H=256,ce=512,ae=30,Ee="...",Ae=800,et=16,T=1,V=2,Me=3,Ne=1/0,ee=9007199254740991,Q=17976931348623157e292,W=0/0,Y=4294967295,ut=Y-1,ke=Y>>>1,zr=[["ary",D],["bind",oe],["bindKey",fe],["curry",$],["curryRight",M],["flip",ce],["partial",q],["partialRight",I],["rearg",H]],be="[object Arguments]",xt="[object Array]",L="[object AsyncFunction]",F="[object Boolean]",A="[object Date]",u="[object DOMException]",E="[object Error]",ie="[object Function]",pe="[object GeneratorFunction]",ve="[object Map]",Re="[object Number]",$e="[object Null]",xe="[object Object]",St="[object Promise]",vt="[object Proxy]",st="[object RegExp]",De="[object Set]",Je="[object String]",Qe="[object Symbol]",ot="[object Undefined]",Ue="[object WeakMap]",Ye="[object WeakSet]",Te="[object ArrayBuffer]",He="[object DataView]",ht="[object Float32Array]",je="[object Float64Array]",Pt="[object Int8Array]",Dt="[object Int16Array]",Ht="[object Int32Array]",Kt="[object Uint8Array]",qt="[object Uint8ClampedArray]",Qt="[object Uint16Array]",or="[object Uint32Array]",kr=/\b__p \+= '';/g,Yt=/\b(__p \+=) '' \+/g,Yr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,di=/&(?:amp|lt|gt|quot|#39);/g,Ni=/[&<>"']/g,lt=RegExp(di.source),tt=RegExp(Ni.source),ft=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,at=/<%=([\s\S]+?)%>/g,rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(dt.source),gt=/^\s+/,wt=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Nt=/,? & /,Rt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Do=/[()=,{}\[\]\/\s]/,Lo=/\\(\\)?/g,jo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ir=/\w*$/,qo=/^[-+]0x[0-9a-f]+$/i,Mo=/^0b[01]+$/i,Uo=/^\[object .+?Constructor\]$/,zo=/^0o[0-7]+$/i,ko=/^(?:0|[1-9]\d*)$/,Zr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Yi=/($^)/,Ho=/['\n\r\u2028\u2029\\]/g,Zi="\\ud800-\\udfff",Ko="\\u0300-\\u036f",Vo="\\ufe20-\\ufe2f",Xi="\\u20d0-\\u20ff",hs=Ko+Vo+Xi,ls="\\u2700-\\u27bf",$r="a-z\\xdf-\\xf6\\xf8-\\xff",Bo="\\xac\\xb1\\xd7\\xf7",Go="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Wo="\\u2000-\\u206f",Jo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",fs="A-Z\\xc0-\\xd6\\xd8-\\xde",ps="\\ufe0e\\ufe0f",Ri=Bo+Go+Wo+Jo,Pn="['’]",Ti="["+Zi+"]",On="["+Ri+"]",$i="["+hs+"]",ds="\\d+",Qo="["+ls+"]",gs="["+$r+"]",ys="[^"+Zi+Ri+ds+ls+$r+fs+"]",en="\\ud83c[\\udffb-\\udfff]",Yo="(?:"+$i+"|"+en+")",ms="[^"+Zi+"]",tn="(?:\\ud83c[\\udde6-\\uddff]){2}",gi="[\\ud800-\\udbff][\\udc00-\\udfff]",yr="["+fs+"]",vs="\\u200d",ws="(?:"+gs+"|"+ys+")",Hr="(?:"+yr+"|"+ys+")",bs="(?:"+Pn+"(?:d|ll|m|re|s|t|ve))?",_s="(?:"+Pn+"(?:D|LL|M|RE|S|T|VE))?",Es=Yo+"?",Is="["+ps+"]?",Zo="(?:"+vs+"(?:"+[ms,tn,gi].join("|")+")"+Is+Es+")*",Xr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",xs="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ss=Is+Es+Zo,rn="(?:"+[Qo,tn,gi].join("|")+")"+Ss,Xo="(?:"+[ms+$i+"?",$i,tn,gi,Ti].join("|")+")",Cn=RegExp(Pn,"g"),ea=RegExp($i,"g"),nn=RegExp(en+"(?="+en+")|"+Xo+Ss,"g"),Ps=RegExp([yr+"?"+gs+"+"+bs+"(?="+[On,yr,"$"].join("|")+")",Hr+"+"+_s+"(?="+[On,yr+ws,"$"].join("|")+")",yr+"?"+ws+"+"+bs,yr+"+"+_s,xs,Xr,ds,rn].join("|"),"g"),Os=RegExp("["+vs+Zi+hs+ps+"]"),Fi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Cs=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ta=-1,Ke={};Ke[ht]=Ke[je]=Ke[Pt]=Ke[Dt]=Ke[Ht]=Ke[Kt]=Ke[qt]=Ke[Qt]=Ke[or]=!0,Ke[be]=Ke[xt]=Ke[Te]=Ke[F]=Ke[He]=Ke[A]=Ke[E]=Ke[ie]=Ke[ve]=Ke[Re]=Ke[xe]=Ke[st]=Ke[De]=Ke[Je]=Ke[Ue]=!1;var ze={};ze[be]=ze[xt]=ze[Te]=ze[He]=ze[F]=ze[A]=ze[ht]=ze[je]=ze[Pt]=ze[Dt]=ze[Ht]=ze[ve]=ze[Re]=ze[xe]=ze[st]=ze[De]=ze[Je]=ze[Qe]=ze[Kt]=ze[qt]=ze[Qt]=ze[or]=!0,ze[E]=ze[ie]=ze[Ue]=!1;var m={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},B={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},te={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,ge=parseInt,Ze=typeof Yn=="object"&&Yn&&Yn.Object===Object&&Yn,Tt=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Ze||Tt||Function("return this")(),Be=r&&!r.nodeType&&r,bt=Be&&!0&&o&&!o.nodeType&&o,ar=bt&&bt.exports===Be,$t=ar&&Ze.process,Xe=function(){try{var P=bt&&bt.require&&bt.require("util").types;return P||$t&&$t.binding&&$t.binding("util")}catch{}}(),Zt=Xe&&Xe.isArrayBuffer,Fr=Xe&&Xe.isDate,xr=Xe&&Xe.isMap,Kr=Xe&&Xe.isRegExp,An=Xe&&Xe.isSet,Di=Xe&&Xe.isTypedArray;function Mt(P,U,R){switch(R.length){case 0:return P.call(U);case 1:return P.call(U,R[0]);case 2:return P.call(U,R[0],R[1]);case 3:return P.call(U,R[0],R[1],R[2])}return P.apply(U,R)}function rp(P,U,R,re){for(var de=-1,Fe=P==null?0:P.length;++de<Fe;){var Lt=P[de];U(re,Lt,R(Lt),P)}return re}function Sr(P,U){for(var R=-1,re=P==null?0:P.length;++R<re&&U(P[R],R,P)!==!1;);return P}function ip(P,U){for(var R=P==null?0:P.length;R--&&U(P[R],R,P)!==!1;);return P}function Xc(P,U){for(var R=-1,re=P==null?0:P.length;++R<re;)if(!U(P[R],R,P))return!1;return!0}function yi(P,U){for(var R=-1,re=P==null?0:P.length,de=0,Fe=[];++R<re;){var Lt=P[R];U(Lt,R,P)&&(Fe[de++]=Lt)}return Fe}function As(P,U){var R=P==null?0:P.length;return!!R&&sn(P,U,0)>-1}function ra(P,U,R){for(var re=-1,de=P==null?0:P.length;++re<de;)if(R(U,P[re]))return!0;return!1}function it(P,U){for(var R=-1,re=P==null?0:P.length,de=Array(re);++R<re;)de[R]=U(P[R],R,P);return de}function mi(P,U){for(var R=-1,re=U.length,de=P.length;++R<re;)P[de+R]=U[R];return P}function ia(P,U,R,re){var de=-1,Fe=P==null?0:P.length;for(re&&Fe&&(R=P[++de]);++de<Fe;)R=U(R,P[de],de,P);return R}function np(P,U,R,re){var de=P==null?0:P.length;for(re&&de&&(R=P[--de]);de--;)R=U(R,P[de],de,P);return R}function na(P,U){for(var R=-1,re=P==null?0:P.length;++R<re;)if(U(P[R],R,P))return!0;return!1}var sp=sa("length");function op(P){return P.split("")}function ap(P){return P.match(Rt)||[]}function eu(P,U,R){var re;return R(P,function(de,Fe,Lt){if(U(de,Fe,Lt))return re=Fe,!1}),re}function Ns(P,U,R,re){for(var de=P.length,Fe=R+(re?1:-1);re?Fe--:++Fe<de;)if(U(P[Fe],Fe,P))return Fe;return-1}function sn(P,U,R){return U===U?wp(P,U,R):Ns(P,tu,R)}function cp(P,U,R,re){for(var de=R-1,Fe=P.length;++de<Fe;)if(re(P[de],U))return de;return-1}function tu(P){return P!==P}function ru(P,U){var R=P==null?0:P.length;return R?aa(P,U)/R:W}function sa(P){return function(U){return U==null?t:U[P]}}function oa(P){return function(U){return P==null?t:P[U]}}function iu(P,U,R,re,de){return de(P,function(Fe,Lt,Ge){R=re?(re=!1,Fe):U(R,Fe,Lt,Ge)}),R}function up(P,U){var R=P.length;for(P.sort(U);R--;)P[R]=P[R].value;return P}function aa(P,U){for(var R,re=-1,de=P.length;++re<de;){var Fe=U(P[re]);Fe!==t&&(R=R===t?Fe:R+Fe)}return R}function ca(P,U){for(var R=-1,re=Array(P);++R<P;)re[R]=U(R);return re}function hp(P,U){return it(U,function(R){return[R,P[R]]})}function nu(P){return P&&P.slice(0,cu(P)+1).replace(gt,"")}function mr(P){return function(U){return P(U)}}function ua(P,U){return it(U,function(R){return P[R]})}function Nn(P,U){return P.has(U)}function su(P,U){for(var R=-1,re=P.length;++R<re&&sn(U,P[R],0)>-1;);return R}function ou(P,U){for(var R=P.length;R--&&sn(U,P[R],0)>-1;);return R}function lp(P,U){for(var R=P.length,re=0;R--;)P[R]===U&&++re;return re}var fp=oa(m),pp=oa(x);function dp(P){return"\\"+te[P]}function gp(P,U){return P==null?t:P[U]}function on(P){return Os.test(P)}function yp(P){return Fi.test(P)}function mp(P){for(var U,R=[];!(U=P.next()).done;)R.push(U.value);return R}function ha(P){var U=-1,R=Array(P.size);return P.forEach(function(re,de){R[++U]=[de,re]}),R}function au(P,U){return function(R){return P(U(R))}}function vi(P,U){for(var R=-1,re=P.length,de=0,Fe=[];++R<re;){var Lt=P[R];(Lt===U||Lt===b)&&(P[R]=b,Fe[de++]=R)}return Fe}function Rs(P){var U=-1,R=Array(P.size);return P.forEach(function(re){R[++U]=re}),R}function vp(P){var U=-1,R=Array(P.size);return P.forEach(function(re){R[++U]=[re,re]}),R}function wp(P,U,R){for(var re=R-1,de=P.length;++re<de;)if(P[re]===U)return re;return-1}function bp(P,U,R){for(var re=R+1;re--;)if(P[re]===U)return re;return re}function an(P){return on(P)?Ep(P):sp(P)}function Dr(P){return on(P)?Ip(P):op(P)}function cu(P){for(var U=P.length;U--&&wt.test(P.charAt(U)););return U}var _p=oa(B);function Ep(P){for(var U=nn.lastIndex=0;nn.test(P);)++U;return U}function Ip(P){return P.match(nn)||[]}function xp(P){return P.match(Ps)||[]}var Sp=function P(U){U=U==null?Pe:cn.defaults(Pe.Object(),U,cn.pick(Pe,Cs));var R=U.Array,re=U.Date,de=U.Error,Fe=U.Function,Lt=U.Math,Ge=U.Object,la=U.RegExp,Pp=U.String,Pr=U.TypeError,Ts=R.prototype,Op=Fe.prototype,un=Ge.prototype,$s=U["__core-js_shared__"],Fs=Op.toString,qe=un.hasOwnProperty,Cp=0,uu=function(){var e=/[^.]+$/.exec($s&&$s.keys&&$s.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ds=un.toString,Ap=Fs.call(Ge),Np=Pe._,Rp=la("^"+Fs.call(qe).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ls=ar?U.Buffer:t,wi=U.Symbol,js=U.Uint8Array,hu=Ls?Ls.allocUnsafe:t,qs=au(Ge.getPrototypeOf,Ge),lu=Ge.create,fu=un.propertyIsEnumerable,Ms=Ts.splice,pu=wi?wi.isConcatSpreadable:t,Rn=wi?wi.iterator:t,Li=wi?wi.toStringTag:t,Us=function(){try{var e=zi(Ge,"defineProperty");return e({},"",{}),e}catch{}}(),Tp=U.clearTimeout!==Pe.clearTimeout&&U.clearTimeout,$p=re&&re.now!==Pe.Date.now&&re.now,Fp=U.setTimeout!==Pe.setTimeout&&U.setTimeout,zs=Lt.ceil,ks=Lt.floor,fa=Ge.getOwnPropertySymbols,Dp=Ls?Ls.isBuffer:t,du=U.isFinite,Lp=Ts.join,jp=au(Ge.keys,Ge),jt=Lt.max,Gt=Lt.min,qp=re.now,Mp=U.parseInt,gu=Lt.random,Up=Ts.reverse,pa=zi(U,"DataView"),Tn=zi(U,"Map"),da=zi(U,"Promise"),hn=zi(U,"Set"),$n=zi(U,"WeakMap"),Fn=zi(Ge,"create"),Hs=$n&&new $n,ln={},zp=ki(pa),kp=ki(Tn),Hp=ki(da),Kp=ki(hn),Vp=ki($n),Ks=wi?wi.prototype:t,Dn=Ks?Ks.valueOf:t,yu=Ks?Ks.toString:t;function f(e){if(mt(e)&&!ye(e)&&!(e instanceof Se)){if(e instanceof Or)return e;if(qe.call(e,"__wrapped__"))return mh(e)}return new Or(e)}var fn=function(){function e(){}return function(i){if(!ct(i))return{};if(lu)return lu(i);e.prototype=i;var s=new e;return e.prototype=t,s}}();function Vs(){}function Or(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=t}f.templateSettings={escape:ft,evaluate:pt,interpolate:at,variable:"",imports:{_:f}},f.prototype=Vs.prototype,f.prototype.constructor=f,Or.prototype=fn(Vs.prototype),Or.prototype.constructor=Or;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Y,this.__views__=[]}function Bp(){var e=new Se(this.__wrapped__);return e.__actions__=cr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=cr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=cr(this.__views__),e}function Gp(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Wp(){var e=this.__wrapped__.value(),i=this.__dir__,s=ye(e),c=i<0,l=s?e.length:0,d=og(0,l,this.__views__),v=d.start,_=d.end,O=_-v,z=c?_:v-1,k=this.__iteratees__,G=k.length,X=0,ne=Gt(O,this.__takeCount__);if(!s||!c&&l==O&&ne==O)return Uu(e,this.__actions__);var he=[];e:for(;O--&&X<ne;){z+=i;for(var we=-1,le=e[z];++we<G;){var Ie=k[we],Oe=Ie.iteratee,br=Ie.type,tr=Oe(le);if(br==V)le=tr;else if(!tr){if(br==T)continue e;break e}}he[X++]=le}return he}Se.prototype=fn(Vs.prototype),Se.prototype.constructor=Se;function ji(e){var i=-1,s=e==null?0:e.length;for(this.clear();++i<s;){var c=e[i];this.set(c[0],c[1])}}function Jp(){this.__data__=Fn?Fn(null):{},this.size=0}function Qp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Yp(e){var i=this.__data__;if(Fn){var s=i[e];return s===w?t:s}return qe.call(i,e)?i[e]:t}function Zp(e){var i=this.__data__;return Fn?i[e]!==t:qe.call(i,e)}function Xp(e,i){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=Fn&&i===t?w:i,this}ji.prototype.clear=Jp,ji.prototype.delete=Qp,ji.prototype.get=Yp,ji.prototype.has=Zp,ji.prototype.set=Xp;function ei(e){var i=-1,s=e==null?0:e.length;for(this.clear();++i<s;){var c=e[i];this.set(c[0],c[1])}}function ed(){this.__data__=[],this.size=0}function td(e){var i=this.__data__,s=Bs(i,e);if(s<0)return!1;var c=i.length-1;return s==c?i.pop():Ms.call(i,s,1),--this.size,!0}function rd(e){var i=this.__data__,s=Bs(i,e);return s<0?t:i[s][1]}function id(e){return Bs(this.__data__,e)>-1}function nd(e,i){var s=this.__data__,c=Bs(s,e);return c<0?(++this.size,s.push([e,i])):s[c][1]=i,this}ei.prototype.clear=ed,ei.prototype.delete=td,ei.prototype.get=rd,ei.prototype.has=id,ei.prototype.set=nd;function ti(e){var i=-1,s=e==null?0:e.length;for(this.clear();++i<s;){var c=e[i];this.set(c[0],c[1])}}function sd(){this.size=0,this.__data__={hash:new ji,map:new(Tn||ei),string:new ji}}function od(e){var i=no(this,e).delete(e);return this.size-=i?1:0,i}function ad(e){return no(this,e).get(e)}function cd(e){return no(this,e).has(e)}function ud(e,i){var s=no(this,e),c=s.size;return s.set(e,i),this.size+=s.size==c?0:1,this}ti.prototype.clear=sd,ti.prototype.delete=od,ti.prototype.get=ad,ti.prototype.has=cd,ti.prototype.set=ud;function qi(e){var i=-1,s=e==null?0:e.length;for(this.__data__=new ti;++i<s;)this.add(e[i])}function hd(e){return this.__data__.set(e,w),this}function ld(e){return this.__data__.has(e)}qi.prototype.add=qi.prototype.push=hd,qi.prototype.has=ld;function Lr(e){var i=this.__data__=new ei(e);this.size=i.size}function fd(){this.__data__=new ei,this.size=0}function pd(e){var i=this.__data__,s=i.delete(e);return this.size=i.size,s}function dd(e){return this.__data__.get(e)}function gd(e){return this.__data__.has(e)}function yd(e,i){var s=this.__data__;if(s instanceof ei){var c=s.__data__;if(!Tn||c.length<a-1)return c.push([e,i]),this.size=++s.size,this;s=this.__data__=new ti(c)}return s.set(e,i),this.size=s.size,this}Lr.prototype.clear=fd,Lr.prototype.delete=pd,Lr.prototype.get=dd,Lr.prototype.has=gd,Lr.prototype.set=yd;function mu(e,i){var s=ye(e),c=!s&&Hi(e),l=!s&&!c&&xi(e),d=!s&&!c&&!l&&yn(e),v=s||c||l||d,_=v?ca(e.length,Pp):[],O=_.length;for(var z in e)(i||qe.call(e,z))&&!(v&&(z=="length"||l&&(z=="offset"||z=="parent")||d&&(z=="buffer"||z=="byteLength"||z=="byteOffset")||si(z,O)))&&_.push(z);return _}function vu(e){var i=e.length;return i?e[Sa(0,i-1)]:t}function md(e,i){return so(cr(e),Mi(i,0,e.length))}function vd(e){return so(cr(e))}function ga(e,i,s){(s!==t&&!jr(e[i],s)||s===t&&!(i in e))&&ri(e,i,s)}function Ln(e,i,s){var c=e[i];(!(qe.call(e,i)&&jr(c,s))||s===t&&!(i in e))&&ri(e,i,s)}function Bs(e,i){for(var s=e.length;s--;)if(jr(e[s][0],i))return s;return-1}function wd(e,i,s,c){return bi(e,function(l,d,v){i(c,l,s(l),v)}),c}function wu(e,i){return e&&Br(i,Ut(i),e)}function bd(e,i){return e&&Br(i,hr(i),e)}function ri(e,i,s){i=="__proto__"&&Us?Us(e,i,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[i]=s}function ya(e,i){for(var s=-1,c=i.length,l=R(c),d=e==null;++s<c;)l[s]=d?t:Qa(e,i[s]);return l}function Mi(e,i,s){return e===e&&(s!==t&&(e=e<=s?e:s),i!==t&&(e=e>=i?e:i)),e}function Cr(e,i,s,c,l,d){var v,_=i&S,O=i&N,z=i&K;if(s&&(v=l?s(e,c,l,d):s(e)),v!==t)return v;if(!ct(e))return e;var k=ye(e);if(k){if(v=cg(e),!_)return cr(e,v)}else{var G=Wt(e),X=G==ie||G==pe;if(xi(e))return Hu(e,_);if(G==xe||G==be||X&&!l){if(v=O||X?{}:ch(e),!_)return O?Yd(e,bd(v,e)):Qd(e,wu(v,e))}else{if(!ze[G])return l?e:{};v=ug(e,G,_)}}d||(d=new Lr);var ne=d.get(e);if(ne)return ne;d.set(e,v),jh(e)?e.forEach(function(le){v.add(Cr(le,i,s,le,e,d))}):Dh(e)&&e.forEach(function(le,Ie){v.set(Ie,Cr(le,i,s,Ie,e,d))});var he=z?O?La:Da:O?hr:Ut,we=k?t:he(e);return Sr(we||e,function(le,Ie){we&&(Ie=le,le=e[Ie]),Ln(v,Ie,Cr(le,i,s,Ie,e,d))}),v}function _d(e){var i=Ut(e);return function(s){return bu(s,e,i)}}function bu(e,i,s){var c=s.length;if(e==null)return!c;for(e=Ge(e);c--;){var l=s[c],d=i[l],v=e[l];if(v===t&&!(l in e)||!d(v))return!1}return!0}function _u(e,i,s){if(typeof e!="function")throw new Pr(p);return Hn(function(){e.apply(t,s)},i)}function jn(e,i,s,c){var l=-1,d=As,v=!0,_=e.length,O=[],z=i.length;if(!_)return O;s&&(i=it(i,mr(s))),c?(d=ra,v=!1):i.length>=a&&(d=Nn,v=!1,i=new qi(i));e:for(;++l<_;){var k=e[l],G=s==null?k:s(k);if(k=c||k!==0?k:0,v&&G===G){for(var X=z;X--;)if(i[X]===G)continue e;O.push(k)}else d(i,G,c)||O.push(k)}return O}var bi=Wu(Vr),Eu=Wu(va,!0);function Ed(e,i){var s=!0;return bi(e,function(c,l,d){return s=!!i(c,l,d),s}),s}function Gs(e,i,s){for(var c=-1,l=e.length;++c<l;){var d=e[c],v=i(d);if(v!=null&&(_===t?v===v&&!wr(v):s(v,_)))var _=v,O=d}return O}function Id(e,i,s,c){var l=e.length;for(s=me(s),s<0&&(s=-s>l?0:l+s),c=c===t||c>l?l:me(c),c<0&&(c+=l),c=s>c?0:Mh(c);s<c;)e[s++]=i;return e}function Iu(e,i){var s=[];return bi(e,function(c,l,d){i(c,l,d)&&s.push(c)}),s}function Vt(e,i,s,c,l){var d=-1,v=e.length;for(s||(s=lg),l||(l=[]);++d<v;){var _=e[d];i>0&&s(_)?i>1?Vt(_,i-1,s,c,l):mi(l,_):c||(l[l.length]=_)}return l}var ma=Ju(),xu=Ju(!0);function Vr(e,i){return e&&ma(e,i,Ut)}function va(e,i){return e&&xu(e,i,Ut)}function Ws(e,i){return yi(i,function(s){return oi(e[s])})}function Ui(e,i){i=Ei(i,e);for(var s=0,c=i.length;e!=null&&s<c;)e=e[Gr(i[s++])];return s&&s==c?e:t}function Su(e,i,s){var c=i(e);return ye(e)?c:mi(c,s(e))}function Xt(e){return e==null?e===t?ot:$e:Li&&Li in Ge(e)?sg(e):vg(e)}function wa(e,i){return e>i}function xd(e,i){return e!=null&&qe.call(e,i)}function Sd(e,i){return e!=null&&i in Ge(e)}function Pd(e,i,s){return e>=Gt(i,s)&&e<jt(i,s)}function ba(e,i,s){for(var c=s?ra:As,l=e[0].length,d=e.length,v=d,_=R(d),O=1/0,z=[];v--;){var k=e[v];v&&i&&(k=it(k,mr(i))),O=Gt(k.length,O),_[v]=!s&&(i||l>=120&&k.length>=120)?new qi(v&&k):t}k=e[0];var G=-1,X=_[0];e:for(;++G<l&&z.length<O;){var ne=k[G],he=i?i(ne):ne;if(ne=s||ne!==0?ne:0,!(X?Nn(X,he):c(z,he,s))){for(v=d;--v;){var we=_[v];if(!(we?Nn(we,he):c(e[v],he,s)))continue e}X&&X.push(he),z.push(ne)}}return z}function Od(e,i,s,c){return Vr(e,function(l,d,v){i(c,s(l),d,v)}),c}function qn(e,i,s){i=Ei(i,e),e=fh(e,i);var c=e==null?e:e[Gr(Nr(i))];return c==null?t:Mt(c,e,s)}function Pu(e){return mt(e)&&Xt(e)==be}function Cd(e){return mt(e)&&Xt(e)==Te}function Ad(e){return mt(e)&&Xt(e)==A}function Mn(e,i,s,c,l){return e===i?!0:e==null||i==null||!mt(e)&&!mt(i)?e!==e&&i!==i:Nd(e,i,s,c,Mn,l)}function Nd(e,i,s,c,l,d){var v=ye(e),_=ye(i),O=v?xt:Wt(e),z=_?xt:Wt(i);O=O==be?xe:O,z=z==be?xe:z;var k=O==xe,G=z==xe,X=O==z;if(X&&xi(e)){if(!xi(i))return!1;v=!0,k=!1}if(X&&!k)return d||(d=new Lr),v||yn(e)?sh(e,i,s,c,l,d):ig(e,i,O,s,c,l,d);if(!(s&j)){var ne=k&&qe.call(e,"__wrapped__"),he=G&&qe.call(i,"__wrapped__");if(ne||he){var we=ne?e.value():e,le=he?i.value():i;return d||(d=new Lr),l(we,le,s,c,d)}}return X?(d||(d=new Lr),ng(e,i,s,c,l,d)):!1}function Rd(e){return mt(e)&&Wt(e)==ve}function _a(e,i,s,c){var l=s.length,d=l,v=!c;if(e==null)return!d;for(e=Ge(e);l--;){var _=s[l];if(v&&_[2]?_[1]!==e[_[0]]:!(_[0]in e))return!1}for(;++l<d;){_=s[l];var O=_[0],z=e[O],k=_[1];if(v&&_[2]){if(z===t&&!(O in e))return!1}else{var G=new Lr;if(c)var X=c(z,k,O,e,i,G);if(!(X===t?Mn(k,z,j|J,c,G):X))return!1}}return!0}function Ou(e){if(!ct(e)||pg(e))return!1;var i=oi(e)?Rp:Uo;return i.test(ki(e))}function Td(e){return mt(e)&&Xt(e)==st}function $d(e){return mt(e)&&Wt(e)==De}function Fd(e){return mt(e)&&lo(e.length)&&!!Ke[Xt(e)]}function Cu(e){return typeof e=="function"?e:e==null?lr:typeof e=="object"?ye(e)?Ru(e[0],e[1]):Nu(e):Qh(e)}function Ea(e){if(!kn(e))return jp(e);var i=[];for(var s in Ge(e))qe.call(e,s)&&s!="constructor"&&i.push(s);return i}function Dd(e){if(!ct(e))return mg(e);var i=kn(e),s=[];for(var c in e)c=="constructor"&&(i||!qe.call(e,c))||s.push(c);return s}function Ia(e,i){return e<i}function Au(e,i){var s=-1,c=ur(e)?R(e.length):[];return bi(e,function(l,d,v){c[++s]=i(l,d,v)}),c}function Nu(e){var i=qa(e);return i.length==1&&i[0][2]?hh(i[0][0],i[0][1]):function(s){return s===e||_a(s,e,i)}}function Ru(e,i){return Ua(e)&&uh(i)?hh(Gr(e),i):function(s){var c=Qa(s,e);return c===t&&c===i?Ya(s,e):Mn(i,c,j|J)}}function Js(e,i,s,c,l){e!==i&&ma(i,function(d,v){if(l||(l=new Lr),ct(d))Ld(e,i,v,s,Js,c,l);else{var _=c?c(ka(e,v),d,v+"",e,i,l):t;_===t&&(_=d),ga(e,v,_)}},hr)}function Ld(e,i,s,c,l,d,v){var _=ka(e,s),O=ka(i,s),z=v.get(O);if(z){ga(e,s,z);return}var k=d?d(_,O,s+"",e,i,v):t,G=k===t;if(G){var X=ye(O),ne=!X&&xi(O),he=!X&&!ne&&yn(O);k=O,X||ne||he?ye(_)?k=_:_t(_)?k=cr(_):ne?(G=!1,k=Hu(O,!0)):he?(G=!1,k=Ku(O,!0)):k=[]:Kn(O)||Hi(O)?(k=_,Hi(_)?k=Uh(_):(!ct(_)||oi(_))&&(k=ch(O))):G=!1}G&&(v.set(O,k),l(k,O,c,d,v),v.delete(O)),ga(e,s,k)}function Tu(e,i){var s=e.length;if(s)return i+=i<0?s:0,si(i,s)?e[i]:t}function $u(e,i,s){i.length?i=it(i,function(d){return ye(d)?function(v){return Ui(v,d.length===1?d[0]:d)}:d}):i=[lr];var c=-1;i=it(i,mr(ue()));var l=Au(e,function(d,v,_){var O=it(i,function(z){return z(d)});return{criteria:O,index:++c,value:d}});return up(l,function(d,v){return Jd(d,v,s)})}function jd(e,i){return Fu(e,i,function(s,c){return Ya(e,c)})}function Fu(e,i,s){for(var c=-1,l=i.length,d={};++c<l;){var v=i[c],_=Ui(e,v);s(_,v)&&Un(d,Ei(v,e),_)}return d}function qd(e){return function(i){return Ui(i,e)}}function xa(e,i,s,c){var l=c?cp:sn,d=-1,v=i.length,_=e;for(e===i&&(i=cr(i)),s&&(_=it(e,mr(s)));++d<v;)for(var O=0,z=i[d],k=s?s(z):z;(O=l(_,k,O,c))>-1;)_!==e&&Ms.call(_,O,1),Ms.call(e,O,1);return e}function Du(e,i){for(var s=e?i.length:0,c=s-1;s--;){var l=i[s];if(s==c||l!==d){var d=l;si(l)?Ms.call(e,l,1):Ca(e,l)}}return e}function Sa(e,i){return e+ks(gu()*(i-e+1))}function Md(e,i,s,c){for(var l=-1,d=jt(zs((i-e)/(s||1)),0),v=R(d);d--;)v[c?d:++l]=e,e+=s;return v}function Pa(e,i){var s="";if(!e||i<1||i>ee)return s;do i%2&&(s+=e),i=ks(i/2),i&&(e+=e);while(i);return s}function _e(e,i){return Ha(lh(e,i,lr),e+"")}function Ud(e){return vu(mn(e))}function zd(e,i){var s=mn(e);return so(s,Mi(i,0,s.length))}function Un(e,i,s,c){if(!ct(e))return e;i=Ei(i,e);for(var l=-1,d=i.length,v=d-1,_=e;_!=null&&++l<d;){var O=Gr(i[l]),z=s;if(O==="__proto__"||O==="constructor"||O==="prototype")return e;if(l!=v){var k=_[O];z=c?c(k,O,_):t,z===t&&(z=ct(k)?k:si(i[l+1])?[]:{})}Ln(_,O,z),_=_[O]}return e}var Lu=Hs?function(e,i){return Hs.set(e,i),e}:lr,kd=Us?function(e,i){return Us(e,"toString",{configurable:!0,enumerable:!1,value:Xa(i),writable:!0})}:lr;function Hd(e){return so(mn(e))}function Ar(e,i,s){var c=-1,l=e.length;i<0&&(i=-i>l?0:l+i),s=s>l?l:s,s<0&&(s+=l),l=i>s?0:s-i>>>0,i>>>=0;for(var d=R(l);++c<l;)d[c]=e[c+i];return d}function Kd(e,i){var s;return bi(e,function(c,l,d){return s=i(c,l,d),!s}),!!s}function Qs(e,i,s){var c=0,l=e==null?c:e.length;if(typeof i=="number"&&i===i&&l<=ke){for(;c<l;){var d=c+l>>>1,v=e[d];v!==null&&!wr(v)&&(s?v<=i:v<i)?c=d+1:l=d}return l}return Oa(e,i,lr,s)}function Oa(e,i,s,c){var l=0,d=e==null?0:e.length;if(d===0)return 0;i=s(i);for(var v=i!==i,_=i===null,O=wr(i),z=i===t;l<d;){var k=ks((l+d)/2),G=s(e[k]),X=G!==t,ne=G===null,he=G===G,we=wr(G);if(v)var le=c||he;else z?le=he&&(c||X):_?le=he&&X&&(c||!ne):O?le=he&&X&&!ne&&(c||!we):ne||we?le=!1:le=c?G<=i:G<i;le?l=k+1:d=k}return Gt(d,ut)}function ju(e,i){for(var s=-1,c=e.length,l=0,d=[];++s<c;){var v=e[s],_=i?i(v):v;if(!s||!jr(_,O)){var O=_;d[l++]=v===0?0:v}}return d}function qu(e){return typeof e=="number"?e:wr(e)?W:+e}function vr(e){if(typeof e=="string")return e;if(ye(e))return it(e,vr)+"";if(wr(e))return yu?yu.call(e):"";var i=e+"";return i=="0"&&1/e==-Ne?"-0":i}function _i(e,i,s){var c=-1,l=As,d=e.length,v=!0,_=[],O=_;if(s)v=!1,l=ra;else if(d>=a){var z=i?null:tg(e);if(z)return Rs(z);v=!1,l=Nn,O=new qi}else O=i?[]:_;e:for(;++c<d;){var k=e[c],G=i?i(k):k;if(k=s||k!==0?k:0,v&&G===G){for(var X=O.length;X--;)if(O[X]===G)continue e;i&&O.push(G),_.push(k)}else l(O,G,s)||(O!==_&&O.push(G),_.push(k))}return _}function Ca(e,i){return i=Ei(i,e),e=fh(e,i),e==null||delete e[Gr(Nr(i))]}function Mu(e,i,s,c){return Un(e,i,s(Ui(e,i)),c)}function Ys(e,i,s,c){for(var l=e.length,d=c?l:-1;(c?d--:++d<l)&&i(e[d],d,e););return s?Ar(e,c?0:d,c?d+1:l):Ar(e,c?d+1:0,c?l:d)}function Uu(e,i){var s=e;return s instanceof Se&&(s=s.value()),ia(i,function(c,l){return l.func.apply(l.thisArg,mi([c],l.args))},s)}function Aa(e,i,s){var c=e.length;if(c<2)return c?_i(e[0]):[];for(var l=-1,d=R(c);++l<c;)for(var v=e[l],_=-1;++_<c;)_!=l&&(d[l]=jn(d[l]||v,e[_],i,s));return _i(Vt(d,1),i,s)}function zu(e,i,s){for(var c=-1,l=e.length,d=i.length,v={};++c<l;){var _=c<d?i[c]:t;s(v,e[c],_)}return v}function Na(e){return _t(e)?e:[]}function Ra(e){return typeof e=="function"?e:lr}function Ei(e,i){return ye(e)?e:Ua(e,i)?[e]:yh(Le(e))}var Vd=_e;function Ii(e,i,s){var c=e.length;return s=s===t?c:s,!i&&s>=c?e:Ar(e,i,s)}var ku=Tp||function(e){return Pe.clearTimeout(e)};function Hu(e,i){if(i)return e.slice();var s=e.length,c=hu?hu(s):new e.constructor(s);return e.copy(c),c}function Ta(e){var i=new e.constructor(e.byteLength);return new js(i).set(new js(e)),i}function Bd(e,i){var s=i?Ta(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function Gd(e){var i=new e.constructor(e.source,Ir.exec(e));return i.lastIndex=e.lastIndex,i}function Wd(e){return Dn?Ge(Dn.call(e)):{}}function Ku(e,i){var s=i?Ta(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function Vu(e,i){if(e!==i){var s=e!==t,c=e===null,l=e===e,d=wr(e),v=i!==t,_=i===null,O=i===i,z=wr(i);if(!_&&!z&&!d&&e>i||d&&v&&O&&!_&&!z||c&&v&&O||!s&&O||!l)return 1;if(!c&&!d&&!z&&e<i||z&&s&&l&&!c&&!d||_&&s&&l||!v&&l||!O)return-1}return 0}function Jd(e,i,s){for(var c=-1,l=e.criteria,d=i.criteria,v=l.length,_=s.length;++c<v;){var O=Vu(l[c],d[c]);if(O){if(c>=_)return O;var z=s[c];return O*(z=="desc"?-1:1)}}return e.index-i.index}function Bu(e,i,s,c){for(var l=-1,d=e.length,v=s.length,_=-1,O=i.length,z=jt(d-v,0),k=R(O+z),G=!c;++_<O;)k[_]=i[_];for(;++l<v;)(G||l<d)&&(k[s[l]]=e[l]);for(;z--;)k[_++]=e[l++];return k}function Gu(e,i,s,c){for(var l=-1,d=e.length,v=-1,_=s.length,O=-1,z=i.length,k=jt(d-_,0),G=R(k+z),X=!c;++l<k;)G[l]=e[l];for(var ne=l;++O<z;)G[ne+O]=i[O];for(;++v<_;)(X||l<d)&&(G[ne+s[v]]=e[l++]);return G}function cr(e,i){var s=-1,c=e.length;for(i||(i=R(c));++s<c;)i[s]=e[s];return i}function Br(e,i,s,c){var l=!s;s||(s={});for(var d=-1,v=i.length;++d<v;){var _=i[d],O=c?c(s[_],e[_],_,s,e):t;O===t&&(O=e[_]),l?ri(s,_,O):Ln(s,_,O)}return s}function Qd(e,i){return Br(e,Ma(e),i)}function Yd(e,i){return Br(e,oh(e),i)}function Zs(e,i){return function(s,c){var l=ye(s)?rp:wd,d=i?i():{};return l(s,e,ue(c,2),d)}}function pn(e){return _e(function(i,s){var c=-1,l=s.length,d=l>1?s[l-1]:t,v=l>2?s[2]:t;for(d=e.length>3&&typeof d=="function"?(l--,d):t,v&&er(s[0],s[1],v)&&(d=l<3?t:d,l=1),i=Ge(i);++c<l;){var _=s[c];_&&e(i,_,c,d)}return i})}function Wu(e,i){return function(s,c){if(s==null)return s;if(!ur(s))return e(s,c);for(var l=s.length,d=i?l:-1,v=Ge(s);(i?d--:++d<l)&&c(v[d],d,v)!==!1;);return s}}function Ju(e){return function(i,s,c){for(var l=-1,d=Ge(i),v=c(i),_=v.length;_--;){var O=v[e?_:++l];if(s(d[O],O,d)===!1)break}return i}}function Zd(e,i,s){var c=i&oe,l=zn(e);function d(){var v=this&&this!==Pe&&this instanceof d?l:e;return v.apply(c?s:this,arguments)}return d}function Qu(e){return function(i){i=Le(i);var s=on(i)?Dr(i):t,c=s?s[0]:i.charAt(0),l=s?Ii(s,1).join(""):i.slice(1);return c[e]()+l}}function dn(e){return function(i){return ia(Wh(Gh(i).replace(Cn,"")),e,"")}}function zn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var s=fn(e.prototype),c=e.apply(s,i);return ct(c)?c:s}}function Xd(e,i,s){var c=zn(e);function l(){for(var d=arguments.length,v=R(d),_=d,O=gn(l);_--;)v[_]=arguments[_];var z=d<3&&v[0]!==O&&v[d-1]!==O?[]:vi(v,O);if(d-=z.length,d<s)return th(e,i,Xs,l.placeholder,t,v,z,t,t,s-d);var k=this&&this!==Pe&&this instanceof l?c:e;return Mt(k,this,v)}return l}function Yu(e){return function(i,s,c){var l=Ge(i);if(!ur(i)){var d=ue(s,3);i=Ut(i),s=function(_){return d(l[_],_,l)}}var v=e(i,s,c);return v>-1?l[d?i[v]:v]:t}}function Zu(e){return ni(function(i){var s=i.length,c=s,l=Or.prototype.thru;for(e&&i.reverse();c--;){var d=i[c];if(typeof d!="function")throw new Pr(p);if(l&&!v&&io(d)=="wrapper")var v=new Or([],!0)}for(c=v?c:s;++c<s;){d=i[c];var _=io(d),O=_=="wrapper"?ja(d):t;O&&za(O[0])&&O[1]==(D|$|q|H)&&!O[4].length&&O[9]==1?v=v[io(O[0])].apply(v,O[3]):v=d.length==1&&za(d)?v[_]():v.thru(d)}return function(){var z=arguments,k=z[0];if(v&&z.length==1&&ye(k))return v.plant(k).value();for(var G=0,X=s?i[G].apply(this,z):k;++G<s;)X=i[G].call(this,X);return X}})}function Xs(e,i,s,c,l,d,v,_,O,z){var k=i&D,G=i&oe,X=i&fe,ne=i&($|M),he=i&ce,we=X?t:zn(e);function le(){for(var Ie=arguments.length,Oe=R(Ie),br=Ie;br--;)Oe[br]=arguments[br];if(ne)var tr=gn(le),_r=lp(Oe,tr);if(c&&(Oe=Bu(Oe,c,l,ne)),d&&(Oe=Gu(Oe,d,v,ne)),Ie-=_r,ne&&Ie<z){var Et=vi(Oe,tr);return th(e,i,Xs,le.placeholder,s,Oe,Et,_,O,z-Ie)}var qr=G?s:this,ci=X?qr[e]:e;return Ie=Oe.length,_?Oe=wg(Oe,_):he&&Ie>1&&Oe.reverse(),k&&O<Ie&&(Oe.length=O),this&&this!==Pe&&this instanceof le&&(ci=we||zn(ci)),ci.apply(qr,Oe)}return le}function Xu(e,i){return function(s,c){return Od(s,e,i(c),{})}}function eo(e,i){return function(s,c){var l;if(s===t&&c===t)return i;if(s!==t&&(l=s),c!==t){if(l===t)return c;typeof s=="string"||typeof c=="string"?(s=vr(s),c=vr(c)):(s=qu(s),c=qu(c)),l=e(s,c)}return l}}function $a(e){return ni(function(i){return i=it(i,mr(ue())),_e(function(s){var c=this;return e(i,function(l){return Mt(l,c,s)})})})}function to(e,i){i=i===t?" ":vr(i);var s=i.length;if(s<2)return s?Pa(i,e):i;var c=Pa(i,zs(e/an(i)));return on(i)?Ii(Dr(c),0,e).join(""):c.slice(0,e)}function eg(e,i,s,c){var l=i&oe,d=zn(e);function v(){for(var _=-1,O=arguments.length,z=-1,k=c.length,G=R(k+O),X=this&&this!==Pe&&this instanceof v?d:e;++z<k;)G[z]=c[z];for(;O--;)G[z++]=arguments[++_];return Mt(X,l?s:this,G)}return v}function eh(e){return function(i,s,c){return c&&typeof c!="number"&&er(i,s,c)&&(s=c=t),i=ai(i),s===t?(s=i,i=0):s=ai(s),c=c===t?i<s?1:-1:ai(c),Md(i,s,c,e)}}function ro(e){return function(i,s){return typeof i=="string"&&typeof s=="string"||(i=Rr(i),s=Rr(s)),e(i,s)}}function th(e,i,s,c,l,d,v,_,O,z){var k=i&$,G=k?v:t,X=k?t:v,ne=k?d:t,he=k?t:d;i|=k?q:I,i&=~(k?I:q),i&C||(i&=~(oe|fe));var we=[e,i,l,ne,G,he,X,_,O,z],le=s.apply(t,we);return za(e)&&ph(le,we),le.placeholder=c,dh(le,e,i)}function Fa(e){var i=Lt[e];return function(s,c){if(s=Rr(s),c=c==null?0:Gt(me(c),292),c&&du(s)){var l=(Le(s)+"e").split("e"),d=i(l[0]+"e"+(+l[1]+c));return l=(Le(d)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return i(s)}}var tg=hn&&1/Rs(new hn([,-0]))[1]==Ne?function(e){return new hn(e)}:rc;function rh(e){return function(i){var s=Wt(i);return s==ve?ha(i):s==De?vp(i):hp(i,e(i))}}function ii(e,i,s,c,l,d,v,_){var O=i&fe;if(!O&&typeof e!="function")throw new Pr(p);var z=c?c.length:0;if(z||(i&=~(q|I),c=l=t),v=v===t?v:jt(me(v),0),_=_===t?_:me(_),z-=l?l.length:0,i&I){var k=c,G=l;c=l=t}var X=O?t:ja(e),ne=[e,i,s,c,l,k,G,d,v,_];if(X&&yg(ne,X),e=ne[0],i=ne[1],s=ne[2],c=ne[3],l=ne[4],_=ne[9]=ne[9]===t?O?0:e.length:jt(ne[9]-z,0),!_&&i&($|M)&&(i&=~($|M)),!i||i==oe)var he=Zd(e,i,s);else i==$||i==M?he=Xd(e,i,_):(i==q||i==(oe|q))&&!l.length?he=eg(e,i,s,c):he=Xs.apply(t,ne);var we=X?Lu:ph;return dh(we(he,ne),e,i)}function ih(e,i,s,c){return e===t||jr(e,un[s])&&!qe.call(c,s)?i:e}function nh(e,i,s,c,l,d){return ct(e)&&ct(i)&&(d.set(i,e),Js(e,i,t,nh,d),d.delete(i)),e}function rg(e){return Kn(e)?t:e}function sh(e,i,s,c,l,d){var v=s&j,_=e.length,O=i.length;if(_!=O&&!(v&&O>_))return!1;var z=d.get(e),k=d.get(i);if(z&&k)return z==i&&k==e;var G=-1,X=!0,ne=s&J?new qi:t;for(d.set(e,i),d.set(i,e);++G<_;){var he=e[G],we=i[G];if(c)var le=v?c(we,he,G,i,e,d):c(he,we,G,e,i,d);if(le!==t){if(le)continue;X=!1;break}if(ne){if(!na(i,function(Ie,Oe){if(!Nn(ne,Oe)&&(he===Ie||l(he,Ie,s,c,d)))return ne.push(Oe)})){X=!1;break}}else if(!(he===we||l(he,we,s,c,d))){X=!1;break}}return d.delete(e),d.delete(i),X}function ig(e,i,s,c,l,d,v){switch(s){case He:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Te:return!(e.byteLength!=i.byteLength||!d(new js(e),new js(i)));case F:case A:case Re:return jr(+e,+i);case E:return e.name==i.name&&e.message==i.message;case st:case Je:return e==i+"";case ve:var _=ha;case De:var O=c&j;if(_||(_=Rs),e.size!=i.size&&!O)return!1;var z=v.get(e);if(z)return z==i;c|=J,v.set(e,i);var k=sh(_(e),_(i),c,l,d,v);return v.delete(e),k;case Qe:if(Dn)return Dn.call(e)==Dn.call(i)}return!1}function ng(e,i,s,c,l,d){var v=s&j,_=Da(e),O=_.length,z=Da(i),k=z.length;if(O!=k&&!v)return!1;for(var G=O;G--;){var X=_[G];if(!(v?X in i:qe.call(i,X)))return!1}var ne=d.get(e),he=d.get(i);if(ne&&he)return ne==i&&he==e;var we=!0;d.set(e,i),d.set(i,e);for(var le=v;++G<O;){X=_[G];var Ie=e[X],Oe=i[X];if(c)var br=v?c(Oe,Ie,X,i,e,d):c(Ie,Oe,X,e,i,d);if(!(br===t?Ie===Oe||l(Ie,Oe,s,c,d):br)){we=!1;break}le||(le=X=="constructor")}if(we&&!le){var tr=e.constructor,_r=i.constructor;tr!=_r&&"constructor"in e&&"constructor"in i&&!(typeof tr=="function"&&tr instanceof tr&&typeof _r=="function"&&_r instanceof _r)&&(we=!1)}return d.delete(e),d.delete(i),we}function ni(e){return Ha(lh(e,t,bh),e+"")}function Da(e){return Su(e,Ut,Ma)}function La(e){return Su(e,hr,oh)}var ja=Hs?function(e){return Hs.get(e)}:rc;function io(e){for(var i=e.name+"",s=ln[i],c=qe.call(ln,i)?s.length:0;c--;){var l=s[c],d=l.func;if(d==null||d==e)return l.name}return i}function gn(e){var i=qe.call(f,"placeholder")?f:e;return i.placeholder}function ue(){var e=f.iteratee||ec;return e=e===ec?Cu:e,arguments.length?e(arguments[0],arguments[1]):e}function no(e,i){var s=e.__data__;return fg(i)?s[typeof i=="string"?"string":"hash"]:s.map}function qa(e){for(var i=Ut(e),s=i.length;s--;){var c=i[s],l=e[c];i[s]=[c,l,uh(l)]}return i}function zi(e,i){var s=gp(e,i);return Ou(s)?s:t}function sg(e){var i=qe.call(e,Li),s=e[Li];try{e[Li]=t;var c=!0}catch{}var l=Ds.call(e);return c&&(i?e[Li]=s:delete e[Li]),l}var Ma=fa?function(e){return e==null?[]:(e=Ge(e),yi(fa(e),function(i){return fu.call(e,i)}))}:ic,oh=fa?function(e){for(var i=[];e;)mi(i,Ma(e)),e=qs(e);return i}:ic,Wt=Xt;(pa&&Wt(new pa(new ArrayBuffer(1)))!=He||Tn&&Wt(new Tn)!=ve||da&&Wt(da.resolve())!=St||hn&&Wt(new hn)!=De||$n&&Wt(new $n)!=Ue)&&(Wt=function(e){var i=Xt(e),s=i==xe?e.constructor:t,c=s?ki(s):"";if(c)switch(c){case zp:return He;case kp:return ve;case Hp:return St;case Kp:return De;case Vp:return Ue}return i});function og(e,i,s){for(var c=-1,l=s.length;++c<l;){var d=s[c],v=d.size;switch(d.type){case"drop":e+=v;break;case"dropRight":i-=v;break;case"take":i=Gt(i,e+v);break;case"takeRight":e=jt(e,i-v);break}}return{start:e,end:i}}function ag(e){var i=e.match(We);return i?i[1].split(Nt):[]}function ah(e,i,s){i=Ei(i,e);for(var c=-1,l=i.length,d=!1;++c<l;){var v=Gr(i[c]);if(!(d=e!=null&&s(e,v)))break;e=e[v]}return d||++c!=l?d:(l=e==null?0:e.length,!!l&&lo(l)&&si(v,l)&&(ye(e)||Hi(e)))}function cg(e){var i=e.length,s=new e.constructor(i);return i&&typeof e[0]=="string"&&qe.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function ch(e){return typeof e.constructor=="function"&&!kn(e)?fn(qs(e)):{}}function ug(e,i,s){var c=e.constructor;switch(i){case Te:return Ta(e);case F:case A:return new c(+e);case He:return Bd(e,s);case ht:case je:case Pt:case Dt:case Ht:case Kt:case qt:case Qt:case or:return Ku(e,s);case ve:return new c;case Re:case Je:return new c(e);case st:return Gd(e);case De:return new c;case Qe:return Wd(e)}}function hg(e,i){var s=i.length;if(!s)return e;var c=s-1;return i[c]=(s>1?"& ":"")+i[c],i=i.join(s>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+i+`] */
`)}function lg(e){return ye(e)||Hi(e)||!!(pu&&e&&e[pu])}function si(e,i){var s=typeof e;return i=i??ee,!!i&&(s=="number"||s!="symbol"&&ko.test(e))&&e>-1&&e%1==0&&e<i}function er(e,i,s){if(!ct(s))return!1;var c=typeof i;return(c=="number"?ur(s)&&si(i,s.length):c=="string"&&i in s)?jr(s[i],e):!1}function Ua(e,i){if(ye(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||wr(e)?!0:Ot.test(e)||!rt.test(e)||i!=null&&e in Ge(i)}function fg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function za(e){var i=io(e),s=f[i];if(typeof s!="function"||!(i in Se.prototype))return!1;if(e===s)return!0;var c=ja(s);return!!c&&e===c[0]}function pg(e){return!!uu&&uu in e}var dg=$s?oi:nc;function kn(e){var i=e&&e.constructor,s=typeof i=="function"&&i.prototype||un;return e===s}function uh(e){return e===e&&!ct(e)}function hh(e,i){return function(s){return s==null?!1:s[e]===i&&(i!==t||e in Ge(s))}}function gg(e){var i=uo(e,function(c){return s.size===y&&s.clear(),c}),s=i.cache;return i}function yg(e,i){var s=e[1],c=i[1],l=s|c,d=l<(oe|fe|D),v=c==D&&s==$||c==D&&s==H&&e[7].length<=i[8]||c==(D|H)&&i[7].length<=i[8]&&s==$;if(!(d||v))return e;c&oe&&(e[2]=i[2],l|=s&oe?0:C);var _=i[3];if(_){var O=e[3];e[3]=O?Bu(O,_,i[4]):_,e[4]=O?vi(e[3],b):i[4]}return _=i[5],_&&(O=e[5],e[5]=O?Gu(O,_,i[6]):_,e[6]=O?vi(e[5],b):i[6]),_=i[7],_&&(e[7]=_),c&D&&(e[8]=e[8]==null?i[8]:Gt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function mg(e){var i=[];if(e!=null)for(var s in Ge(e))i.push(s);return i}function vg(e){return Ds.call(e)}function lh(e,i,s){return i=jt(i===t?e.length-1:i,0),function(){for(var c=arguments,l=-1,d=jt(c.length-i,0),v=R(d);++l<d;)v[l]=c[i+l];l=-1;for(var _=R(i+1);++l<i;)_[l]=c[l];return _[i]=s(v),Mt(e,this,_)}}function fh(e,i){return i.length<2?e:Ui(e,Ar(i,0,-1))}function wg(e,i){for(var s=e.length,c=Gt(i.length,s),l=cr(e);c--;){var d=i[c];e[c]=si(d,s)?l[d]:t}return e}function ka(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var ph=gh(Lu),Hn=Fp||function(e,i){return Pe.setTimeout(e,i)},Ha=gh(kd);function dh(e,i,s){var c=i+"";return Ha(e,hg(c,bg(ag(c),s)))}function gh(e){var i=0,s=0;return function(){var c=qp(),l=et-(c-s);if(s=c,l>0){if(++i>=Ae)return arguments[0]}else i=0;return e.apply(t,arguments)}}function so(e,i){var s=-1,c=e.length,l=c-1;for(i=i===t?c:i;++s<i;){var d=Sa(s,l),v=e[d];e[d]=e[s],e[s]=v}return e.length=i,e}var yh=gg(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Ct,function(s,c,l,d){i.push(l?d.replace(Lo,"$1"):c||s)}),i});function Gr(e){if(typeof e=="string"||wr(e))return e;var i=e+"";return i=="0"&&1/e==-Ne?"-0":i}function ki(e){if(e!=null){try{return Fs.call(e)}catch{}try{return e+""}catch{}}return""}function bg(e,i){return Sr(zr,function(s){var c="_."+s[0];i&s[1]&&!As(e,c)&&e.push(c)}),e.sort()}function mh(e){if(e instanceof Se)return e.clone();var i=new Or(e.__wrapped__,e.__chain__);return i.__actions__=cr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function _g(e,i,s){(s?er(e,i,s):i===t)?i=1:i=jt(me(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var l=0,d=0,v=R(zs(c/i));l<c;)v[d++]=Ar(e,l,l+=i);return v}function Eg(e){for(var i=-1,s=e==null?0:e.length,c=0,l=[];++i<s;){var d=e[i];d&&(l[c++]=d)}return l}function Ig(){var e=arguments.length;if(!e)return[];for(var i=R(e-1),s=arguments[0],c=e;c--;)i[c-1]=arguments[c];return mi(ye(s)?cr(s):[s],Vt(i,1))}var xg=_e(function(e,i){return _t(e)?jn(e,Vt(i,1,_t,!0)):[]}),Sg=_e(function(e,i){var s=Nr(i);return _t(s)&&(s=t),_t(e)?jn(e,Vt(i,1,_t,!0),ue(s,2)):[]}),Pg=_e(function(e,i){var s=Nr(i);return _t(s)&&(s=t),_t(e)?jn(e,Vt(i,1,_t,!0),t,s):[]});function Og(e,i,s){var c=e==null?0:e.length;return c?(i=s||i===t?1:me(i),Ar(e,i<0?0:i,c)):[]}function Cg(e,i,s){var c=e==null?0:e.length;return c?(i=s||i===t?1:me(i),i=c-i,Ar(e,0,i<0?0:i)):[]}function Ag(e,i){return e&&e.length?Ys(e,ue(i,3),!0,!0):[]}function Ng(e,i){return e&&e.length?Ys(e,ue(i,3),!0):[]}function Rg(e,i,s,c){var l=e==null?0:e.length;return l?(s&&typeof s!="number"&&er(e,i,s)&&(s=0,c=l),Id(e,i,s,c)):[]}function vh(e,i,s){var c=e==null?0:e.length;if(!c)return-1;var l=s==null?0:me(s);return l<0&&(l=jt(c+l,0)),Ns(e,ue(i,3),l)}function wh(e,i,s){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return s!==t&&(l=me(s),l=s<0?jt(c+l,0):Gt(l,c-1)),Ns(e,ue(i,3),l,!0)}function bh(e){var i=e==null?0:e.length;return i?Vt(e,1):[]}function Tg(e){var i=e==null?0:e.length;return i?Vt(e,Ne):[]}function $g(e,i){var s=e==null?0:e.length;return s?(i=i===t?1:me(i),Vt(e,i)):[]}function Fg(e){for(var i=-1,s=e==null?0:e.length,c={};++i<s;){var l=e[i];c[l[0]]=l[1]}return c}function _h(e){return e&&e.length?e[0]:t}function Dg(e,i,s){var c=e==null?0:e.length;if(!c)return-1;var l=s==null?0:me(s);return l<0&&(l=jt(c+l,0)),sn(e,i,l)}function Lg(e){var i=e==null?0:e.length;return i?Ar(e,0,-1):[]}var jg=_e(function(e){var i=it(e,Na);return i.length&&i[0]===e[0]?ba(i):[]}),qg=_e(function(e){var i=Nr(e),s=it(e,Na);return i===Nr(s)?i=t:s.pop(),s.length&&s[0]===e[0]?ba(s,ue(i,2)):[]}),Mg=_e(function(e){var i=Nr(e),s=it(e,Na);return i=typeof i=="function"?i:t,i&&s.pop(),s.length&&s[0]===e[0]?ba(s,t,i):[]});function Ug(e,i){return e==null?"":Lp.call(e,i)}function Nr(e){var i=e==null?0:e.length;return i?e[i-1]:t}function zg(e,i,s){var c=e==null?0:e.length;if(!c)return-1;var l=c;return s!==t&&(l=me(s),l=l<0?jt(c+l,0):Gt(l,c-1)),i===i?bp(e,i,l):Ns(e,tu,l,!0)}function kg(e,i){return e&&e.length?Tu(e,me(i)):t}var Hg=_e(Eh);function Eh(e,i){return e&&e.length&&i&&i.length?xa(e,i):e}function Kg(e,i,s){return e&&e.length&&i&&i.length?xa(e,i,ue(s,2)):e}function Vg(e,i,s){return e&&e.length&&i&&i.length?xa(e,i,t,s):e}var Bg=ni(function(e,i){var s=e==null?0:e.length,c=ya(e,i);return Du(e,it(i,function(l){return si(l,s)?+l:l}).sort(Vu)),c});function Gg(e,i){var s=[];if(!(e&&e.length))return s;var c=-1,l=[],d=e.length;for(i=ue(i,3);++c<d;){var v=e[c];i(v,c,e)&&(s.push(v),l.push(c))}return Du(e,l),s}function Ka(e){return e==null?e:Up.call(e)}function Wg(e,i,s){var c=e==null?0:e.length;return c?(s&&typeof s!="number"&&er(e,i,s)?(i=0,s=c):(i=i==null?0:me(i),s=s===t?c:me(s)),Ar(e,i,s)):[]}function Jg(e,i){return Qs(e,i)}function Qg(e,i,s){return Oa(e,i,ue(s,2))}function Yg(e,i){var s=e==null?0:e.length;if(s){var c=Qs(e,i);if(c<s&&jr(e[c],i))return c}return-1}function Zg(e,i){return Qs(e,i,!0)}function Xg(e,i,s){return Oa(e,i,ue(s,2),!0)}function ey(e,i){var s=e==null?0:e.length;if(s){var c=Qs(e,i,!0)-1;if(jr(e[c],i))return c}return-1}function ty(e){return e&&e.length?ju(e):[]}function ry(e,i){return e&&e.length?ju(e,ue(i,2)):[]}function iy(e){var i=e==null?0:e.length;return i?Ar(e,1,i):[]}function ny(e,i,s){return e&&e.length?(i=s||i===t?1:me(i),Ar(e,0,i<0?0:i)):[]}function sy(e,i,s){var c=e==null?0:e.length;return c?(i=s||i===t?1:me(i),i=c-i,Ar(e,i<0?0:i,c)):[]}function oy(e,i){return e&&e.length?Ys(e,ue(i,3),!1,!0):[]}function ay(e,i){return e&&e.length?Ys(e,ue(i,3)):[]}var cy=_e(function(e){return _i(Vt(e,1,_t,!0))}),uy=_e(function(e){var i=Nr(e);return _t(i)&&(i=t),_i(Vt(e,1,_t,!0),ue(i,2))}),hy=_e(function(e){var i=Nr(e);return i=typeof i=="function"?i:t,_i(Vt(e,1,_t,!0),t,i)});function ly(e){return e&&e.length?_i(e):[]}function fy(e,i){return e&&e.length?_i(e,ue(i,2)):[]}function py(e,i){return i=typeof i=="function"?i:t,e&&e.length?_i(e,t,i):[]}function Va(e){if(!(e&&e.length))return[];var i=0;return e=yi(e,function(s){if(_t(s))return i=jt(s.length,i),!0}),ca(i,function(s){return it(e,sa(s))})}function Ih(e,i){if(!(e&&e.length))return[];var s=Va(e);return i==null?s:it(s,function(c){return Mt(i,t,c)})}var dy=_e(function(e,i){return _t(e)?jn(e,i):[]}),gy=_e(function(e){return Aa(yi(e,_t))}),yy=_e(function(e){var i=Nr(e);return _t(i)&&(i=t),Aa(yi(e,_t),ue(i,2))}),my=_e(function(e){var i=Nr(e);return i=typeof i=="function"?i:t,Aa(yi(e,_t),t,i)}),vy=_e(Va);function wy(e,i){return zu(e||[],i||[],Ln)}function by(e,i){return zu(e||[],i||[],Un)}var _y=_e(function(e){var i=e.length,s=i>1?e[i-1]:t;return s=typeof s=="function"?(e.pop(),s):t,Ih(e,s)});function xh(e){var i=f(e);return i.__chain__=!0,i}function Ey(e,i){return i(e),e}function oo(e,i){return i(e)}var Iy=ni(function(e){var i=e.length,s=i?e[0]:0,c=this.__wrapped__,l=function(d){return ya(d,e)};return i>1||this.__actions__.length||!(c instanceof Se)||!si(s)?this.thru(l):(c=c.slice(s,+s+(i?1:0)),c.__actions__.push({func:oo,args:[l],thisArg:t}),new Or(c,this.__chain__).thru(function(d){return i&&!d.length&&d.push(t),d}))});function xy(){return xh(this)}function Sy(){return new Or(this.value(),this.__chain__)}function Py(){this.__values__===t&&(this.__values__=qh(this.value()));var e=this.__index__>=this.__values__.length,i=e?t:this.__values__[this.__index__++];return{done:e,value:i}}function Oy(){return this}function Cy(e){for(var i,s=this;s instanceof Vs;){var c=mh(s);c.__index__=0,c.__values__=t,i?l.__wrapped__=c:i=c;var l=c;s=s.__wrapped__}return l.__wrapped__=e,i}function Ay(){var e=this.__wrapped__;if(e instanceof Se){var i=e;return this.__actions__.length&&(i=new Se(this)),i=i.reverse(),i.__actions__.push({func:oo,args:[Ka],thisArg:t}),new Or(i,this.__chain__)}return this.thru(Ka)}function Ny(){return Uu(this.__wrapped__,this.__actions__)}var Ry=Zs(function(e,i,s){qe.call(e,s)?++e[s]:ri(e,s,1)});function Ty(e,i,s){var c=ye(e)?Xc:Ed;return s&&er(e,i,s)&&(i=t),c(e,ue(i,3))}function $y(e,i){var s=ye(e)?yi:Iu;return s(e,ue(i,3))}var Fy=Yu(vh),Dy=Yu(wh);function Ly(e,i){return Vt(ao(e,i),1)}function jy(e,i){return Vt(ao(e,i),Ne)}function qy(e,i,s){return s=s===t?1:me(s),Vt(ao(e,i),s)}function Sh(e,i){var s=ye(e)?Sr:bi;return s(e,ue(i,3))}function Ph(e,i){var s=ye(e)?ip:Eu;return s(e,ue(i,3))}var My=Zs(function(e,i,s){qe.call(e,s)?e[s].push(i):ri(e,s,[i])});function Uy(e,i,s,c){e=ur(e)?e:mn(e),s=s&&!c?me(s):0;var l=e.length;return s<0&&(s=jt(l+s,0)),fo(e)?s<=l&&e.indexOf(i,s)>-1:!!l&&sn(e,i,s)>-1}var zy=_e(function(e,i,s){var c=-1,l=typeof i=="function",d=ur(e)?R(e.length):[];return bi(e,function(v){d[++c]=l?Mt(i,v,s):qn(v,i,s)}),d}),ky=Zs(function(e,i,s){ri(e,s,i)});function ao(e,i){var s=ye(e)?it:Au;return s(e,ue(i,3))}function Hy(e,i,s,c){return e==null?[]:(ye(i)||(i=i==null?[]:[i]),s=c?t:s,ye(s)||(s=s==null?[]:[s]),$u(e,i,s))}var Ky=Zs(function(e,i,s){e[s?0:1].push(i)},function(){return[[],[]]});function Vy(e,i,s){var c=ye(e)?ia:iu,l=arguments.length<3;return c(e,ue(i,4),s,l,bi)}function By(e,i,s){var c=ye(e)?np:iu,l=arguments.length<3;return c(e,ue(i,4),s,l,Eu)}function Gy(e,i){var s=ye(e)?yi:Iu;return s(e,ho(ue(i,3)))}function Wy(e){var i=ye(e)?vu:Ud;return i(e)}function Jy(e,i,s){(s?er(e,i,s):i===t)?i=1:i=me(i);var c=ye(e)?md:zd;return c(e,i)}function Qy(e){var i=ye(e)?vd:Hd;return i(e)}function Yy(e){if(e==null)return 0;if(ur(e))return fo(e)?an(e):e.length;var i=Wt(e);return i==ve||i==De?e.size:Ea(e).length}function Zy(e,i,s){var c=ye(e)?na:Kd;return s&&er(e,i,s)&&(i=t),c(e,ue(i,3))}var Xy=_e(function(e,i){if(e==null)return[];var s=i.length;return s>1&&er(e,i[0],i[1])?i=[]:s>2&&er(i[0],i[1],i[2])&&(i=[i[0]]),$u(e,Vt(i,1),[])}),co=$p||function(){return Pe.Date.now()};function em(e,i){if(typeof i!="function")throw new Pr(p);return e=me(e),function(){if(--e<1)return i.apply(this,arguments)}}function Oh(e,i,s){return i=s?t:i,i=e&&i==null?e.length:i,ii(e,D,t,t,t,t,i)}function Ch(e,i){var s;if(typeof i!="function")throw new Pr(p);return e=me(e),function(){return--e>0&&(s=i.apply(this,arguments)),e<=1&&(i=t),s}}var Ba=_e(function(e,i,s){var c=oe;if(s.length){var l=vi(s,gn(Ba));c|=q}return ii(e,c,i,s,l)}),Ah=_e(function(e,i,s){var c=oe|fe;if(s.length){var l=vi(s,gn(Ah));c|=q}return ii(i,c,e,s,l)});function Nh(e,i,s){i=s?t:i;var c=ii(e,$,t,t,t,t,t,i);return c.placeholder=Nh.placeholder,c}function Rh(e,i,s){i=s?t:i;var c=ii(e,M,t,t,t,t,t,i);return c.placeholder=Rh.placeholder,c}function Th(e,i,s){var c,l,d,v,_,O,z=0,k=!1,G=!1,X=!0;if(typeof e!="function")throw new Pr(p);i=Rr(i)||0,ct(s)&&(k=!!s.leading,G="maxWait"in s,d=G?jt(Rr(s.maxWait)||0,i):d,X="trailing"in s?!!s.trailing:X);function ne(Et){var qr=c,ci=l;return c=l=t,z=Et,v=e.apply(ci,qr),v}function he(Et){return z=Et,_=Hn(Ie,i),k?ne(Et):v}function we(Et){var qr=Et-O,ci=Et-z,Yh=i-qr;return G?Gt(Yh,d-ci):Yh}function le(Et){var qr=Et-O,ci=Et-z;return O===t||qr>=i||qr<0||G&&ci>=d}function Ie(){var Et=co();if(le(Et))return Oe(Et);_=Hn(Ie,we(Et))}function Oe(Et){return _=t,X&&c?ne(Et):(c=l=t,v)}function br(){_!==t&&ku(_),z=0,c=O=l=_=t}function tr(){return _===t?v:Oe(co())}function _r(){var Et=co(),qr=le(Et);if(c=arguments,l=this,O=Et,qr){if(_===t)return he(O);if(G)return ku(_),_=Hn(Ie,i),ne(O)}return _===t&&(_=Hn(Ie,i)),v}return _r.cancel=br,_r.flush=tr,_r}var tm=_e(function(e,i){return _u(e,1,i)}),rm=_e(function(e,i,s){return _u(e,Rr(i)||0,s)});function im(e){return ii(e,ce)}function uo(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Pr(p);var s=function(){var c=arguments,l=i?i.apply(this,c):c[0],d=s.cache;if(d.has(l))return d.get(l);var v=e.apply(this,c);return s.cache=d.set(l,v)||d,v};return s.cache=new(uo.Cache||ti),s}uo.Cache=ti;function ho(e){if(typeof e!="function")throw new Pr(p);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function nm(e){return Ch(2,e)}var sm=Vd(function(e,i){i=i.length==1&&ye(i[0])?it(i[0],mr(ue())):it(Vt(i,1),mr(ue()));var s=i.length;return _e(function(c){for(var l=-1,d=Gt(c.length,s);++l<d;)c[l]=i[l].call(this,c[l]);return Mt(e,this,c)})}),Ga=_e(function(e,i){var s=vi(i,gn(Ga));return ii(e,q,t,i,s)}),$h=_e(function(e,i){var s=vi(i,gn($h));return ii(e,I,t,i,s)}),om=ni(function(e,i){return ii(e,H,t,t,t,i)});function am(e,i){if(typeof e!="function")throw new Pr(p);return i=i===t?i:me(i),_e(e,i)}function cm(e,i){if(typeof e!="function")throw new Pr(p);return i=i==null?0:jt(me(i),0),_e(function(s){var c=s[i],l=Ii(s,0,i);return c&&mi(l,c),Mt(e,this,l)})}function um(e,i,s){var c=!0,l=!0;if(typeof e!="function")throw new Pr(p);return ct(s)&&(c="leading"in s?!!s.leading:c,l="trailing"in s?!!s.trailing:l),Th(e,i,{leading:c,maxWait:i,trailing:l})}function hm(e){return Oh(e,1)}function lm(e,i){return Ga(Ra(i),e)}function fm(){if(!arguments.length)return[];var e=arguments[0];return ye(e)?e:[e]}function pm(e){return Cr(e,K)}function dm(e,i){return i=typeof i=="function"?i:t,Cr(e,K,i)}function gm(e){return Cr(e,S|K)}function ym(e,i){return i=typeof i=="function"?i:t,Cr(e,S|K,i)}function mm(e,i){return i==null||bu(e,i,Ut(i))}function jr(e,i){return e===i||e!==e&&i!==i}var vm=ro(wa),wm=ro(function(e,i){return e>=i}),Hi=Pu(function(){return arguments}())?Pu:function(e){return mt(e)&&qe.call(e,"callee")&&!fu.call(e,"callee")},ye=R.isArray,bm=Zt?mr(Zt):Cd;function ur(e){return e!=null&&lo(e.length)&&!oi(e)}function _t(e){return mt(e)&&ur(e)}function _m(e){return e===!0||e===!1||mt(e)&&Xt(e)==F}var xi=Dp||nc,Em=Fr?mr(Fr):Ad;function Im(e){return mt(e)&&e.nodeType===1&&!Kn(e)}function xm(e){if(e==null)return!0;if(ur(e)&&(ye(e)||typeof e=="string"||typeof e.splice=="function"||xi(e)||yn(e)||Hi(e)))return!e.length;var i=Wt(e);if(i==ve||i==De)return!e.size;if(kn(e))return!Ea(e).length;for(var s in e)if(qe.call(e,s))return!1;return!0}function Sm(e,i){return Mn(e,i)}function Pm(e,i,s){s=typeof s=="function"?s:t;var c=s?s(e,i):t;return c===t?Mn(e,i,t,s):!!c}function Wa(e){if(!mt(e))return!1;var i=Xt(e);return i==E||i==u||typeof e.message=="string"&&typeof e.name=="string"&&!Kn(e)}function Om(e){return typeof e=="number"&&du(e)}function oi(e){if(!ct(e))return!1;var i=Xt(e);return i==ie||i==pe||i==L||i==vt}function Fh(e){return typeof e=="number"&&e==me(e)}function lo(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ee}function ct(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function mt(e){return e!=null&&typeof e=="object"}var Dh=xr?mr(xr):Rd;function Cm(e,i){return e===i||_a(e,i,qa(i))}function Am(e,i,s){return s=typeof s=="function"?s:t,_a(e,i,qa(i),s)}function Nm(e){return Lh(e)&&e!=+e}function Rm(e){if(dg(e))throw new de(h);return Ou(e)}function Tm(e){return e===null}function $m(e){return e==null}function Lh(e){return typeof e=="number"||mt(e)&&Xt(e)==Re}function Kn(e){if(!mt(e)||Xt(e)!=xe)return!1;var i=qs(e);if(i===null)return!0;var s=qe.call(i,"constructor")&&i.constructor;return typeof s=="function"&&s instanceof s&&Fs.call(s)==Ap}var Ja=Kr?mr(Kr):Td;function Fm(e){return Fh(e)&&e>=-ee&&e<=ee}var jh=An?mr(An):$d;function fo(e){return typeof e=="string"||!ye(e)&&mt(e)&&Xt(e)==Je}function wr(e){return typeof e=="symbol"||mt(e)&&Xt(e)==Qe}var yn=Di?mr(Di):Fd;function Dm(e){return e===t}function Lm(e){return mt(e)&&Wt(e)==Ue}function jm(e){return mt(e)&&Xt(e)==Ye}var qm=ro(Ia),Mm=ro(function(e,i){return e<=i});function qh(e){if(!e)return[];if(ur(e))return fo(e)?Dr(e):cr(e);if(Rn&&e[Rn])return mp(e[Rn]());var i=Wt(e),s=i==ve?ha:i==De?Rs:mn;return s(e)}function ai(e){if(!e)return e===0?e:0;if(e=Rr(e),e===Ne||e===-Ne){var i=e<0?-1:1;return i*Q}return e===e?e:0}function me(e){var i=ai(e),s=i%1;return i===i?s?i-s:i:0}function Mh(e){return e?Mi(me(e),0,Y):0}function Rr(e){if(typeof e=="number")return e;if(wr(e))return W;if(ct(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ct(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=nu(e);var s=Mo.test(e);return s||zo.test(e)?ge(e.slice(2),s?2:8):qo.test(e)?W:+e}function Uh(e){return Br(e,hr(e))}function Um(e){return e?Mi(me(e),-ee,ee):e===0?e:0}function Le(e){return e==null?"":vr(e)}var zm=pn(function(e,i){if(kn(i)||ur(i)){Br(i,Ut(i),e);return}for(var s in i)qe.call(i,s)&&Ln(e,s,i[s])}),zh=pn(function(e,i){Br(i,hr(i),e)}),po=pn(function(e,i,s,c){Br(i,hr(i),e,c)}),km=pn(function(e,i,s,c){Br(i,Ut(i),e,c)}),Hm=ni(ya);function Km(e,i){var s=fn(e);return i==null?s:wu(s,i)}var Vm=_e(function(e,i){e=Ge(e);var s=-1,c=i.length,l=c>2?i[2]:t;for(l&&er(i[0],i[1],l)&&(c=1);++s<c;)for(var d=i[s],v=hr(d),_=-1,O=v.length;++_<O;){var z=v[_],k=e[z];(k===t||jr(k,un[z])&&!qe.call(e,z))&&(e[z]=d[z])}return e}),Bm=_e(function(e){return e.push(t,nh),Mt(kh,t,e)});function Gm(e,i){return eu(e,ue(i,3),Vr)}function Wm(e,i){return eu(e,ue(i,3),va)}function Jm(e,i){return e==null?e:ma(e,ue(i,3),hr)}function Qm(e,i){return e==null?e:xu(e,ue(i,3),hr)}function Ym(e,i){return e&&Vr(e,ue(i,3))}function Zm(e,i){return e&&va(e,ue(i,3))}function Xm(e){return e==null?[]:Ws(e,Ut(e))}function e0(e){return e==null?[]:Ws(e,hr(e))}function Qa(e,i,s){var c=e==null?t:Ui(e,i);return c===t?s:c}function t0(e,i){return e!=null&&ah(e,i,xd)}function Ya(e,i){return e!=null&&ah(e,i,Sd)}var r0=Xu(function(e,i,s){i!=null&&typeof i.toString!="function"&&(i=Ds.call(i)),e[i]=s},Xa(lr)),i0=Xu(function(e,i,s){i!=null&&typeof i.toString!="function"&&(i=Ds.call(i)),qe.call(e,i)?e[i].push(s):e[i]=[s]},ue),n0=_e(qn);function Ut(e){return ur(e)?mu(e):Ea(e)}function hr(e){return ur(e)?mu(e,!0):Dd(e)}function s0(e,i){var s={};return i=ue(i,3),Vr(e,function(c,l,d){ri(s,i(c,l,d),c)}),s}function o0(e,i){var s={};return i=ue(i,3),Vr(e,function(c,l,d){ri(s,l,i(c,l,d))}),s}var a0=pn(function(e,i,s){Js(e,i,s)}),kh=pn(function(e,i,s,c){Js(e,i,s,c)}),c0=ni(function(e,i){var s={};if(e==null)return s;var c=!1;i=it(i,function(d){return d=Ei(d,e),c||(c=d.length>1),d}),Br(e,La(e),s),c&&(s=Cr(s,S|N|K,rg));for(var l=i.length;l--;)Ca(s,i[l]);return s});function u0(e,i){return Hh(e,ho(ue(i)))}var h0=ni(function(e,i){return e==null?{}:jd(e,i)});function Hh(e,i){if(e==null)return{};var s=it(La(e),function(c){return[c]});return i=ue(i),Fu(e,s,function(c,l){return i(c,l[0])})}function l0(e,i,s){i=Ei(i,e);var c=-1,l=i.length;for(l||(l=1,e=t);++c<l;){var d=e==null?t:e[Gr(i[c])];d===t&&(c=l,d=s),e=oi(d)?d.call(e):d}return e}function f0(e,i,s){return e==null?e:Un(e,i,s)}function p0(e,i,s,c){return c=typeof c=="function"?c:t,e==null?e:Un(e,i,s,c)}var Kh=rh(Ut),Vh=rh(hr);function d0(e,i,s){var c=ye(e),l=c||xi(e)||yn(e);if(i=ue(i,4),s==null){var d=e&&e.constructor;l?s=c?new d:[]:ct(e)?s=oi(d)?fn(qs(e)):{}:s={}}return(l?Sr:Vr)(e,function(v,_,O){return i(s,v,_,O)}),s}function g0(e,i){return e==null?!0:Ca(e,i)}function y0(e,i,s){return e==null?e:Mu(e,i,Ra(s))}function m0(e,i,s,c){return c=typeof c=="function"?c:t,e==null?e:Mu(e,i,Ra(s),c)}function mn(e){return e==null?[]:ua(e,Ut(e))}function v0(e){return e==null?[]:ua(e,hr(e))}function w0(e,i,s){return s===t&&(s=i,i=t),s!==t&&(s=Rr(s),s=s===s?s:0),i!==t&&(i=Rr(i),i=i===i?i:0),Mi(Rr(e),i,s)}function b0(e,i,s){return i=ai(i),s===t?(s=i,i=0):s=ai(s),e=Rr(e),Pd(e,i,s)}function _0(e,i,s){if(s&&typeof s!="boolean"&&er(e,i,s)&&(i=s=t),s===t&&(typeof i=="boolean"?(s=i,i=t):typeof e=="boolean"&&(s=e,e=t)),e===t&&i===t?(e=0,i=1):(e=ai(e),i===t?(i=e,e=0):i=ai(i)),e>i){var c=e;e=i,i=c}if(s||e%1||i%1){var l=gu();return Gt(e+l*(i-e+Ve("1e-"+((l+"").length-1))),i)}return Sa(e,i)}var E0=dn(function(e,i,s){return i=i.toLowerCase(),e+(s?Bh(i):i)});function Bh(e){return Za(Le(e).toLowerCase())}function Gh(e){return e=Le(e),e&&e.replace(Zr,fp).replace(ea,"")}function I0(e,i,s){e=Le(e),i=vr(i);var c=e.length;s=s===t?c:Mi(me(s),0,c);var l=s;return s-=i.length,s>=0&&e.slice(s,l)==i}function x0(e){return e=Le(e),e&&tt.test(e)?e.replace(Ni,pp):e}function S0(e){return e=Le(e),e&&At.test(e)?e.replace(dt,"\\$&"):e}var P0=dn(function(e,i,s){return e+(s?"-":"")+i.toLowerCase()}),O0=dn(function(e,i,s){return e+(s?" ":"")+i.toLowerCase()}),C0=Qu("toLowerCase");function A0(e,i,s){e=Le(e),i=me(i);var c=i?an(e):0;if(!i||c>=i)return e;var l=(i-c)/2;return to(ks(l),s)+e+to(zs(l),s)}function N0(e,i,s){e=Le(e),i=me(i);var c=i?an(e):0;return i&&c<i?e+to(i-c,s):e}function R0(e,i,s){e=Le(e),i=me(i);var c=i?an(e):0;return i&&c<i?to(i-c,s)+e:e}function T0(e,i,s){return s||i==null?i=0:i&&(i=+i),Mp(Le(e).replace(gt,""),i||0)}function $0(e,i,s){return(s?er(e,i,s):i===t)?i=1:i=me(i),Pa(Le(e),i)}function F0(){var e=arguments,i=Le(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var D0=dn(function(e,i,s){return e+(s?"_":"")+i.toLowerCase()});function L0(e,i,s){return s&&typeof s!="number"&&er(e,i,s)&&(i=s=t),s=s===t?Y:s>>>0,s?(e=Le(e),e&&(typeof i=="string"||i!=null&&!Ja(i))&&(i=vr(i),!i&&on(e))?Ii(Dr(e),0,s):e.split(i,s)):[]}var j0=dn(function(e,i,s){return e+(s?" ":"")+Za(i)});function q0(e,i,s){return e=Le(e),s=s==null?0:Mi(me(s),0,e.length),i=vr(i),e.slice(s,s+i.length)==i}function M0(e,i,s){var c=f.templateSettings;s&&er(e,i,s)&&(i=t),e=Le(e),i=po({},i,c,ih);var l=po({},i.imports,c.imports,ih),d=Ut(l),v=ua(l,d),_,O,z=0,k=i.interpolate||Yi,G="__p += '",X=la((i.escape||Yi).source+"|"+k.source+"|"+(k===at?jo:Yi).source+"|"+(i.evaluate||Yi).source+"|$","g"),ne="//# sourceURL="+(qe.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ta+"]")+`
`;e.replace(X,function(le,Ie,Oe,br,tr,_r){return Oe||(Oe=br),G+=e.slice(z,_r).replace(Ho,dp),Ie&&(_=!0,G+=`' +
__e(`+Ie+`) +
'`),tr&&(O=!0,G+=`';
`+tr+`;
__p += '`),Oe&&(G+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),z=_r+le.length,le}),G+=`';
`;var he=qe.call(i,"variable")&&i.variable;if(!he)G=`with (obj) {
`+G+`
}
`;else if(Do.test(he))throw new de(g);G=(O?G.replace(kr,""):G).replace(Yt,"$1").replace(Yr,"$1;"),G="function("+(he||"obj")+`) {
`+(he?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(O?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+G+`return __p
}`;var we=Jh(function(){return Fe(d,ne+"return "+G).apply(t,v)});if(we.source=G,Wa(we))throw we;return we}function U0(e){return Le(e).toLowerCase()}function z0(e){return Le(e).toUpperCase()}function k0(e,i,s){if(e=Le(e),e&&(s||i===t))return nu(e);if(!e||!(i=vr(i)))return e;var c=Dr(e),l=Dr(i),d=su(c,l),v=ou(c,l)+1;return Ii(c,d,v).join("")}function H0(e,i,s){if(e=Le(e),e&&(s||i===t))return e.slice(0,cu(e)+1);if(!e||!(i=vr(i)))return e;var c=Dr(e),l=ou(c,Dr(i))+1;return Ii(c,0,l).join("")}function K0(e,i,s){if(e=Le(e),e&&(s||i===t))return e.replace(gt,"");if(!e||!(i=vr(i)))return e;var c=Dr(e),l=su(c,Dr(i));return Ii(c,l).join("")}function V0(e,i){var s=ae,c=Ee;if(ct(i)){var l="separator"in i?i.separator:l;s="length"in i?me(i.length):s,c="omission"in i?vr(i.omission):c}e=Le(e);var d=e.length;if(on(e)){var v=Dr(e);d=v.length}if(s>=d)return e;var _=s-an(c);if(_<1)return c;var O=v?Ii(v,0,_).join(""):e.slice(0,_);if(l===t)return O+c;if(v&&(_+=O.length-_),Ja(l)){if(e.slice(_).search(l)){var z,k=O;for(l.global||(l=la(l.source,Le(Ir.exec(l))+"g")),l.lastIndex=0;z=l.exec(k);)var G=z.index;O=O.slice(0,G===t?_:G)}}else if(e.indexOf(vr(l),_)!=_){var X=O.lastIndexOf(l);X>-1&&(O=O.slice(0,X))}return O+c}function B0(e){return e=Le(e),e&&lt.test(e)?e.replace(di,_p):e}var G0=dn(function(e,i,s){return e+(s?" ":"")+i.toUpperCase()}),Za=Qu("toUpperCase");function Wh(e,i,s){return e=Le(e),i=s?t:i,i===t?yp(e)?xp(e):ap(e):e.match(i)||[]}var Jh=_e(function(e,i){try{return Mt(e,t,i)}catch(s){return Wa(s)?s:new de(s)}}),W0=ni(function(e,i){return Sr(i,function(s){s=Gr(s),ri(e,s,Ba(e[s],e))}),e});function J0(e){var i=e==null?0:e.length,s=ue();return e=i?it(e,function(c){if(typeof c[1]!="function")throw new Pr(p);return[s(c[0]),c[1]]}):[],_e(function(c){for(var l=-1;++l<i;){var d=e[l];if(Mt(d[0],this,c))return Mt(d[1],this,c)}})}function Q0(e){return _d(Cr(e,S))}function Xa(e){return function(){return e}}function Y0(e,i){return e==null||e!==e?i:e}var Z0=Zu(),X0=Zu(!0);function lr(e){return e}function ec(e){return Cu(typeof e=="function"?e:Cr(e,S))}function ev(e){return Nu(Cr(e,S))}function tv(e,i){return Ru(e,Cr(i,S))}var rv=_e(function(e,i){return function(s){return qn(s,e,i)}}),iv=_e(function(e,i){return function(s){return qn(e,s,i)}});function tc(e,i,s){var c=Ut(i),l=Ws(i,c);s==null&&!(ct(i)&&(l.length||!c.length))&&(s=i,i=e,e=this,l=Ws(i,Ut(i)));var d=!(ct(s)&&"chain"in s)||!!s.chain,v=oi(e);return Sr(l,function(_){var O=i[_];e[_]=O,v&&(e.prototype[_]=function(){var z=this.__chain__;if(d||z){var k=e(this.__wrapped__),G=k.__actions__=cr(this.__actions__);return G.push({func:O,args:arguments,thisArg:e}),k.__chain__=z,k}return O.apply(e,mi([this.value()],arguments))})}),e}function nv(){return Pe._===this&&(Pe._=Np),this}function rc(){}function sv(e){return e=me(e),_e(function(i){return Tu(i,e)})}var ov=$a(it),av=$a(Xc),cv=$a(na);function Qh(e){return Ua(e)?sa(Gr(e)):qd(e)}function uv(e){return function(i){return e==null?t:Ui(e,i)}}var hv=eh(),lv=eh(!0);function ic(){return[]}function nc(){return!1}function fv(){return{}}function pv(){return""}function dv(){return!0}function gv(e,i){if(e=me(e),e<1||e>ee)return[];var s=Y,c=Gt(e,Y);i=ue(i),e-=Y;for(var l=ca(c,i);++s<e;)i(s);return l}function yv(e){return ye(e)?it(e,Gr):wr(e)?[e]:cr(yh(Le(e)))}function mv(e){var i=++Cp;return Le(e)+i}var vv=eo(function(e,i){return e+i},0),wv=Fa("ceil"),bv=eo(function(e,i){return e/i},1),_v=Fa("floor");function Ev(e){return e&&e.length?Gs(e,lr,wa):t}function Iv(e,i){return e&&e.length?Gs(e,ue(i,2),wa):t}function xv(e){return ru(e,lr)}function Sv(e,i){return ru(e,ue(i,2))}function Pv(e){return e&&e.length?Gs(e,lr,Ia):t}function Ov(e,i){return e&&e.length?Gs(e,ue(i,2),Ia):t}var Cv=eo(function(e,i){return e*i},1),Av=Fa("round"),Nv=eo(function(e,i){return e-i},0);function Rv(e){return e&&e.length?aa(e,lr):0}function Tv(e,i){return e&&e.length?aa(e,ue(i,2)):0}return f.after=em,f.ary=Oh,f.assign=zm,f.assignIn=zh,f.assignInWith=po,f.assignWith=km,f.at=Hm,f.before=Ch,f.bind=Ba,f.bindAll=W0,f.bindKey=Ah,f.castArray=fm,f.chain=xh,f.chunk=_g,f.compact=Eg,f.concat=Ig,f.cond=J0,f.conforms=Q0,f.constant=Xa,f.countBy=Ry,f.create=Km,f.curry=Nh,f.curryRight=Rh,f.debounce=Th,f.defaults=Vm,f.defaultsDeep=Bm,f.defer=tm,f.delay=rm,f.difference=xg,f.differenceBy=Sg,f.differenceWith=Pg,f.drop=Og,f.dropRight=Cg,f.dropRightWhile=Ag,f.dropWhile=Ng,f.fill=Rg,f.filter=$y,f.flatMap=Ly,f.flatMapDeep=jy,f.flatMapDepth=qy,f.flatten=bh,f.flattenDeep=Tg,f.flattenDepth=$g,f.flip=im,f.flow=Z0,f.flowRight=X0,f.fromPairs=Fg,f.functions=Xm,f.functionsIn=e0,f.groupBy=My,f.initial=Lg,f.intersection=jg,f.intersectionBy=qg,f.intersectionWith=Mg,f.invert=r0,f.invertBy=i0,f.invokeMap=zy,f.iteratee=ec,f.keyBy=ky,f.keys=Ut,f.keysIn=hr,f.map=ao,f.mapKeys=s0,f.mapValues=o0,f.matches=ev,f.matchesProperty=tv,f.memoize=uo,f.merge=a0,f.mergeWith=kh,f.method=rv,f.methodOf=iv,f.mixin=tc,f.negate=ho,f.nthArg=sv,f.omit=c0,f.omitBy=u0,f.once=nm,f.orderBy=Hy,f.over=ov,f.overArgs=sm,f.overEvery=av,f.overSome=cv,f.partial=Ga,f.partialRight=$h,f.partition=Ky,f.pick=h0,f.pickBy=Hh,f.property=Qh,f.propertyOf=uv,f.pull=Hg,f.pullAll=Eh,f.pullAllBy=Kg,f.pullAllWith=Vg,f.pullAt=Bg,f.range=hv,f.rangeRight=lv,f.rearg=om,f.reject=Gy,f.remove=Gg,f.rest=am,f.reverse=Ka,f.sampleSize=Jy,f.set=f0,f.setWith=p0,f.shuffle=Qy,f.slice=Wg,f.sortBy=Xy,f.sortedUniq=ty,f.sortedUniqBy=ry,f.split=L0,f.spread=cm,f.tail=iy,f.take=ny,f.takeRight=sy,f.takeRightWhile=oy,f.takeWhile=ay,f.tap=Ey,f.throttle=um,f.thru=oo,f.toArray=qh,f.toPairs=Kh,f.toPairsIn=Vh,f.toPath=yv,f.toPlainObject=Uh,f.transform=d0,f.unary=hm,f.union=cy,f.unionBy=uy,f.unionWith=hy,f.uniq=ly,f.uniqBy=fy,f.uniqWith=py,f.unset=g0,f.unzip=Va,f.unzipWith=Ih,f.update=y0,f.updateWith=m0,f.values=mn,f.valuesIn=v0,f.without=dy,f.words=Wh,f.wrap=lm,f.xor=gy,f.xorBy=yy,f.xorWith=my,f.zip=vy,f.zipObject=wy,f.zipObjectDeep=by,f.zipWith=_y,f.entries=Kh,f.entriesIn=Vh,f.extend=zh,f.extendWith=po,tc(f,f),f.add=vv,f.attempt=Jh,f.camelCase=E0,f.capitalize=Bh,f.ceil=wv,f.clamp=w0,f.clone=pm,f.cloneDeep=gm,f.cloneDeepWith=ym,f.cloneWith=dm,f.conformsTo=mm,f.deburr=Gh,f.defaultTo=Y0,f.divide=bv,f.endsWith=I0,f.eq=jr,f.escape=x0,f.escapeRegExp=S0,f.every=Ty,f.find=Fy,f.findIndex=vh,f.findKey=Gm,f.findLast=Dy,f.findLastIndex=wh,f.findLastKey=Wm,f.floor=_v,f.forEach=Sh,f.forEachRight=Ph,f.forIn=Jm,f.forInRight=Qm,f.forOwn=Ym,f.forOwnRight=Zm,f.get=Qa,f.gt=vm,f.gte=wm,f.has=t0,f.hasIn=Ya,f.head=_h,f.identity=lr,f.includes=Uy,f.indexOf=Dg,f.inRange=b0,f.invoke=n0,f.isArguments=Hi,f.isArray=ye,f.isArrayBuffer=bm,f.isArrayLike=ur,f.isArrayLikeObject=_t,f.isBoolean=_m,f.isBuffer=xi,f.isDate=Em,f.isElement=Im,f.isEmpty=xm,f.isEqual=Sm,f.isEqualWith=Pm,f.isError=Wa,f.isFinite=Om,f.isFunction=oi,f.isInteger=Fh,f.isLength=lo,f.isMap=Dh,f.isMatch=Cm,f.isMatchWith=Am,f.isNaN=Nm,f.isNative=Rm,f.isNil=$m,f.isNull=Tm,f.isNumber=Lh,f.isObject=ct,f.isObjectLike=mt,f.isPlainObject=Kn,f.isRegExp=Ja,f.isSafeInteger=Fm,f.isSet=jh,f.isString=fo,f.isSymbol=wr,f.isTypedArray=yn,f.isUndefined=Dm,f.isWeakMap=Lm,f.isWeakSet=jm,f.join=Ug,f.kebabCase=P0,f.last=Nr,f.lastIndexOf=zg,f.lowerCase=O0,f.lowerFirst=C0,f.lt=qm,f.lte=Mm,f.max=Ev,f.maxBy=Iv,f.mean=xv,f.meanBy=Sv,f.min=Pv,f.minBy=Ov,f.stubArray=ic,f.stubFalse=nc,f.stubObject=fv,f.stubString=pv,f.stubTrue=dv,f.multiply=Cv,f.nth=kg,f.noConflict=nv,f.noop=rc,f.now=co,f.pad=A0,f.padEnd=N0,f.padStart=R0,f.parseInt=T0,f.random=_0,f.reduce=Vy,f.reduceRight=By,f.repeat=$0,f.replace=F0,f.result=l0,f.round=Av,f.runInContext=P,f.sample=Wy,f.size=Yy,f.snakeCase=D0,f.some=Zy,f.sortedIndex=Jg,f.sortedIndexBy=Qg,f.sortedIndexOf=Yg,f.sortedLastIndex=Zg,f.sortedLastIndexBy=Xg,f.sortedLastIndexOf=ey,f.startCase=j0,f.startsWith=q0,f.subtract=Nv,f.sum=Rv,f.sumBy=Tv,f.template=M0,f.times=gv,f.toFinite=ai,f.toInteger=me,f.toLength=Mh,f.toLower=U0,f.toNumber=Rr,f.toSafeInteger=Um,f.toString=Le,f.toUpper=z0,f.trim=k0,f.trimEnd=H0,f.trimStart=K0,f.truncate=V0,f.unescape=B0,f.uniqueId=mv,f.upperCase=G0,f.upperFirst=Za,f.each=Sh,f.eachRight=Ph,f.first=_h,tc(f,function(){var e={};return Vr(f,function(i,s){qe.call(f.prototype,s)||(e[s]=i)}),e}(),{chain:!1}),f.VERSION=n,Sr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),Sr(["drop","take"],function(e,i){Se.prototype[e]=function(s){s=s===t?1:jt(me(s),0);var c=this.__filtered__&&!i?new Se(this):this.clone();return c.__filtered__?c.__takeCount__=Gt(s,c.__takeCount__):c.__views__.push({size:Gt(s,Y),type:e+(c.__dir__<0?"Right":"")}),c},Se.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),Sr(["filter","map","takeWhile"],function(e,i){var s=i+1,c=s==T||s==Me;Se.prototype[e]=function(l){var d=this.clone();return d.__iteratees__.push({iteratee:ue(l,3),type:s}),d.__filtered__=d.__filtered__||c,d}}),Sr(["head","last"],function(e,i){var s="take"+(i?"Right":"");Se.prototype[e]=function(){return this[s](1).value()[0]}}),Sr(["initial","tail"],function(e,i){var s="drop"+(i?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[s](1)}}),Se.prototype.compact=function(){return this.filter(lr)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=_e(function(e,i){return typeof e=="function"?new Se(this):this.map(function(s){return qn(s,e,i)})}),Se.prototype.reject=function(e){return this.filter(ho(ue(e)))},Se.prototype.slice=function(e,i){e=me(e);var s=this;return s.__filtered__&&(e>0||i<0)?new Se(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),i!==t&&(i=me(i),s=i<0?s.dropRight(-i):s.take(i-e)),s)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(Y)},Vr(Se.prototype,function(e,i){var s=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),l=f[c?"take"+(i=="last"?"Right":""):i],d=c||/^find/.test(i);l&&(f.prototype[i]=function(){var v=this.__wrapped__,_=c?[1]:arguments,O=v instanceof Se,z=_[0],k=O||ye(v),G=function(Ie){var Oe=l.apply(f,mi([Ie],_));return c&&X?Oe[0]:Oe};k&&s&&typeof z=="function"&&z.length!=1&&(O=k=!1);var X=this.__chain__,ne=!!this.__actions__.length,he=d&&!X,we=O&&!ne;if(!d&&k){v=we?v:new Se(this);var le=e.apply(v,_);return le.__actions__.push({func:oo,args:[G],thisArg:t}),new Or(le,X)}return he&&we?e.apply(this,_):(le=this.thru(G),he?c?le.value()[0]:le.value():le)})}),Sr(["pop","push","shift","sort","splice","unshift"],function(e){var i=Ts[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var d=this.value();return i.apply(ye(d)?d:[],l)}return this[s](function(v){return i.apply(ye(v)?v:[],l)})}}),Vr(Se.prototype,function(e,i){var s=f[i];if(s){var c=s.name+"";qe.call(ln,c)||(ln[c]=[]),ln[c].push({name:i,func:s})}}),ln[Xs(t,fe).name]=[{name:"wrapper",func:t}],Se.prototype.clone=Bp,Se.prototype.reverse=Gp,Se.prototype.value=Wp,f.prototype.at=Iy,f.prototype.chain=xy,f.prototype.commit=Sy,f.prototype.next=Py,f.prototype.plant=Cy,f.prototype.reverse=Ay,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=Ny,f.prototype.first=f.prototype.head,Rn&&(f.prototype[Rn]=Oy),f},cn=Sp();bt?((bt.exports=cn)._=cn,Be._=cn):Pe._=cn}).call(Yn)})(Tc,Tc.exports);var TI=Object.defineProperty,$I=Object.defineProperties,FI=Object.getOwnPropertyDescriptors,ef=Object.getOwnPropertySymbols,DI=Object.prototype.hasOwnProperty,LI=Object.prototype.propertyIsEnumerable,tf=(o,r,t)=>r in o?TI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,bo=(o,r)=>{for(var t in r||(r={}))DI.call(r,t)&&tf(o,t,r[t]);if(ef)for(var t of ef(r))LI.call(r,t)&&tf(o,t,r[t]);return o},jI=(o,r)=>$I(o,FI(r));function Ci(o,r,t){var n;const a=u1(o);return((n=r.rpcMap)==null?void 0:n[a.reference])||`${RI}?chainId=${a.namespace}:${a.reference}&projectId=${t}`}function Qi(o){return o.includes(":")?o.split(":")[1]:o}function ep(o){return o.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function qI(o,r){const t=Object.keys(r.namespaces).filter(a=>a.includes(o));if(!t.length)return[];const n=[];return t.forEach(a=>{const h=r.namespaces[a].accounts;n.push(...h)}),n}function MI(o={},r={}){const t=rf(o),n=rf(r);return Tc.exports.merge(t,n)}function rf(o){var r,t,n,a;const h={};if(!_n(o))return h;for(const[p,g]of Object.entries(o)){const w=Vc(p)?[p]:g.chains,y=g.methods||[],b=g.events||[],S=g.rpcMap||{},N=Zn(p);h[N]=jI(bo(bo({},h[N]),g),{chains:oc(w,(r=h[N])==null?void 0:r.chains),methods:oc(y,(t=h[N])==null?void 0:t.methods),events:oc(b,(n=h[N])==null?void 0:n.events),rpcMap:bo(bo({},S),(a=h[N])==null?void 0:a.rpcMap)})}return h}function UI(o){return o.includes(":")?o.split(":")[2]:o}function zI(o){const r={};for(const[t,n]of Object.entries(o)){const a=n.methods||[],h=n.events||[],p=n.accounts||[],g=Vc(t)?[t]:n.chains?n.chains:ep(n.accounts);r[t]={chains:g,methods:a,events:h,accounts:p}}return r}function wc(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const tp={},nt=o=>tp[o],bc=(o,r)=>{tp[o]=r};class kI{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;const a=Qi(t);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||Ci(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ai(n,nt("disableProviderPing")))}}class HI{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(parseInt(r),t),this.chainId=parseInt(r),this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,t){const n=t||Ci(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ai(n,nt("disableProviderPing")))}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;const a=parseInt(Qi(t));r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}async handleSwitchChain(r){var t,n;let a=r.request.params?(t=r.request.params[0])==null?void 0:t.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const h=parseInt(a,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:a}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class KI{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;const a=Qi(t);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||Ci(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ai(n,nt("disableProviderPing")))}}class VI{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;const a=Qi(t);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||Ci(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ai(n,nt("disableProviderPing")))}}class BI{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{const n=this.getCardanoRPCUrl(t),a=Qi(t);r[a]=this.createHttpProvider(a,n)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}getCardanoRPCUrl(r){const t=this.namespace.rpcMap;if(t)return t[r]}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||this.getCardanoRPCUrl(r);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ai(n,nt("disableProviderPing")))}}class GI{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;const a=Qi(t);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||Ci(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ai(n,nt("disableProviderPing")))}}class WI{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;const a=Qi(t);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||Ci(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ai(n,nt("disableProviderPing")))}}class JI{constructor(r){this.name="near",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){if(this.chainId=r,!this.httpProviders[r]){const n=t||Ci(`${this.name}:${r}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;r[t]=this.createHttpProvider(t,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||Ci(r,this.namespace);return typeof n>"u"?void 0:new fi(new Ai(n,nt("disableProviderPing")))}}var QI=Object.defineProperty,YI=Object.defineProperties,ZI=Object.getOwnPropertyDescriptors,nf=Object.getOwnPropertySymbols,XI=Object.prototype.hasOwnProperty,ex=Object.prototype.propertyIsEnumerable,sf=(o,r,t)=>r in o?QI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,_o=(o,r)=>{for(var t in r||(r={}))XI.call(r,t)&&sf(o,t,r[t]);if(nf)for(var t of nf(r))ex.call(r,t)&&sf(o,t,r[t]);return o},_c=(o,r)=>YI(o,ZI(r));class Yc{constructor(r){this.events=new Lc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:r?.logger||Zl})),this.disableProviderPing=r?.disableProviderPing||!1}static async init(r){const t=new Yc(r);return await t.initialize(),t}async request(r,t){const[n,a]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:_o({},r),chainId:`${n}:${a}`,topic:this.session.topic})}sendAsync(r,t,n){this.request(r,n).then(a=>t(null,a)).catch(a=>t(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:It("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,t){this.events.on(r,t)}once(r,t){this.events.once(r,t)}removeListener(r,t){this.events.removeListener(r,t)}off(r,t){this.events.off(r,t)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:a}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await a().then(h=>{this.session=h,this.namespaces||(this.namespaces=zI(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==Zf)throw h;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,t){try{if(!this.session)return;const[n,a]=this.validateChain(r);this.getProvider(n).setDefaultChain(a,t)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Jr(t)){for(const n of t)r.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await OI.init({logger:this.providerOpts.logger||Zl,relayUrl:this.providerOpts.relayUrl||CI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(t=>Zn(t)))];bc("client",this.client),bc("events",this.events),bc("disableProviderPing",this.disableProviderPing),r.forEach(t=>{if(!this.session)return;const n=qI(t,this.session),a=ep(n),h=MI(this.namespaces,this.optionalNamespaces),p=_c(_o({},h[t]),{accounts:n,chains:a});switch(t){case"eip155":this.rpcProviders[t]=new HI({namespace:p});break;case"solana":this.rpcProviders[t]=new KI({namespace:p});break;case"cosmos":this.rpcProviders[t]=new VI({namespace:p});break;case"polkadot":this.rpcProviders[t]=new kI({namespace:p});break;case"cip34":this.rpcProviders[t]=new BI({namespace:p});break;case"elrond":this.rpcProviders[t]=new GI({namespace:p});break;case"multiversx":this.rpcProviders[t]=new WI({namespace:p});break;case"near":this.rpcProviders[t]=new JI({namespace:p});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:t}=r,{event:n}=t;if(n.name==="accountsChanged"){const a=n.data;a&&Jr(a)&&this.events.emit("accountsChanged",a.map(UI))}else if(n.name==="chainChanged"){const a=t.chainId,h=t.event.data,p=Zn(a),g=wc(a)!==wc(h)?`${p}:${wc(h)}`:a;this.onChainChanged(g)}else this.events.emit(n.name,n.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:t})=>{var n;const{namespaces:a}=t,h=(n=this.client)==null?void 0:n.session.get(r);this.session=_c(_o({},h),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:t})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",_c(_o({},It("USER_DISCONNECTED")),{data:r.topic}))}),this.on(pi.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var t;this.getProvider(r).updateNamespace((t=this.session)==null?void 0:t.namespaces[r])})}setNamespaces(r){const{namespaces:t,optionalNamespaces:n,sessionProperties:a}=r;t&&Object.keys(t).length&&(this.namespaces=t),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=a,this.persist("namespaces",t),this.persist("optionalNamespaces",n)}validateChain(r){const[t,n]=r?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,n];if(t&&!Object.keys(this.namespaces||{}).map(p=>Zn(p)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&n)return[t,n];const a=Zn(Object.keys(this.namespaces)[0]),h=this.rpcProviders[a].getDefaultChain();return[a,h]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,t=!1){var n;if(!this.namespaces)return;const[a,h]=this.validateChain(r);t||this.getProvider(a).setDefaultChain(h),((n=this.namespaces[a])!=null?n:this.namespaces[`${a}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,t){this.client.core.storage.setItem(`${Xl}/${r}`,t)}async getFromStore(r){return await this.client.core.storage.getItem(`${Xl}/${r}`)}}const tx=Yc,rx="wc",ix="ethereum_provider",nx=`${rx}@2:${ix}:`,sx="https://rpc.walletconnect.com/v1/",$c=["eth_sendTransaction","personal_sign"],ox=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Fc=["chainChanged","accountsChanged"],ax=["chainChanged","accountsChanged","message","disconnect","connect"];var cx=Object.defineProperty,ux=Object.defineProperties,hx=Object.getOwnPropertyDescriptors,of=Object.getOwnPropertySymbols,lx=Object.prototype.hasOwnProperty,fx=Object.prototype.propertyIsEnumerable,af=(o,r,t)=>r in o?cx(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,es=(o,r)=>{for(var t in r||(r={}))lx.call(r,t)&&af(o,t,r[t]);if(of)for(var t of of(r))fx.call(r,t)&&af(o,t,r[t]);return o},cf=(o,r)=>ux(o,hx(r));function No(o){return Number(o[0].split(":")[1])}function Ec(o){return`0x${o.toString(16)}`}function px(o){const{chains:r,optionalChains:t,methods:n,optionalMethods:a,events:h,optionalEvents:p,rpcMap:g}=o;if(!Jr(r))throw new Error("Invalid chains");const w={chains:r,methods:n||$c,events:h||Fc,rpcMap:es({},r.length?{[No(r)]:g[No(r)]}:{})},y=h?.filter(K=>!Fc.includes(K)),b=n?.filter(K=>!$c.includes(K));if(!t&&!p&&!a&&!(y!=null&&y.length)&&!(b!=null&&b.length))return{required:r.length?w:void 0};const S=y?.length&&b?.length||!t,N={chains:[...new Set(S?w.chains.concat(t||[]):t)],methods:[...new Set(w.methods.concat(a!=null&&a.length?a:ox))],events:[...new Set(w.events.concat(p!=null&&p.length?p:ax))],rpcMap:g};return{required:r.length?w:void 0,optional:t.length?N:void 0}}class Zc{constructor(){this.events=new Qr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=nx,this.on=(r,t)=>(this.events.on(r,t),this),this.once=(r,t)=>(this.events.once(r,t),this),this.removeListener=(r,t)=>(this.events.removeListener(r,t),this),this.off=(r,t)=>(this.events.off(r,t),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const t=new Zc;return await t.initialize(r),t}async request(r){return await this.signer.request(r,this.formatChainId(this.chainId))}sendAsync(r,t){this.signer.sendAsync(r,t,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:t,optional:n}=px(this.rpc);try{const a=await new Promise(async(p,g)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(y=>{!y.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(cf(es({namespaces:es({},t&&{[this.namespace]:t})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:r?.pairingTopic})).then(y=>{p(y)}).catch(y=>{g(new Error(y.message))})});if(!a)return;const h=h1(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:h),this.setAccounts(h),this.events.emit("connect",{chainId:Ec(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:t}=r,{event:n}=t;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const t=parseInt(r);this.chainId=t,this.events.emit("chainChanged",Ec(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",cf(es({},It("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var t,n;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(n=this.modal)==null||n.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const t=r.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",Ec(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const t=this.parseChainId(r);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(r){const[t,n,a]=r.split(":");return{chainId:`${t}:${n}`,address:a}}setAccounts(r){this.accounts=r.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var t,n;const a=(t=r?.chains)!=null?t:[],h=(n=r?.optionalChains)!=null?n:[],p=a.concat(h);if(!p.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=a.length?r?.methods||$c:[],w=a.length?r?.events||Fc:[],y=r?.optionalMethods||[],b=r?.optionalEvents||[],S=r?.rpcMap||this.buildRpcMap(p,r.projectId),N=r?.qrModalOptions||void 0;return{chains:a?.map(K=>this.formatChainId(K)),optionalChains:h.map(K=>this.formatChainId(K)),methods:g,events:w,optionalMethods:y,optionalEvents:b,rpcMap:S,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:N,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,t){const n={};return r.forEach(a=>{n[a]=this.getRpcUrl(a,t)}),n}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?No(this.rpc.chains):No(this.rpc.optionalChains),this.signer=await tx.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const{WalletConnectModal:n}=await e1(()=>import("./index-bee72117.js").then(a=>a.i),["assets/index-bee72117.js","assets/index-ac25b06b.js","assets/index-eaece3d5.css"]);t=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(t)try{this.modal=new t(es({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:t,optionalChains:n,rpcMap:a}=r;t&&Jr(t)&&(this.rpc.chains=t.map(h=>this.formatChainId(h)),t.forEach(h=>{this.rpc.rpcMap[h]=a?.[h]||this.getRpcUrl(h)})),n&&Jr(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n?.map(h=>this.formatChainId(h)),n.forEach(h=>{this.rpc.rpcMap[h]=a?.[h]||this.getRpcUrl(h)}))}getRpcUrl(r,t){var n;return((n=this.rpc.rpcMap)==null?void 0:n[r])||`${sx}?chainId=eip155:${r}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:t?.accounts),this.setAccounts(t?.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(t=>this.parseAccount(t))}}const Nx=Zc;export{Nx as EthereumProvider,ax as OPTIONAL_EVENTS,ox as OPTIONAL_METHODS,Fc as REQUIRED_EVENTS,$c as REQUIRED_METHODS,Zc as default};
